# `magrittr` {#magrittr}


The package `magrittr` introduces an operator, the pipe `%>%`, that allows a fully new way of coding in R. 
In a few words, that are not as clear as the examples below, the functions calls are now decomposed into steps and these steps are "_piped_" thanks to the operator `%>%`.    
The advantages of this way include:  

- the functions are read in steps from the left to right, as opposed to from the outside to the inside,  
- extra steps can easily be added at any point in the sequence,
- nested calls are avoided.

## How to pipe

A basic pipeline is constructed under the following general idea: the call to the left of the pipe is used as an argument (by default the first argument) in the call to the right of the pipe.  
Using the mathematical notation for functions, the following statements give a pretty accurate idea of the procedure.  


- `x %>% f` is equivalent to `f(x)`

This is the most basic rule for piping.

```{r}
my_data <- c(2:10, 20, 42)
mean(my_data)

my_data %>%
	mean()
```

Notice that it is usual to break lines after the pipe `%>%` as it facilitates reading and addition of new steps. Also, the `()` pasted to `mean` is not necessary, but, again, it makes it clear that we pipe a vector into a function.  
Generally, the construction of the code must be re-thought as the calls above are read in reverse ways: `mean(my_data)` reads use the function `mean` on the vector `my_data`, while `my_data %>% mean()` reads take the vector `my_data` and apply the function `mean` to it.


- `x %>% f(y)` is equivalent to `f(x, y)`

This rule shows how the left-to-pipe element is used as first argument in the right-to-pipe call. Recall this property as the _first argument rule_.

```{r}
library(magrittr)
my_data <- c(2:10, 20, 42)
mean(my_data, trim=0.1)

my_data %>%
	mean(trim=0.1)
```


- `x %>% f %>% g %>% h` is equivalent to `h(g(f(x)))`

This rule shows that the pipeline can include many steps.

```{r}
my_data <- c(2:10, 20, 42)
round(sqrt(mean(my_data)),2)

my_data %>%
	mean() %>%
	sqrt() %>%
	round(2)
```


## Using a placeholder

One can actually decide where the left-to-pipe element should be included in the right-to-pipe call. For that, use a dot, `.`, as a placeholder in the right-to-pipe call.

- `x %>% f(y, .)` is equivalent to `f(y, x)`

The `.` indicates where the left-to-pipe element should be used.

```{r}
round(17.23893,3)

3 %>%
	round(17.23893, .)

```


- `x %>% f(y, z = .)` is equivalent to `f(y, z = x)`

Notice that the left-to-pipe element need not be an argument, but can also be the value of an argument.


## Multiple placeholders

The placeholder can be used multiple times. Notice, however, that if the placeholder is not an argument (but simply a value of an argument), then `magrittr` still applies the _first argument rule_, unless the call on the right-to-pipe is enclosed in curly brackets.

- `x %>% f(y = nrow(.), z = ncol(.))` is equivalent to `f(x, y = nrow(x), z = ncol(x))`

- `x %>% {f(y = nrow(.), z = ncol(.))}` is equivalent to `f(y = nrow(x), z = ncol(x))`





```{r}
library(tidyverse)
data(iris)


t_iris <- as_tibble(iris)
t_iris2 <- t_iris[t_iris$Sepal.Length==5, ]
av.sw <- mean(t_iris2$Sepal.Width) 
av.sw

av.sw2 <- iris %>%
            as_tibble() %>%
            .[.$Sepal.Length==5, ] %>%
            {mean(.$Sepal.Width)}
av.sw2  
```





