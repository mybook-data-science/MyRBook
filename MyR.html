<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>An Introduction to R for the Field of Data Science</title>
  <meta name="description" content="These are notes gathering our experience to set up R-Studio and use R for data science." />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="An Introduction to R for the Field of Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are notes gathering our experience to set up R-Studio and use R for data science." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="An Introduction to R for the Field of Data Science" />
  
  <meta name="twitter:description" content="These are notes gathering our experience to set up R-Studio and use R for data science." />
  

<meta name="author" content="Moritz Ebach (400104774), Niklas Strolz (400098595), Frederik Miebach (KOWH116385)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">An Introduction to R for the Field of Data Science</h1>
<p class="author"><em>Moritz Ebach (400104774), Niklas Strolz (400098595), Frederik Miebach (KOWH116385)</em></p>
<p class="date"><em>Last update: July 23, 2019</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#foreword">Foreword</a></li>
<li><a href="#part-preface">(PART) Preface</a></li>
<li><a href="#about-the-authors"><span class="toc-section-number">1</span> About the Authors</a></li>
<li><a href="#structure-of-the-book"><span class="toc-section-number">2</span> Structure of the book</a></li>
<li><a href="#introduction"><span class="toc-section-number">3</span> Introduction</a></li>
<li><a href="#explaining-r---what-is-it"><span class="toc-section-number">4</span> Explaining R - What is it?</a><ul>
<li><a href="#what-is-r"><span class="toc-section-number">4.1</span> What is R?</a></li>
<li><a href="#what-is-r-used-for"><span class="toc-section-number">4.2</span> What is R used for?</a></li>
<li><a href="#r-package"><span class="toc-section-number">4.3</span> R package</a></li>
<li><a href="#communication-with-r"><span class="toc-section-number">4.4</span> Communication with R</a></li>
<li><a href="#why-use-r-as-a-language-for-programming"><span class="toc-section-number">4.5</span> Why use R as a language for programming?</a></li>
</ul></li>
<li><a href="#the-first-steps"><span class="toc-section-number">5</span> The first steps</a><ul>
<li><a href="#installing-the-required-applications"><span class="toc-section-number">5.1</span> Installing the required applications</a></li>
<li><a href="#signing-up-for-github"><span class="toc-section-number">5.2</span> Signing up for GitHub</a></li>
<li><a href="#creating-a-new-project"><span class="toc-section-number">5.3</span> Creating a new project</a></li>
<li><a href="#create-a-new-github-repository"><span class="toc-section-number">5.4</span> Create a new GitHub repository</a></li>
<li><a href="#link-the-repository-to-rstudio"><span class="toc-section-number">5.5</span> Link the repository to RStudio</a></li>
<li><a href="#commit-and-push-any-changes-to-github"><span class="toc-section-number">5.6</span> Commit and push any changes to GitHub</a></li>
<li><a href="#collaboration-on-github"><span class="toc-section-number">5.7</span> Collaboration on GitHub</a></li>
</ul></li>
<li><a href="#part-source-and-output-files">(PART) Source and output files</a></li>
<li><a href="#r-markdown-files"><span class="toc-section-number">6</span> R Markdown files</a><ul>
<li><a href="#general-description-of-r-markdown-files"><span class="toc-section-number">6.1</span> General description of R Markdown files</a></li>
<li><a href="#getting-started-with-r-markdown-files"><span class="toc-section-number">6.2</span> Getting started with R Markdown files</a></li>
<li><a href="#options-for-r-markdown-files"><span class="toc-section-number">6.3</span> Options for R Markdown files</a></li>
<li><a href="#improtant-options-for-all-chunks"><span class="toc-section-number">6.4</span> Improtant options for all chunks</a></li>
<li><a href="#latex"><span class="toc-section-number">6.5</span> Latex code</a></li>
<li><a href="#figures"><span class="toc-section-number">6.6</span> Figures</a></li>
<li><a href="#cr"><span class="toc-section-number">6.7</span> Cross-references</a></li>
<li><a href="#citations"><span class="toc-section-number">6.8</span> Citations</a></li>
</ul></li>
<li><a href="#import"><span class="toc-section-number">7</span> Import data to R</a><ul>
<li><a href="#reading-rectangular-data"><span class="toc-section-number">7.1</span> Reading rectangular data</a></li>
<li><a href="#read-other-data-types"><span class="toc-section-number">7.2</span> Read other data types</a></li>
<li><a href="#scanning-a-file"><span class="toc-section-number">7.3</span> Scanning a file</a></li>
</ul></li>
<li><a href="#custom-ouptut"><span class="toc-section-number">8</span> Customize output</a><ul>
<li><a href="#multiple-built-in-output-types"><span class="toc-section-number">8.1</span> Multiple built-in output types</a></li>
<li><a href="#new-types-provided-by-packages"><span class="toc-section-number">8.2</span> New types provided by packages</a></li>
<li><a href="#css-custom-html"><span class="toc-section-number">8.3</span> CSS: custom html</a></li>
<li><a href="#latex-preamble"><span class="toc-section-number">8.4</span> Latex preamble</a></li>
</ul></li>
<li><a href="#datastructures"><span class="toc-section-number">9</span> Data stuctures</a><ul>
<li><a href="#atomic-vectors"><span class="toc-section-number">9.1</span> Atomic vectors</a></li>
<li><a href="#matrices-and-arrays"><span class="toc-section-number">9.2</span> Matrices and arrays</a></li>
<li><a href="#lists"><span class="toc-section-number">9.3</span> Lists</a></li>
<li><a href="#data-frames"><span class="toc-section-number">9.4</span> Data frames</a></li>
<li><a href="#a-word-about-attributes"><span class="toc-section-number">9.5</span> A word about attributes</a></li>
<li><a href="#environments"><span class="toc-section-number">9.6</span> Environments</a></li>
<li><a href="#head"><span class="toc-section-number">9.7</span> &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</a></li>
</ul></li>
<li><a href="#rcalc"><span class="toc-section-number">10</span> R as a calculator</a><ul>
<li><a href="#usual-operators"><span class="toc-section-number">10.1</span> Usual operators</a></li>
<li><a href="#order-of-operations"><span class="toc-section-number">10.2</span> Order of operations</a></li>
<li><a href="#number-of-digits-displayed"><span class="toc-section-number">10.3</span> Number of digits displayed</a></li>
<li><a href="#unusual-operators"><span class="toc-section-number">10.4</span> Unusual operators</a></li>
<li><a href="#usual-functions"><span class="toc-section-number">10.5</span> Usual functions</a></li>
<li><a href="#unusual-functions"><span class="toc-section-number">10.6</span> Unusual functions</a></li>
</ul></li>
<li><a href="#simple-functions-on-vectors"><span class="toc-section-number">11</span> Simple functions on vectors</a><ul>
<li><a href="#element-by-element-evaluation"><span class="toc-section-number">11.1</span> Element by element evaluation</a></li>
<li><a href="#recycling-rule"><span class="toc-section-number">11.2</span> Recycling rule</a></li>
<li><a href="#functions-for-the-whole-vector"><span class="toc-section-number">11.3</span> Functions for the whole vector</a></li>
</ul></li>
<li><a href="#subset"><span class="toc-section-number">12</span> Subsetting</a><ul>
<li><a href="#section"><span class="toc-section-number">12.1</span> <code>[]</code></a></li>
<li><a href="#section-1"><span class="toc-section-number">12.2</span> <code>[[]]</code></a></li>
<li><a href="#section-2"><span class="toc-section-number">12.3</span> <code>$</code></a></li>
<li><a href="#combining-subsetting"><span class="toc-section-number">12.4</span> Combining subsetting</a></li>
<li><a href="#subsetting-with-one-condition"><span class="toc-section-number">12.5</span> Subsetting with one condition</a></li>
<li><a href="#subsetting-and-assignment"><span class="toc-section-number">12.6</span> Subsetting and assignment</a></li>
<li><a href="#using-which"><span class="toc-section-number">12.7</span> Using <code>which()</code></a></li>
<li><a href="#more-advanced-stuff"><span class="toc-section-number">12.8</span> More advanced stuff</a></li>
</ul></li>
<li><a href="#conditions"><span class="toc-section-number">13</span> Conditions</a><ul>
<li><a href="#if-statement"><span class="toc-section-number">13.1</span> <code>if</code> statement</a></li>
<li><a href="#else-statement"><span class="toc-section-number">13.2</span> <code>else</code> statement</a></li>
<li><a href="#else-if-statement"><span class="toc-section-number">13.3</span> <code>else if</code> statement</a></li>
<li><a href="#ifelse-statement"><span class="toc-section-number">13.4</span> <code>ifelse</code> statement</a></li>
<li><a href="#logical-operators-and"><span class="toc-section-number">13.5</span> Logical operators: <code>&amp;</code>, <code>|</code> and <code>!</code></a></li>
<li><a href="#writing-and-interpreting-a-condition"><span class="toc-section-number">13.6</span> Writing and interpreting a condition</a></li>
</ul></li>
<li><a href="#functions"><span class="toc-section-number">14</span> Functions</a><ul>
<li><a href="#structure-of-a-simple-function"><span class="toc-section-number">14.1</span> Structure of a simple function</a></li>
<li><a href="#multiple-arguments-and-their-identification"><span class="toc-section-number">14.2</span> Multiple arguments and their identification</a></li>
</ul></li>
<li><a href="#loops"><span class="toc-section-number">15</span> Loops (avoid them)</a><ul>
<li><a href="#introduction-to-loops-with-a-silly-example-bad-r-coding"><span class="toc-section-number">15.1</span> Introduction to loops with a silly example (bad R coding)</a></li>
<li><a href="#general-form-of-a-for-loop"><span class="toc-section-number">15.2</span> General form of a <code>for</code> loop</a></li>
<li><a href="#a-good-example-of-a-loop"><span class="toc-section-number">15.3</span> A good example of a loop</a></li>
<li><a href="#looping-over-non-numeric-elements"><span class="toc-section-number">15.4</span> Looping over non-numeric elements</a></li>
<li><a href="#more-advanced-stuff-1"><span class="toc-section-number">15.5</span> More advanced stuff</a></li>
</ul></li>
<li><a href="#import"><span class="toc-section-number">16</span> Import data to R</a><ul>
<li><a href="#reading-rectangular-data-1"><span class="toc-section-number">16.1</span> Reading rectangular data</a></li>
<li><a href="#read-other-data-types-1"><span class="toc-section-number">16.2</span> Read other data types</a></li>
<li><a href="#scanning-a-file-1"><span class="toc-section-number">16.3</span> Scanning a file</a></li>
</ul></li>
<li><a href="#splots"><span class="toc-section-number">17</span> Simple plots</a><ul>
<li><a href="#line-plots"><span class="toc-section-number">17.1</span> Line plots</a></li>
<li><a href="#bar-graphs-and-histograms"><span class="toc-section-number">17.2</span> Bar graphs and histograms</a></li>
</ul></li>
<li><a href="#part-tidyverse">(PART) Tidyverse</a></li>
<li><a href="#tidyverse"><span class="toc-section-number">18</span> What is <code>tidyverse</code></a></li>
<li><a href="#tibble"><span class="toc-section-number">19</span> <code>tibble</code></a><ul>
<li><a href="#creating-a-tibble"><span class="toc-section-number">19.1</span> Creating a tibble</a></li>
</ul></li>
<li><a href="#readr"><span class="toc-section-number">20</span> <code>readr</code> and <code>readxl</code></a><ul>
<li><a href="#readr"><span class="toc-section-number">20.1</span> <code>readr</code></a></li>
<li><a href="#readxl"><span class="toc-section-number">20.2</span> <code>readxl</code></a></li>
</ul></li>
<li><a href="#magrittr"><span class="toc-section-number">21</span> <code>magrittr</code></a><ul>
<li><a href="#how-to-pipe"><span class="toc-section-number">21.1</span> How to pipe</a></li>
<li><a href="#using-a-placeholder"><span class="toc-section-number">21.2</span> Using a placeholder</a></li>
<li><a href="#multiple-placeholders"><span class="toc-section-number">21.3</span> Multiple placeholders</a></li>
</ul></li>
<li><a href="#install-the-cutting-edge-development-version-from-github"><span class="toc-section-number">22</span> Install the cutting edge development version from GitHub:</a></li>
<li><a href="#install.packagesdevtools"><span class="toc-section-number">23</span> install.packages(“devtools”)</a></li>
<li><a href="#extract-the-characters-on-either-side-of-the-vowel"><span class="toc-section-number">24</span> extract the characters on either side of the vowel</a></li>
<li><a href="#tidyr"><span class="toc-section-number">25</span> <code>tidyr</code></a><ul>
<li><a href="#gather"><span class="toc-section-number">25.1</span> <code>gather</code></a></li>
<li><a href="#spread"><span class="toc-section-number">25.2</span> <code>spread</code></a></li>
<li><a href="#separate"><span class="toc-section-number">25.3</span> <code>separate</code></a></li>
<li><a href="#unite"><span class="toc-section-number">25.4</span> <code>unite</code></a></li>
</ul></li>
<li><a href="#dplyr"><span class="toc-section-number">26</span> <code>dplyr</code></a><ul>
<li><a href="#grammar-of-data-manipulation"><span class="toc-section-number">26.1</span> Grammar of data manipulation</a></li>
<li><a href="#select"><span class="toc-section-number">26.2</span> <code>select</code></a></li>
<li><a href="#mutate"><span class="toc-section-number">26.3</span> <code>mutate</code></a></li>
<li><a href="#filter"><span class="toc-section-number">26.4</span> <code>filter</code></a></li>
<li><a href="#arrange"><span class="toc-section-number">26.5</span> <code>arrange</code></a></li>
<li><a href="#summarise"><span class="toc-section-number">26.6</span> <code>summarise</code></a></li>
<li><a href="#piping-verbs"><span class="toc-section-number">26.7</span> Piping verbs</a></li>
<li><a href="#group_by"><span class="toc-section-number">26.8</span> <code>group_by</code></a></li>
<li><a href="#keys-for-joins"><span class="toc-section-number">26.9</span> Keys for joins</a></li>
<li><a href="#joins"><span class="toc-section-number">26.10</span> Joins</a></li>
<li><a href="#operations-on-data-sets"><span class="toc-section-number">26.11</span> Operations on data sets</a></li>
</ul></li>
<li><a href="#ggplot2"><span class="toc-section-number">27</span> <code>ggplot2</code></a><ul>
<li><a href="#comparison-with-base-plot"><span class="toc-section-number">27.1</span> Comparison with base <code>plot</code></a></li>
<li><a href="#grammar-of-graphics---leland-wilkinson"><span class="toc-section-number">27.2</span> Grammar of graphics - Leland Wilkinson</a></li>
<li><a href="#understanding-the-grammar"><span class="toc-section-number">27.3</span> Understanding the grammar</a></li>
<li><a href="#aesthetics-1"><span class="toc-section-number">27.4</span> Aesthetics</a></li>
<li><a href="#geometries-1"><span class="toc-section-number">27.5</span> Geometries</a></li>
</ul></li>
<li><a href="#part-intermediate-r">(PART) Intermediate R</a></li>
<li><a href="#functionals"><span class="toc-section-number">28</span> Functionals</a><ul>
<li><a href="#the-apply-family"><span class="toc-section-number">28.1</span> The <code>apply</code> family</a></li>
<li><a href="#apply"><span class="toc-section-number">28.2</span> <code>apply</code></a></li>
<li><a href="#lapply"><span class="toc-section-number">28.3</span> <code>lapply</code></a></li>
<li><a href="#sapply"><span class="toc-section-number">28.4</span> <code>sapply</code></a></li>
<li><a href="#multicore-implementation"><span class="toc-section-number">28.5</span> Multicore implementation</a></li>
</ul></li>
<li><a href="#scoping"><span class="toc-section-number">29</span> Scoping</a><ul>
<li><a href="#introduction-1"><span class="toc-section-number">29.1</span> Introduction</a></li>
<li><a href="#rule-1-name-masking"><span class="toc-section-number">29.2</span> Rule 1: name masking</a></li>
<li><a href="#rule-2-fresh-start"><span class="toc-section-number">29.3</span> Rule 2: fresh start</a></li>
<li><a href="#rule-3-dynamic-lookup"><span class="toc-section-number">29.4</span> Rule 3: dynamic lookup</a></li>
<li><a href="#functions-inside-functions"><span class="toc-section-number">29.5</span> Functions inside functions</a></li>
<li><a href="#examples"><span class="toc-section-number">29.6</span> Examples</a></li>
</ul></li>
<li><a href="#part-conclusion">(PART) Conclusion</a></li>
<li><a href="#conclusion"><span class="toc-section-number">30</span> Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An Introduction to R for the Field of Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="foreword" class="section level1 unnumbered">
<h1>Foreword</h1>
<blockquote>
<p>“The statistic is the rhetoric of the empirical sciences.”</p>
<p>— paraphrase of Alexander Eiler’s quote on statistics</p>
</blockquote>
<p>Students with a focus on economics and science have to work a lot with statistical data sets and calculations in order to be able to carry out evaluations. Traditionally, educational institutions work with formula collections and calculators, which has several disadvantages. On the one hand, solutions have to be documented in a laborious way, on the other hand, statistical calculations with formula collections are very time-consuming. The programming language R in combination with R Studio enables students like us to analyze and visualize complex data sets and to adapt them according to our own criteria with less effort compared to the traditional methods. With this book we want to give a practical guide on how to apply these benefits of R to beginners.</p>
<p>So we focus on three questions.</p>
<ol style="list-style-type: decimal">
<li>What steps must be undertaken to be able to work productively with R and R studio?</li>
<li>How can R be used for data science using practical examples?</li>
<li>What does a complex project look like in R and what steps must be taken to solve it?</li>
</ol>
<!--chapter:end:index.Rmd-->
</div>
<div id="part-preface" class="section level1 unnumbered">
<h1>(PART) Preface</h1>
</div>
<div id="about-the-authors" class="section level1">
<h1><span class="header-section-number">1</span> About the Authors</h1>
<p>Frederik Miebach (LinkedIn: Frederik Miebach) is a business student at Hochschule Fresenius, currently studying in the master’s degree of International Business Management. He earned his bachelor’s degree in International Business Administration at Hochschule Fresenius in Cologne and is currently working in the field of human resources at the Bayer AG in Leverkusen.</p>
<p>Moritz Ebach (LinkedIn: Moritz Ebach) is also a business student at Hochschule Fresenius, currently studying in the master’s degree of International Business Management. He earned his bachelor’s degree in International Business Management at Hochschule Fresenius in Cologne and is currently working in the field of business consultancy at Deloitte in Düsseldorf.</p>
<p>Niklas Strolz (LinkedIn: Niklas Strolz) is also a business student at Hochschule Fresenius, currently studying in the master’s degree of International Business Management. He earned his bachelor’s degree in International Business Management at Hochschule Fresenius in Cologne and just finished an internship in the field of M&amp;A at BELGRAVIA &amp; Co. GmbH in Cologne.</p>
<p>After working with R for the first time for a period of in total four months, the group of students is now working on a student project, which focuses on the design of a book about “R in Data Science”.</p>
<!--chapter:end:01-authors.Rmd-->
</div>
<div id="structure-of-the-book" class="section level1">
<h1><span class="header-section-number">2</span> Structure of the book</h1>
<p>The preface of the book focuses on a short description of the authors, a short introduction to the book itself, an explanation of what R is and how it can be used, as well as the first steps of a project with R (including the linkage between R and GitHub). The preface is therefore a basic introduction to R and how projects are and can be designed. The first chapter of the book then focuses on source and output files. It is a continuation of the preface with much more detail on how R can be used and how data is imported into R. The first chapter therefore includes topics such as R Markdown files, importing data into R, using R as a calculator and using data structures. Note: The preface and first chapter of the book are fundaments of how to work with R and how to get started. Therefore, it is important to read these two parts of the book very carefully for the first time and follow every step carefully. The second chapter of the book focuses on tidyverse, which is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. The final chapter of the book then focuses on how to use R for data science. The knowledge of the first chapter should therefore be utilized for the second chapter of the book. For the chapter of data science or data analysis, we have decided to meke use R basics, in order to analyze various data (e.g. simple functions on vectors, subsetting, functions etc.).</p>
<p>To sum it up, this book is a reference for working with R as a tool or language for data science. Make sure to make use of the Pareto principle (80/20 rule) when reading it. Not all sections are equally useful or important to the particular book or even books that you intend to write.</p>
<!--chapter:end:02-structureofthebook.Rmd-->
</div>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">3</span> Introduction</h1>
<p>“Data science is the field of study that combines domain expertise, programming skills, and knowledge of math and statistics to extract meaningful insights from data” (DataRobot, 2019). It is therefore a discipline that allows you to convert raw data into a valuable source of understanding, insight, and knowledge.</p>
<p>This book is an introduction to R for the field of data science. It was designed in the course of a project study in data science at Hochschule Fresenius in Cologne and is a guide to the language of R with a linkage to the platform GitHub. It is therefore a guide on how to design a book or project with R and afterwards publish it. The goal of the book “An Introduction to R for the Field of Data Science” is therefore designed to help you learn some of the most important tools in R that will enable you to do data science or data analysis. After reading this book, you will have access to a variety of tools to tackle a wide range of data science challenges, using the fundamental parts of R. In order to understand every part of the book, it might be useful to acquire some basic knowledge about R and data science. Therefore, beginners can start with the cheatsheet, which is available at <a href="https://www.rstudio.com/resources/cheatsheets/">RStudioCheatsheet</a>.</p>
<!--chapter:end:03-introduction.Rmd-->
</div>
<div id="explaining-r---what-is-it" class="section level1">
<h1><span class="header-section-number">4</span> Explaining R - What is it?</h1>
<p>This chapter of the book starts with the explanation of what R is and how R can be used.</p>
<div id="what-is-r" class="section level2">
<h2><span class="header-section-number">4.1</span> What is R?</h2>
<p>Let’s start with a short definition of R: “R is a programming language developed by Ross Ihaka and Robert Gentleman in 1993, which possesses an extensive catalog of statistical and graphical methods.”</p>
<p>R includes machine learning algorithm, linear regression, time series, statistical inference and many other features.</p>
<p>Not only academic companies trust in R, but many large companies also use the R programming language, including Google, Airbnb, Facebook, Uber and many others.</p>
<p>Focusing on data science or analysis with R, it is important to understand that this is done in a series of steps; programming, transforming, discovering, modeling and communicate the results.</p>
<ol style="list-style-type: decimal">
<li>Program: R is a programming tool.</li>
<li>Transform: R is consists of a collection of libraries designed for data science.</li>
<li>Discover: Import the data, optimize them, rethink them and analyze them.</li>
<li>Model: R offers a wide ranges of tools to capture an appropriate model for your data.</li>
<li>Communicate: Integrate codes, graphs, and outputs to a report with R Markdown and share it with the world via different platforms.</li>
</ol>
</div>
<div id="what-is-r-used-for" class="section level2">
<h2><span class="header-section-number">4.2</span> What is R used for?</h2>
<ol style="list-style-type: decimal">
<li>Statistical inference</li>
<li>Data analysis</li>
<li>Machine learning algorithm</li>
</ol>
</div>
<div id="r-package" class="section level2">
<h2><span class="header-section-number">4.3</span> R package</h2>
<p>Many of the functions available in R come in packages. To install an R package, open an R session and type the following command into the command line:</p>
<pre class="{r"><code>install.packages(&quot;&lt;the package&#39;s name&gt;&quot;)</code></pre>
<p>Once the package is installed, the content will be available for usasge.</p>
<p>The fundamental or primary functions of R are statitical interference, visualization, and machine learning.</p>
<p>The most important R packages are listed below, which are mainly uses for the workflow of data science (Data preparation and communication of the results):</p>
<pre class="{r"><code>1. dplyr (Command line: install.packages(&quot;dplyr&quot;))
2. ggplot2 (Command line: install.packages(&quot;ggplot2&quot;))
3. data.table (Command line: install.packages(&quot;data.table&quot;))
4. shiny (Command line: install.packages(&quot;shiny&quot;))
5. plyr (Command line: install.packages(&quot;plyr&quot;))</code></pre>
</div>
<div id="communication-with-r" class="section level2">
<h2><span class="header-section-number">4.4</span> Communication with R</h2>
<p>R offers a variety of ways to present and share work. As explained in previous chapters of the book, this mainly happens through an R Markdown file or document. The results of the work in R can then be published or shared on GitHub, on business websites or other platforms available for R.</p>
<p>Rstudio therefore offers you via R Markdown files to write a document. You can then export the documents in many different formats:</p>
<p>Document: - HTML - PDF/Latex - Word</p>
<p>Presentation: - HTML - PDF beamer</p>
</div>
<div id="why-use-r-as-a-language-for-programming" class="section level2">
<h2><span class="header-section-number">4.5</span> Why use R as a language for programming?</h2>
<ol style="list-style-type: decimal">
<li>R is not just a mix of statistical packages, it’s an own language.</li>
<li>R is designed to operate the way that problems are thought about.</li>
<li>R is both flexible and powerful.</li>
</ol>
<p>R is not the only language that can be used for data analysis. Why R rather than another?</p>
<ol style="list-style-type: decimal">
<li><p>Data analysis can be described as an interactive process, which generally means that you can determine what to do next with what you see at one stage. Therefore, interactivity is very important for programming languages. Language is very important. And together, it is an interactive language, which can be used perfectly for programming and data analysis.</p></li>
<li><p>The mechanism that R offeres is fantastic for creating a variety of data structures. If you are working on data analysis, you of course want to be able to put data into natural form, which is a key function of R.</p></li>
<li><p>Producing graphs for data analysis is a fairly easy process when using R and offers a variety of different options for producing high quality graphs.</p></li>
<li><p>As mentioned in this chapter R has a package system, which will also be explained in detail in the chapter of “Tidyverse”. The packages offered in R give people the opportunity to add own functionalities, which distinguishes it from the central part of R.</p></li>
<li><p>Important: Real data have missing values, which are a fundamental part of the R language. Functions in R therefore give you the opportunity to control how missing values should be handled.</p></li>
<li><p>The R community is very strong. Everyone is committed to the prcoess of improving the language of R and therefore also the process of data analysis. Questions and answers about problems with R are offered online and help optimize the working process with R.</p></li>
</ol>
<!--chapter:end:04-explainingr.Rmd-->
</div>
</div>
<div id="the-first-steps" class="section level1">
<h1><span class="header-section-number">5</span> The first steps</h1>
<div id="installing-the-required-applications" class="section level2">
<h2><span class="header-section-number">5.1</span> Installing the required applications</h2>
<p>The first step of working with R is to download the following free applications, which are available on the following platforms:</p>
<ol style="list-style-type: decimal">
<li>Download and install <a href="https://cran.uni-muenster.de/">R</a></li>
<li>Download and install <a href="https://www.rstudio.com/products/rstudio/download/#download">RStudio, free Desktop version</a></li>
<li>Download and install <a href="https://www.latex-project.org/get/">A Latex distribution</a> (e.g., MacTex for Mac or MiKTeX for Windows machines)</li>
</ol>
<p>The first two applications are easily and quickly installed for Mac and Windows. The third application is very large (a few Gb) and needs some time to be installed.</p>
<p>Another application needed is a</p>
<ol start="4" style="list-style-type: decimal">
<li><a href="https://git-scm.com/downloads">Git distribution</a></li>
</ol>
<p>This application is also classified as a free software.<br />
Once you have installed Git for version control, activate it in RStudio: <em>Tools&gt; Global Options&gt; Git/SVN</em> and click on <em>Enable version control interface for RStudio projects</em>.<br />
Also generate a SHH RSA key. Generating an SHH RSA key is required to link RStudio to a repository on GitHub.</p>
<p>(GitHub is a website and cloud-based service that helps developers store and manage their code, as well as track and control changes to their code)</p>
</div>
<div id="signing-up-for-github" class="section level2">
<h2><span class="header-section-number">5.2</span> Signing up for GitHub</h2>
<p>Create an account at GitHub at <a href="https://github.com/join">https://github.com</a>.</p>
</div>
<div id="creating-a-new-project" class="section level2">
<h2><span class="header-section-number">5.3</span> Creating a new project</h2>
<p>RStudio projects are associated with working directories in R. RStudio projects can be created:</p>
<ul>
<li>In a new directory</li>
<li>In an existing directory (R code and data already exists)</li>
<li>By cloning a version control repository (Available on Git or any other subversion)</li>
</ul>
<p>Focusing on our our project in Data Science, we will focus on creating an an RStudio project in an existing directory</p>
<p><em>File&gt; New project&gt; Existing Directory</em> and chose the suggested book folder. You can also change the location of the project working directory.</p>
<p>Important: Every time you create new content for your book, you must start an Rstudio session <em>File&gt; Open Project…</em><br />
All the files of the project are the files of the folder (working directory), and vice versa.</p>
</div>
<div id="create-a-new-github-repository" class="section level2">
<h2><span class="header-section-number">5.4</span> Create a new GitHub repository</h2>
<p>The next step of the process is to create a new repository (pronounced ‘repo’) on GitHub.com. 1. Name the repository <strong>exactly</strong> by the name of the created R project / book folder (e.g., ‘myRbook’).<br />
2. Enter a description for the repository (Optional) 3. Select public visibility. 4. Select initialize this repository with a README (Optional) 5. Select add .ignore and select R. 6. Create the repository.</p>
<p>After having created the repository, go to the settings of the respective repo and deploy a new SSH key, which has been generated by RStudio. Go to <em>Settings&gt; Deploy keys</em> and click on ‘add deploy key’. Copy and paste the SHH key generated by RStudio: <em>Tools&gt; Global Options&gt; Git/SVN</em> and click on view public key.</p>
<p>In RStudio go to <em>Tools&gt; Project Options…&gt; Git/SVN</em>. Under <em>Version control system</em>, select ‘Git’.</p>
</div>
<div id="link-the-repository-to-rstudio" class="section level2">
<h2><span class="header-section-number">5.5</span> Link the repository to RStudio</h2>
<p>Still in RStudio, go to <em>Tools&gt; Terminal&gt; New Terminal</em>. This will open a Terminal where commands can be typed in.</p>
<p>Start by initializing Git on the terminal.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">git init</code></pre></div>
<p>Then paste the message shown at the creation of the repo (changing the names, of course):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">git remote add origin https<span class="op">:</span><span class="er">//</span>github.com<span class="op">/</span>YOURNAME<span class="op">/</span>YOURREPO.git
git push <span class="op">-</span>u origin master</code></pre></div>
<p>After finalizing the above described process, the local <code>master</code> should now be connected to the <code>master</code> on GitHub.<br />
If necessary, restart RStudio. At the restart, a Git thumbnail should appear in a pane. You are now ready to commit and push your files.</p>
</div>
<div id="commit-and-push-any-changes-to-github" class="section level2">
<h2><span class="header-section-number">5.6</span> Commit and push any changes to GitHub</h2>
<p>In the next chapter of the book, R Markdown documents or files are explained. In general, a R Markdown file is a record of your research. Whenever RMD files are changed or updated, it is time to commit and push them to your GitHub repository.</p>
<ol style="list-style-type: decimal">
<li>In RStudio click the “Git” tab in the upper right pane.</li>
<li>Click Commit.</li>
<li>In the Review changes view, check the staged box for all files you want to commit and push to GitHub.</li>
<li>Make sure to always include or add a commit message (e.g. Intial Commit).</li>
<li>Click Commit.</li>
<li>Click the Pull button to fetch any remote changes from GitHub.</li>
<li>Click the Push button to push any changes to the repository on GitHub.</li>
<li>On GitHub, navigate to the Code tab of the repository and refresh the page to see the changes.</li>
</ol>
<p>Important: Before you push any changes to GitHub, make sure to commit the files you want to add.</p>
<div id="troubleshooting" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Troubleshooting</h3>
<p>If this procedure works, great! You’re good to go.</p>
<p>Yet: Please be aware that the above described process sometimes hits unexpected problems. These problems are often difficult to understand (especially as a “beginner” of R). If this is the cas, the best sultion is to copy and google the error message.</p>
<p>The solutions offered on Google will definitely help solve the experienced problem.</p>
</div>
</div>
<div id="collaboration-on-github" class="section level2">
<h2><span class="header-section-number">5.7</span> Collaboration on GitHub</h2>
<p>There are various established ways for collaborating on a GitHub repo. As a matter of facts, collaboration on a project is the <em>raison d’etre</em> of GitHub.<br />
We illustrate here the easiest of them, namely the joint reading and writing into one repo by all the members of a team.<br />
Importantly, it is assumed that all members of the group are able to push/pull code from RStudio to an experimental repo on GitHub (see above).<br />
The following are the steps in the collaboration’s setup.</p>
<div id="creation-of-an-organization" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Creation of an organization</h3>
<p>The following section focuses on the creation of an organization, which enables a group of people to work on the same project and therefore collaborate via GitHub. Every member of the organization will then have the opportunity to commit, push and pull any changes of the prokject.</p>
<p>Step 1: One member of the group creates an organization on GitHub under <em>Settings&gt; Organizations&gt; New organization</em>.</p>
<p>Step 2: Under the newly created organization, this member of the team creates a new repo whose name is the same as the folder and R project that the group will work on (e.g., ‘ouRbook’).</p>
<p>Step 3: The owner of the organization connects RStudio to the repo (Described process) and populates it with the current files of the project.</p>
</div>
<div id="creation-of-a-team" class="section level3">
<h3><span class="header-section-number">5.7.2</span> Creation of a team</h3>
<p>Step 1: Still as a task of the owner, create a team. Under the organization page in GitHub, simply click on ‘New team’ and give it a name. A team now appears in the organization page. In the page of that team, click on ‘Add a member’. A window appears where the member to be added can be searched for and added.</p>
<p>Step 2: Once that member is found and selected, make the double step of adding him/her to the team AND assign him/her to the repo. This second step can still be made later, but it is easier to do it right then.</p>
<p>Important: Make sure that the new member has reading and <strong>writing</strong> rights to the repo, in order to be able to also make changes. This again can be changed later by navigating the team’s page.</p>
</div>
<div id="member-of-the-team" class="section level3">
<h3><span class="header-section-number">5.7.3</span> Member of the team</h3>
<p>After the steps above, the newly added member receives an email to confirm the participation of the organization and team.<br />
After accepting or confirming the participation, navigate to the page of the team and locate the repo that the owner has created.<br />
A button-menu allows to ‘Clone or download the repo’. Click to show the https address of the repo, <code>https://github.com/ORGANIZATION/repo.git</code> and copy that link.<br />
Open a simple RStudio session (not a project!). Open a new Terminal (<em>Tools&gt; Terminal&gt; New Terminal</em>) and type <code>cd</code> (change directory) and a path to the folder where you want the repo to be saved. For instance,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cd Desktop<span class="op">/</span>DataScience<span class="op">/</span>OurRProject </code></pre></div>
<p>The terminal is writing into that folder, as indicated by the path before the <code>$</code> sign in the command line of the terminal.<br />
Recall that you copied the address of the team’s repo. Then, in the command line, type the following commands and your copied address:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">git clone https<span class="op">:</span><span class="er">//</span>github.com<span class="op">/</span>ORGANIZATION<span class="op">/</span>repo.git </code></pre></div>
<p>The whole repo is now a new folder in your directory. If all went well, you can now pull and push into that repo in GitHub.</p>
<!--chapter:end:05-thefirststepsofr.Rmd-->
</div>
</div>
</div>
<div id="part-source-and-output-files" class="section level1 unnumbered">
<h1>(PART) Source and output files</h1>
</div>
<div id="r-markdown-files" class="section level1">
<h1><span class="header-section-number">6</span> R Markdown files</h1>
<p>The following chapter gathers general comments and information about <code>.Rmd</code> files.</p>
<div id="general-description-of-r-markdown-files" class="section level2">
<h2><span class="header-section-number">6.1</span> General description of R Markdown files</h2>
<p>What is R Markdown?</p>
<p>An R Markdown file is a record of your research, or in other words, a format for making dynamic documents with R. In general, an R Markdwon file is written in “markdown”, which is an easy-to-write plain text format. This particular text format contains chunks of embedded R codes.</p>
<p>Requirement for R Markdown files:</p>
<p>R Markdown files are designed to be used with the “rmarkdown” package. “rmarkdown” comes installed with RStudio, yet you can install an own copy of rmarkdown by clicking on <em>Tools&gt; Install packages</em> and search for “rmarkdown”. You can also install the above mentioned package with the following command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;rmarkdown&quot;</span>)</code></pre></div>
<p>R Markdown files can be transformed in two ways: 1. Knit the file and 2. Convert the file.</p>
<ol style="list-style-type: decimal">
<li>Knit - The rmarkdown package includes or calls the knitr package. knitr runs each chunk of R codes in the document and append the results of the codes to the document next to the code chunk. This workflow saves time and facilitates reproducible reports.</li>
</ol>
<p>In R Markdown, every single report contains codes or a code it needs to make own graphs, tables, numbers, etc. The report can therefore be automatically updated by the author via the process of re-knitting.</p>
<ol start="2" style="list-style-type: decimal">
<li>Convert - The rmarkdown package will use the pandoc program to transform the R Markdown file into a new format. For example, .Rmd file can be converted into a PDF, HTML, or Microsoft Word file.</li>
</ol>
</div>
<div id="getting-started-with-r-markdown-files" class="section level2">
<h2><span class="header-section-number">6.2</span> Getting started with R Markdown files</h2>
<ol style="list-style-type: decimal">
<li>Open a new .Rmd file: <em>File&gt; New File&gt; R Markdown</em> and choose a name for the file.</li>
<li>Write the document by editing the template.</li>
<li>Knit the document to create a report and preview the output in a PDF, HTML or another output.</li>
<li>Save the .Rmd file and (optional) publish the file to a web server (e.g. GitHub) by commiting and pushing it.</li>
</ol>
<p>This is the general process of creating or opening an R Markdwon file.</p>
</div>
<div id="options-for-r-markdown-files" class="section level2">
<h2><span class="header-section-number">6.3</span> Options for R Markdown files</h2>
<p>The options of R Markdown files focus on the .rmd structure and render options with YAML, which will be explained in the following section.</p>
<div id="rmd-structure" class="section level3">
<h3><span class="header-section-number">6.3.1</span> .rmd structure</h3>
<p>YAML Header = Optional section of render (e.g. pandoc)</p>
<p>Text = Narration formatted with markdown, mixed with “Code Chunks”:</p>
<p>A code chunk always begins with <code>{r} and ends with</code> e.g.</p>
<p>```{r} &lt;- Starting point of the chunk.</p>
<p>``` &lt;- Ending point of the chunk.</p>
<p>R Markdown will run the code and append the results to the document. It will use the location of the .Rmd file as the working directory.</p>
</div>
<div id="render-options-with-yaml" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Render options with YAML</h3>
<p>When you render, R Markdown:</p>
<ol style="list-style-type: decimal">
<li>runs the R code, embeds results and text ino .md file with knitr</li>
<li>then converts the .md file into the finished format with pandoc</li>
</ol>
<p>Rmd -&gt; knitr -&gt; md -&gt; pandoc -&gt; Defined output value.</p>
<p>The defined output value can be defined as one of the following options:</p>
<p>html_document -&gt; html pdf_document -&gt; pdf word_document -&gt; Microsoft Word md_document -&gt; Markdown etc.</p>
<p>As a next step, the output can also be customized with sub-options:</p>
<p>Examples of sub-options:</p>
<p>toc = Add a table of contents at start of document highlight = Syntax highlighting “tango”, “pygments”, “kate” etc. css = CSS file to use to style document</p>
<p>Please keep in mind that not every sub-option is applicable for all output values, which means that the “toc” for example is applicable for most of the outputs, yet not for all of them.</p>
</div>
</div>
<div id="improtant-options-for-all-chunks" class="section level2">
<h2><span class="header-section-number">6.4</span> Improtant options for all chunks</h2>
<p>It is convenient to set options for all the R chunks of the document. This saves time when writing these chunks. A natural place to set these options is in a first R chunk.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">OPTION1 =</span> <span class="ot">TRUE</span><span class="op">/</span><span class="ot">FALSE</span>,
                      <span class="dt">OPTION2 =</span> <span class="ot">TRUE</span><span class="op">/</span><span class="ot">FALSE</span>,
                      ...)</code></pre></div>
<p>Important: These options are overridden by the particular chunk options.</p>
<div class="sourceCode"><pre class="sourceCode markdown"><code class="sourceCode markdown">```{r, OPTION2=FALSE}</code></pre></div>
<p>Options actually take R code. So, the following are examples that could be used to define the option.</p>
<div class="sourceCode"><pre class="sourceCode markdown"><code class="sourceCode markdown">```{r, eval=4&gt;3, echo=format(Sys.Date(), &#39;%Y-%B-%d&#39;) &gt; &#39;2019-March-10&#39;}
<span class="fu"># eval is always TRUE</span>
<span class="fu"># echo = TRUE if current date is after March 10, 2019</span>
```</code></pre></div>
<p>The list of options can be found here <a href="https://yihui.name/knitr/options/" class="uri">https://yihui.name/knitr/options/</a>. Below are some comments on some of these options (the least trivial for the author).</p>
<ul>
<li><code>collapse</code> determines whether the source code and the output should be merged into a single block. Here is the same chunk with different values of the option:</li>
</ul>
<p><code>collapse=TRUE</code></p>
<p>(If TRUE, knitr will collapse all the source and output blocks created by the chunk into a single block.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span><span class="op">+</span><span class="st"> </span><span class="dv">2</span>
<span class="co">#R&gt; [1] 4</span>
<span class="dv">3</span><span class="op">*</span><span class="st"> </span><span class="dv">5</span>
<span class="co">#R&gt; [1] 15</span></code></pre></div>
<p><code>collapse=FALSE</code></p>
<p>(If FALSE, knitr will not collapse all the source and output blocks created by the chunk into a single block.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span><span class="op">+</span><span class="st"> </span><span class="dv">2</span></code></pre></div>
<pre><code>#R&gt; [1] 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">3</span><span class="op">*</span><span class="st"> </span><span class="dv">5</span></code></pre></div>
<pre><code>#R&gt; [1] 15</code></pre>
<p>Worth noting: a <code>#</code> as a first character of the comment string (with <code>collpase=TRUE</code>) turns the output font into a comment-like text.</p>
<ul>
<li><code>comment</code> is known as a character string. Knitr will append the string to the start of each line of results in the final document</li>
</ul>
<p><code>comment='##'</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span><span class="op">+</span><span class="st"> </span><span class="dv">2</span>
## [1] 4</code></pre></div>
<p><code>comment='R&gt;'</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span><span class="op">+</span><span class="st"> </span><span class="dv">2</span>
R<span class="op">&gt;</span><span class="st"> </span>[<span class="dv">1</span>] <span class="dv">4</span></code></pre></div>
<ul>
<li><code>echo</code> determines whether to display the code in the code chunk above it’s results in the final document or not.</li>
</ul>
<p><code>echo=FALSE</code></p>
<p>If FALSE, knitr will not display the code in the code chunk above it’s results in the final document.</p>
<pre><code>#R&gt;      speed           dist       
#R&gt;  Min.   : 4.0   Min.   :  2.00  
#R&gt;  1st Qu.:12.0   1st Qu.: 26.00  
#R&gt;  Median :15.0   Median : 36.00  
#R&gt;  Mean   :15.4   Mean   : 42.98  
#R&gt;  3rd Qu.:19.0   3rd Qu.: 56.00  
#R&gt;  Max.   :25.0   Max.   :120.00</code></pre>
<p><code>echo=TRUE</code></p>
<p>If TRUE, knitr will display the code in the code chunk above it’s results in the final document.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(cars)
<span class="co">#R&gt;      speed           dist       </span>
<span class="co">#R&gt;  Min.   : 4.0   Min.   :  2.00  </span>
<span class="co">#R&gt;  1st Qu.:12.0   1st Qu.: 26.00  </span>
<span class="co">#R&gt;  Median :15.0   Median : 36.00  </span>
<span class="co">#R&gt;  Mean   :15.4   Mean   : 42.98  </span>
<span class="co">#R&gt;  3rd Qu.:19.0   3rd Qu.: 56.00  </span>
<span class="co">#R&gt;  Max.   :25.0   Max.   :120.00</span></code></pre></div>
<ul>
<li><code>child</code> allows a document to call and use another file as input in the document.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode markdown"><code class="sourceCode markdown">```{r, child=&#39;PATH/TO/OTHER/file.Rmd&#39;}</code></pre></div>
<p>The path can be either absolute or relative.<br />
For relative paths, the following applies:</p>
<ul>
<li><code>~/</code> starts a path a the root,</li>
<li><code>../</code> indicates the parent directory,</li>
<li><code>../../</code> for parent of the parent directory,</li>
<li>to move forward, start with the name of the included folder in the current directory.</li>
</ul>
</div>
<div id="latex" class="section level2">
<h2><span class="header-section-number">6.5</span> Latex code</h2>
<p>The overwhelming reason to introduce Latex code in a <code>.Rmd</code> file is for typesetting mathematical expressions.<br />
There are two main ways to type math in Latex:</p>
<ul>
<li>in the text, surrounded by special delimiters, <code>\( math \)</code> (alternatively, one can use the deprecated <code>$ math $</code>),</li>
<li>in an equation, surrounded by special delimiters, <code>\[ math equation \]</code>, or in a dedicated environment such as <code>\begin{equation} math equation \end{equation}</code> (also deprecated, <code>$$ math equation $$</code>).</li>
</ul>
<p>Math format is usually distinct from the text format. For instance, compare a<sup>2</sup> + b<sup>2</sup> = c<sup>2</sup> (simple markdown) to <span class="math inline">\(a^2 + b^2 = c^2\)</span> (Latex). Notice, however, that most mathematical symbols are not supported by markdown. This why basic knowledge of Latex is essential for producing documents with math formula.<br />
The first part of that knowledge consists in the list of Latex symbols. These are typed into a document starting with a slash <code>\</code>. For instance, the Latex symbol <span class="math inline">\(\alpha\)</span> is produced by the code <code>\alpha</code> while <span class="math inline">\(\sum\)</span> is given by <code>\sum</code>.<br />
Superscripts and subscripts are produced with the characters <code>^</code> and <code>_</code>, respectively, and the content of the super- and subscripts enclosed within <code>{ }</code>. For instance, <span class="math inline">\(x_{2}^{3}\)</span> is produced by the code <code>x_{2}^{3}</code> (or <code>x^{3}_{2}</code>) and <span class="math inline">\(\sum_{i=1}^{4}\)</span> is given by <code>\sum_{i=1}^{4}</code>.<br />
A comprehensive list of symbols (some of them requiring special Latex packages) can be found in <span class="citation">Pakin (<a href="#ref-latexlist">2009</a>)</span>. Shorter lists can be found online, including on <a href="https://oeis.org/wiki/List_of_LaTeX_mathematical_symbols">wiki</a>.<br />
A web-based application helps beginners by offering suggestions to a hand-drawn symbol, <a href="http://detexify.kirelabs.org/classify.html">detexify</a>.<br />
A second bulk in the knowledge of Latex is the understanding of special environments. But then, if a document requires lots of special Latex environments, then <code>.Rmd</code> files are not the most appropriate type of files to use.<br />
Some of these environments, however, have a perfect integration in <code>.Rmd</code> files, such as the most common, the equation. Here is an example, given by the code</p>
<div class="sourceCode"><pre class="sourceCode markdown"><code class="sourceCode markdown">\[
\sum_{i=0}^{\infty} ak^{i} = \frac{a}{1-k} \text{, for }  \lvert k \rvert &lt; 1
\]</code></pre></div>
<p><span class="math display">\[
\sum_{i=0}^{\infty} ak^{i} = \frac{a}{1-k} \text{, for }  \lvert k \rvert &lt; 1
\]</span></p>
</div>
<div id="figures" class="section level2">
<h2><span class="header-section-number">6.6</span> Figures</h2>
<p>Figures usually appear after the chunk that calls them, except on <code>.pdf</code> format because Latex makes them float and they may appear in the next page.<br />
Beyond the actual R calls that produces the figure, the figure’s appearance will be tweaked by the options specified in the R chunk. The following options are worth noticing:</p>
<ul>
<li><code>fig.width</code> and <code>fig.height</code> set in inches the graphical device size of the R plots.</li>
<li><code>out.width</code> and <code>out.height</code> set the size of the R plots, including possibly rescaled images. Easier use with percentages as <code>out-width = &quot;50%&quot;</code> means that the figure stretches over 50% of the page’s width.</li>
<li><code>fig.align</code> takes the value <code>left</code>, <code>right</code> or <code>center</code> and is self-explained.</li>
<li><code>fig.cap</code> sets the caption of the figure.</li>
<li><code>fig.show</code> takes the default value <code>asis</code> to produce the command as it is read by R. Contrast this with the value <code>hold</code> which forces R to wait until the end of the chunk to produce the plots. It may be useful to hold if one wants to put multiple plots on the same line (side-by-side).</li>
</ul>
<p>As an example, the figure below was created with the chunk options</p>
<p>Own Example for figure required</p>
</div>
<div id="cr" class="section level2">
<h2><span class="header-section-number">6.7</span> Cross-references</h2>
<p>Cross-references are references to different elements somewhere in the content such as a specific chapter, figure, equation, etc.<br />
These work under a simple rule: the element to be referenced takes a <strong>label</strong>, e.g., ‘foo’, and this label is called from anywhere in the text with the command <code>\@ref(foo)</code>.<br />
Slightly different rules apply depending on which element is to be referenced. Below is a selected list.<br />
Notice that all labels in <code>bookdown</code> can only contain alphanumeric characters, or the special characters <code>:</code>, <code>-</code>, and <code>/</code>.</p>
<div id="cr-chapters" class="section level3">
<h3><span class="header-section-number">6.7.1</span> Chapters, sections, …</h3>
<p>Headers (chapters, sections, …) have an ID that serves as a label. By default, it is formed by the words of the header in small letters separated by dashes (e.g., <code>my-great-chapter</code>). It is better practice, however, to assign a label to useful headers by appending to them the code <code>{#foo}</code> where <code>foo</code> is the chosen label for the header. This subsection, for instance, has the header</p>
<div class="sourceCode"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span class="fu">### Chapters, sections, ... {#cr-chapters}</span></code></pre></div>
<p>The cross-reference is then achieved with <code>\@ref(foo)</code>.<br />
As an example, notice that this line belongs to Subsection @ref(cr-chapters), included in Section @ref(cr) of Chapter @ref(rmd).<br />
These cross-references were obtained by the text/code:</p>
<div class="sourceCode"><pre class="sourceCode markdown"><code class="sourceCode markdown">As an example, notice that this line belongs to Subsection \@ref(cr-chapters), 
included in Section \@ref(cr) of Chapter \@ref(rmd).</code></pre></div>
<p>For <code>.html</code> formats, one may use a direct link to the header by using the format for regular links but with <code>#label</code> as the destination. For instance, since the label of this section is <code>cr</code>, the code <code>[Cross-references](#cr)</code> produces this link: <a href="#cr">Cross-references</a>.</p>
</div>
<div id="figures-1" class="section level3">
<h3><span class="header-section-number">6.7.2</span> Figures</h3>
<p>The label of a figure is given by the name of the chunk where it was created preceded by <code>fig:</code>.<br />
The chunk that created Figure @ref(fig:plot-one) had the name <code>plot-one</code>. Therefore, the cross-reference is achieved through <code>\@ref(fig:plot-one)</code>.</p>
</div>
<div id="tables" class="section level3">
<h3><span class="header-section-number">6.7.3</span> Tables</h3>
<p>The label of a table is given by the name of the chunk where it was created preceded by <code>tab:</code>.<br />
If the chunk that created a Table had the name <code>table-one</code>, then cross-reference is achieved through <code>\@ref(tab:table-one)</code>.</p>
</div>
<div id="equations" class="section level3">
<h3><span class="header-section-number">6.7.4</span> Equations</h3>
<p>As explained in Section @ref(latex), good rendering of equations requires coding in a Latex environment. For numbering of equations, various environments can be used, such as <code>equation</code>, <code>eqnarray</code>, etc.<br />
The label is then included in this environment within parentheses and by adding the prefix <code>\#eq:</code>, e.g., <code>\#eq:foo</code>.<br />
As for the cross-reference, one uses <code>\@ref(eq:foo)</code>.<br />
Below is a modified version of the equation in Section @ref(latex) to include a number and a label.<br />
This is Equation @ref(eq:series).</p>
<span class="math display">\[\begin{equation} 
\sum_{i=0}^{\infty} ak^{i} = \frac{a}{1-k} \text{, for }  \lvert k \rvert &lt; 1
  (\#eq:series)
\end{equation}\]</span>
<p>The previous lines were obtained with the code:</p>
<div class="sourceCode"><pre class="sourceCode markdown"><code class="sourceCode markdown">This is Equation \@ref(eq:series).

\begin{equation} 
\sum_{i=0}^{\infty} ak^{i} = \frac{a}{1-k} \text{, for }  \lvert k \rvert &lt; 1
  (\#eq:series)
\end{equation}</code></pre></div>
</div>
</div>
<div id="citations" class="section level2">
<h2><span class="header-section-number">6.8</span> Citations</h2>
<p>It is of utmost importance to give credit to sources. This subsection illustrates a simple way to make citations in <code>bookdown</code>. For further details, including for changing references styles, see this <a href="https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html">RStudio page</a>.<br />
The general idea is similar to the cross-references. The source has a label <code>foo</code> and the citation is made with <code>@foo</code>.<br />
There are numerous ways to tweak the format of the citation, but default format is often good enough.<br />
The citation procedure in <code>bookdown</code> is borrowed from the Latex constellation.<br />
Sources are listed in a separated bibliography file, <code>.bib</code>.<br />
For use in <code>bookdown</code>, this file must be given in the <code>YAML</code> (along with its path if it is not in the same folder) under the entry <code>bibliography</code>:</p>
<div class="sourceCode"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="ot">---</span>
<span class="fu">title:</span><span class="at"> </span><span class="st">&quot;Great title&quot;</span>
<span class="fu">output:</span><span class="at"> pdf_document</span>
<span class="fu">bibliography:</span><span class="at"> BIBLIOGRAPHY_FILE.bib</span>
<span class="ot">---</span></code></pre></div>
<p>The <code>BIBLIOGRAPHY_FILE.bib</code> is a simple text file that has one entry for each source.<br />
The format of this entry depends on the type of source (article, book, blogpost, etc). Its construction, however, is quite similar and simply requires some fields (some compulsory, other optional) such as in the following example for a book.</p>
<div class="sourceCode"><pre class="sourceCode markdown"><code class="sourceCode markdown">@book{wickham2014,
  title={Advanced {R}},
  author={Wickham, Hadley},
  year={2014},
  publisher={Chapman and Hall/CRC}
}</code></pre></div>
<p>All the fields shown (<code>title</code>, <code>author</code>, <code>year</code> and <code>publisher</code>) are required for a book. Further fields such as <code>volume</code> or <code>edition</code> would be optional.<br />
Importantly, notice the very first element in the curly brackets: that is the label of the source, freely chosen by the author.<br />
The citation of this particular book would then be made thanks to the label, with the code <code>@wickham2014</code>.<br />
A few comments are the following:</p>
<ul>
<li>a reference inside square brackets with or without a prefix and a suffix puts the citation inside parentheses: <code>[see the reference (prefix) @wickham2014 for further details (suffix)]</code> produces <span class="citation">(see the reference (prefix) Wickham <a href="#ref-wickham2014">2014</a> for further details (suffix))</span>,</li>
<li>without square brackets, no parentheses in the output,</li>
<li>multiple references are separated by a semi-column <code>;</code>: <code>[@wickham2014; @xie2015]</code>produces <span class="citation">(Wickham <a href="#ref-wickham2014">2014</a>; Xie <a href="#ref-xie2015">2015</a>)</span>,</li>
<li>a minus sign <code>-</code> in front of the <code>@</code> suppresses the name of the author in the text: <code>-@wickham2014</code> produces <span class="citation">Wickham (<a href="#ref-wickham2014">2014</a>)</span>,</li>
<li>the references are <strong>automatically</strong> put at the end of the book; the last level-one header should therefore be ‘Bibliography’ or ‘References’.</li>
</ul>
<div id="writing-.bib-entries" class="section level3">
<h3><span class="header-section-number">6.8.1</span> Writing <code>.bib</code> entries</h3>
<p>One advantage of using <code>.bib</code> files is that the fields for each entry, i.e., all the information about the source, are usually available online in the easiest of forms.<br />
The site Google Scholar, for instance, provides these entries in <code>.bib</code> form.<br />
As an example, search there the book mentioned above, e.g., “wickham advanced r”. Under each hit, there is an icon of inverted commas. By clicking it, the reference is given in different formats but also with a link to the BibTeX code (along with others). One can then simply copy this BibTex code and paste it anywhere in the bibliography file. For easier use, the label could be changed.</p>
<!--chapter:end:06-rmd_files.Rmd-->
</div>
</div>
</div>
<div id="import" class="section level1">
<h1><span class="header-section-number">7</span> Import data to R</h1>
<p>Analyzing data with R is an important part of data science. Therefore, it is vital to understand the procedure of how to import data into R. Generally speaking, the process of importing data into R is very simple. Data out there exists in many formats and there are number of ways in importing data into R. Speakin the language of R, we will need to <code>read</code> the data and put or convert it into an object, wich often is a data frame.</p>
<p>Base R has has base functions to read some types of files. For special types of files, special packages are needed.</p>
<p><strong>Important note:</strong> these base functions are introduced here for documentation purpose only.</p>
<div id="reading-rectangular-data" class="section level2">
<h2><span class="header-section-number">7.1</span> Reading rectangular data</h2>
<p>Rectangular data is intended here as a data set with values of variables in columns and each row representing a case. Arguably, this is the simplest and probably most common way to store data sets.<br />
The ad hoc function in R is <code>read.table</code>. Other similar functions exist, e.g., <code>read.csv</code>, but they are essentially a wrapper of <code>read.table</code>.<br />
This function reads rectangular data and assigns it to an object, in almost all cases a data frame. The arguments of the function are numerous are, depending on the case, potentially very useful (check <code>?read.table</code>). We mention here a few of them in the typical call:</p>
<pre class="{r"><code>my.data &lt;- read.table(`file`)</code></pre>
<p><code>file</code> is the name of the file to be read. It requires a valid path. It can also be an <code>url</code>, with some adaptations.<br />
<code>header</code> is a logical indicating whether the data’s first line gives the names of the variables.<br />
<code>sep</code> indicates the character that separates the values between columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assuming we have the file AH001.txt in the same folder</span>
df &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file=</span><span class="st">&quot;AH001.txt&quot;</span>,
                <span class="dt">header=</span><span class="ot">TRUE</span>,
                <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)
<span class="kw">head</span>(df)
<span class="co">#R&gt;   Area AreaCode AreaCode2 Grain Year Month LPrice HPrice</span>
<span class="co">#R&gt; 1   AH        1        NA    BO 1738     9     98    120</span>
<span class="co">#R&gt; 2   AH        1        NA    BO 1738    10     99    120</span>
<span class="co">#R&gt; 3   AH        1        NA    BO 1738    11    100    120</span>
<span class="co">#R&gt; 4   AH        1        NA    BO 1738    12     93    120</span>
<span class="co">#R&gt; 5   AH        1        NA    BO 1739     1     90    120</span>
<span class="co">#R&gt; 6   AH        1        NA    BO 1739     2     98    120</span></code></pre></div>
</div>
<div id="read-other-data-types" class="section level2">
<h2><span class="header-section-number">7.2</span> Read other data types</h2>
<p>R can import virtually all types of data. For special types, a ad hoc package will be necessary. <code>foreign</code> is one of them and it allows to import data from other applications. Its functions are of the form</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read.XXX</code></pre></div>
<p>where the <code>XXX</code> is an extension specific to the external software. Examples include “read.dta” for Stata data files, <code>read.spss</code> for SPSS files or <code>read.dbf</code> for dBASE files.</p>
<p>A very important data source type is Excel. Functions for this type of data are covered in Chapter @ref(readr) from the part on <code>tidyverse</code>.</p>
<p>Very often, the data source is in an Excel format, and needs to be imported into R prior to using it. Therefore, we can make use the function read.xls from the gdata package (Install the package: <em>Tools&gt; Install packages</em>). It reads the data from an Excel spreadsheet and returns a data frame.</p>
<p>The following example is an example of how to load an Excel spreadsheet named “datascienceproject.xls” into R (This method requires Perl runtime to be present in the system):</p>
<pre class="{r"><code>library(gdata)                   # loading the above mentioned gdata package 
help(read.xls)                   # documentation (help regarding read.xls) 
mydata = read.xls(&quot;datascienceproject.xls&quot;)  # read from the excel spreadsheet</code></pre>
<p>An alternative solution would be to make use of the function loadWorkbook from the XLConnect package to read the entire workbook, and then load the worksheets with readWorksheet (The XLConnect package requires the software Java to be pre-installed).</p>
<pre class="{r"><code>library(XLConnect)               # loading the above mentioned XLConnect package 
dsp1 = loadWorkbook(&quot;datascienceproject.xls&quot;) 
dsp2 = readWorksheet(dsp1, sheet=&quot;Sheet1&quot;)                # Example of reading sheet 1 of the entire worksheet.</code></pre>
<p>SPSS File For data files in the format of SPSS, it can be opened with the function read.spss, which is also part of the foreign package. There read.spss function also includes a “to.data.frame” option, in order to choose whether a data frame is to be returned. By default, it returns a list of components instead.</p>
<pre class="{r"><code>library(foreign)                 # loading the above mentioned foreign package 
help(read.spss)                  # documentation (help regarding read.spss) 
mydata = read.spss(&quot;datascienceproject&quot;, to.data.frame=TRUE)</code></pre>
<p>CSV File</p>
<p>The sample data can also be in comma separated values (CSV) format. Each cell inside such data file is separated by a special character, which usually is a comma, although other characters can be used as well.</p>
<p>The first row of the data file should contain the column names instead of the actual data. Here is a sample of the expected format.</p>
<pre class="{r"><code>Col1,Col2,Col3 
100,a1,b1 
200,a2,b2 
300,a3,b3</code></pre>
<p>After we copy and paste the data above in a file named “datascienceproject.csv” with a text editor, we can read the data with the function read.csv.</p>
<pre class="{r"><code>datascienceproject = read.csv(&quot;datascienceproject.csv&quot;)  # read the csv file 
mydata 
  Col1 Col2 Col3 
1  100   a1   b1 
2  200   a2   b2 
3  300   a3   b3

help(read.csv)            # If help is required for the read.csv function</code></pre>
<p>Working Directory</p>
<p>Finally, the code samples above assume the data files are located in the R working directory, which can be found with the function getwd.</p>
<pre class="{r"><code>getwd()               # get current working directory</code></pre>
<p>You can select a different working directory with the function setwd(), and thus avoid entering the full path of the data files.</p>
<pre class="{r"><code>setwd(&quot;&lt;new path&gt;&quot;)   # set working directory</code></pre>
<p>Note that the forward slash should be used as the path separator even on Windows platform.</p>
<pre class="{r"><code>setwd(&quot;C:/MyDoc&quot;)</code></pre>
</div>
<div id="scanning-a-file" class="section level2">
<h2><span class="header-section-number">7.3</span> Scanning a file</h2>
<p>The base function <code>scan</code> can sometimes be useful, though it is not used to import data. <code>scan()</code> imports to a vector (or a list), which can then be used.</p>
<ul>
<li><code>what</code> gives the type of vector to be imported.<br />
</li>
<li><code>skip</code> is the number of lines to be skipped in the file.<br />
</li>
<li><code>nlines</code> determines the number of lines to be read and imported.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">what=</span><span class="kw">character</span>())
<span class="co">#df</span>
df &lt;-<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">what=</span><span class="kw">character</span>(), <span class="dt">skip=</span><span class="dv">1</span>, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)
<span class="co">#df</span>
given.line &lt;-<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">what=</span><span class="kw">character</span>(), <span class="dt">nlines=</span><span class="dv">1</span>, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)
given.line
<span class="co">#R&gt; [1] &quot;Area&quot;      &quot;AreaCode&quot;  &quot;AreaCode2&quot; &quot;Grain&quot;     &quot;Year&quot;      &quot;Month&quot;    </span>
<span class="co">#R&gt; [7] &quot;LPrice&quot;    &quot;HPrice&quot;</span></code></pre></div>
<!--chapter:end:07-import.Rmd-->
</div>
</div>
<div id="custom-ouptut" class="section level1">
<h1><span class="header-section-number">8</span> Customize output</h1>
<p>This chapter is about choosing and/or modifying the way the output file looks like. If you do not select a format, R Markdown renders the file to its default format, which you can set in the output field of a .Rmd file’s header.</p>
<p>The RStudio knit button renders a file to the first format listed in its output field. You can render to additional formats by clicking the dropdown menu beside the knit button.</p>
<p>Set the output_format argument of render to render your .Rmd file into any of R Markdown’s supported formats. For example, the chunk below renders this .Rmd file to a HTML document.</p>
<pre><code>library(rmarkdown)
render(&quot;customize_output.Rmd&quot;, output_format = &quot;html_document&quot;)</code></pre>
<div id="multiple-built-in-output-types" class="section level2">
<h2><span class="header-section-number">8.1</span> Multiple built-in output types</h2>
<p>However, there are a variety of output possibilities and formats that can be individually adapted to the user. In general, different formats offer advantages and disadvantages when compared with each other.</p>
<p>The following output formats are available to use with R Markdown: “html_notebook”&quot; - Interactive R Notebooks “html_document” - HTML document w/ Bootstrap CSS “pdf_document” - PDF document (via LaTeX template) “word_document” - Microsoft Word document (docx) “odt_document” - OpenDocument Text document “rtf_document” - Rich Text Format document “md_document” - Markdown document (various flavors)</p>
<p>Each output format is implemented as a function in R. You can customize the output by passing arguments to the function as sub-values of the output field. To learn which arguments a format takes, read the format’s help page in R, e.g. ?pdf_document.</p>
<p>If a certain option has sub-options (which means the value of this option is a list in R), the sub-options need to be further indented, e.g.:</p>
<p>output: html_document: toc: true includes: in_header: header.html before_body: before.html</p>
<p>Furthermore, there are several additional output formats that are suitable for special situations, such as slide presentations, dashboards, websites and interactive documents.</p>
<p>A helpful overview of formats and other useful information can be found in the official cheatsheet, available in RStudio at: Go to File &gt; Help &gt; Cheatsheets &gt; R Markdown Cheat Sheet to open the main R Markdown cheatsheet, pictured above</p>
<p>Additionally, general information about the structure of a rmd in RStudio can be accessed via the Quick Reference: Go to File &gt; Help &gt; Markdown Quick Reference to open the Markdown Quick Reference in your help pane.</p>
</div>
<div id="new-types-provided-by-packages" class="section level2">
<h2><span class="header-section-number">8.2</span> New types provided by packages</h2>
<p>Packages are bundles of code which extend the functionality of RStudio and R.</p>
<p>Anyone can make an R package, and anyone can install anyone else’s R package (if they make it available). This is part of the open source world, and using different R packages is essential to modern R workflows.</p>
<p>You can get packages from many different places, but the most common one: CRAN. CRAN is the Comprehensive R Archive Network, a global network of servers which make available for download a set of vetted R packages.</p>
<p>Most packages need to be loaded into the current environment to be accessible. RMarkdown is specially integrated in RStudio in a way that avoids this, but in general you should load packages with the library command:</p>
<pre><code>library(name_of_the_package)
</code></pre>
</div>
<div id="css-custom-html" class="section level2">
<h2><span class="header-section-number">8.3</span> CSS: custom html</h2>
<p>Shiny apps use an HTML interface, which means that you can change the visual appearance of your apps quickly and simply with CSS files. You can use CSS to customize the typefaces used in dygraph labels. In example CSS is used to make the main label bold and to reduce the size of the typefaces used on the axes:</p>
<p>``` .dygraph-title { color: navy; font-weight: bold; } .dygraph-axis-label { font-size: 11px; }</p>
<p>dygraph(nhtemp, main = “New Haven Temperatures”) %&gt;% dyCSS(“dygraph.css”) ``</p>
</div>
<div id="latex-preamble" class="section level2">
<h2><span class="header-section-number">8.4</span> Latex preamble</h2>
<p>This file is added to the preamble of the Latex file to modify how the <code>.pdf</code> output is compiled.<br />
Literally, these commands are placed in the Latex file before the self-explaining command:</p>
<div class="sourceCode"><pre class="sourceCode latex"><code class="sourceCode latex"><span class="kw">\begin</span>{<span class="ex">document</span>}</code></pre></div>
<p>The most common commands call the packages to be used in the compilation of the Latex file, e.g.,</p>
<div class="sourceCode"><pre class="sourceCode latex"><code class="sourceCode latex"><span class="bu">\usepackage</span>{<span class="ex">multirow</span>}</code></pre></div>
<p>Each package, in turn, includes a set of functions that can be used in the file to produce some particular output.<br />
The other set of commands are typically definitions of new commands or environments as well as redefinitions of existing commands to produced a special output.</p>
<div class="sourceCode"><pre class="sourceCode latex"><code class="sourceCode latex"><span class="bu">\usepackage</span>{<span class="ex">totcount</span>}
<span class="fu">\regtotcounter</span>{section}
<span class="fu">\makeatletter</span>
    <span class="fu">\renewcommand</span>{<span class="ex">\thesection</span>}{<span class="fu">\number\numexpr\c@section@totc</span>-<span class="fu">\c@section+</span>1<span class="fu">\relax</span>}
<span class="fu">\makeatother</span></code></pre></div>
<!--chapter:end:08-customize_output.Rmd-->
</div>
</div>
<div id="datastructures" class="section level1">
<h1><span class="header-section-number">9</span> Data stuctures</h1>
<p>This chapter lists the most common objects to store data. To make the best of the R language, you need a strong understanding of the basic data types and data structures and how to operate on those.</p>
<p>It is very important to understand because these are the objects to manipulate on a day-to-day basis in R. Dealing with object conversions is one of the most common sources of frustration for beginners.</p>
<p>To understand computations in R, two slogans are helpful:</p>
<p>Everything that exists is an object. Everything that happens is a function call.</p>
<div id="atomic-vectors" class="section level2">
<h2><span class="header-section-number">9.1</span> Atomic vectors</h2>
<p>The basic data structure in R is the vector. Vectors have three characteristics:</p>
<ul>
<li>a type, <code>typeof()</code>,</li>
<li>a length, <code>length()</code>,</li>
<li>some attributes, <code>attributes()</code>.</li>
</ul>
<p>To illustrate:</p>
<p>typeof() # what is it? length() # how long is it? What about two dimensional objects? attributes() # does it have any metadata?</p>
<p>e.g.:</p>
<pre><code>x &lt;- &quot;dataset&quot;
typeof(x)
attributes(x)

y &lt;- 1:10
typeof(y)
length(y)
attributes(y)

z &lt;- c(1L, 2L, 3L)
typeof(z)
</code></pre>
<div id="types-of-data" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Types of data</h3>
<p>There are five common types of atomic vectors:</p>
<ul>
<li>logical,</li>
<li>complex</li>
<li>integer,</li>
<li>double (often called numeric- real or decimal),</li>
<li>character.</li>
</ul>
<p>Note that if vector elements not all of the same type, R makes coercion. In that case, the order becomes: “logical &lt; numeric &lt; character”.</p>
<p>Here are a few illustrations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># logical vector</span>
log_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)
log_vector
<span class="co">#R&gt; [1]  TRUE FALSE FALSE</span>

<span class="co"># numeric vector</span>
num_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">10</span>, <span class="dv">3</span>)
<span class="kw">typeof</span>(num_vector)
<span class="co">#R&gt; [1] &quot;double&quot;</span>

<span class="co"># integer vector</span>
int_vector &lt;-<span class="st"> </span><span class="kw">c</span>(12L, 10L, 3L)
<span class="kw">typeof</span>(int_vector)
<span class="co">#R&gt; [1] &quot;integer&quot;</span>


<span class="co"># character vector</span>
chr_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)
<span class="kw">typeof</span>(chr_vector)
<span class="co">#R&gt; [1] &quot;character&quot;</span>

<span class="co"># mixed types vector</span>
mix_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="st">&quot;a&quot;</span>)
<span class="kw">is.numeric</span>(mix_vector)
<span class="co">#R&gt; [1] FALSE</span>
<span class="kw">typeof</span>(mix_vector)
<span class="co">#R&gt; [1] &quot;character&quot;</span></code></pre></div>
<p>Numeric vectors can be created with the shortcut <code>:</code>, which is used to imply all the integers from the number on the left of <code>:</code> to the number on its right. Even if it is not good practice, these do not require the <code>c()</code> call.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vector_A &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span>
vector_A
<span class="co">#R&gt; [1] 1 2 3 4 5</span>
<span class="kw">length</span>(vector_A)
<span class="co">#R&gt; [1] 5</span></code></pre></div>
</div>
<div id="factor-vector" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Factor vector</h3>
<p>This is a special type of vector. It has a limited number of values, called levels. These levels can be unordered (e.g., gender is either “Female” or “Male”) or ordered (e.g. school level is “Primary”, “Secondary”, “Tertiary”)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gender &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>))
gender
<span class="co">#R&gt; [1] Male   Male   Female Male   Female Female Male  </span>
<span class="co">#R&gt; Levels: Female Male</span>
<span class="kw">levels</span>(gender)
<span class="co">#R&gt; [1] &quot;Female&quot; &quot;Male&quot;</span>
<span class="kw">summary</span>(gender)
<span class="co">#R&gt; Female   Male </span>
<span class="co">#R&gt;      3      4</span>
school &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Tertiary&quot;</span>),
                    <span class="dt">ordered=</span><span class="ot">TRUE</span>)
school
<span class="co">#R&gt; [1] Primary   Secondary Tertiary </span>
<span class="co">#R&gt; Levels: Primary &lt; Secondary &lt; Tertiary</span>

school2 &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>,<span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Tertiary&quot;</span>),
                    <span class="dt">labels=</span><span class="kw">c</span>( <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Tertiary&quot;</span>,<span class="st">&quot;Primary&quot;</span>),
                    <span class="dt">ordered=</span><span class="ot">TRUE</span>)
school2
<span class="co">#R&gt; [1] Secondary Tertiary  Tertiary  Primary  </span>
<span class="co">#R&gt; Levels: Secondary &lt; Tertiary &lt; Primary</span></code></pre></div>
</div>
</div>
<div id="matrices-and-arrays" class="section level2">
<h2><span class="header-section-number">9.2</span> Matrices and arrays</h2>
<p>Matrices are a special vector in R. They are not a separate type of object but simply an atomic vector with dimensions added on to it. Matrices have rows and columns. However R is not often used for matrices calculations: it is too slow for that and there are better programs for it out there (e.g. Matlab).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># populate a matrix with the elements in of the vector, and give the dimensions</span>
M &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">8</span>), <span class="dt">nrow=</span><span class="dv">3</span>, <span class="dt">ncol=</span><span class="dv">2</span>) 
M
<span class="co">#R&gt;      [,1] [,2]</span>
<span class="co">#R&gt; [1,]    4    3</span>
<span class="co">#R&gt; [2,]    1    6</span>
<span class="co">#R&gt; [3,]    0    8</span></code></pre></div>
<p>If we think of a matrix as a 2 dimensions vector, then arrays are <span class="math inline">\(n\)</span> dimensions vectors. Is it important? It might be in some very specific cases.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mya &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dt">data=</span><span class="dv">1</span><span class="op">:</span><span class="dv">18</span>, <span class="dt">dim=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>))
mya
<span class="co">#R&gt; , , 1</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt;      [,1] [,2] [,3]</span>
<span class="co">#R&gt; [1,]    1    3    5</span>
<span class="co">#R&gt; [2,]    2    4    6</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; , , 2</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt;      [,1] [,2] [,3]</span>
<span class="co">#R&gt; [1,]    7    9   11</span>
<span class="co">#R&gt; [2,]    8   10   12</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; , , 3</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt;      [,1] [,2] [,3]</span>
<span class="co">#R&gt; [1,]   13   15   17</span>
<span class="co">#R&gt; [2,]   14   16   18</span></code></pre></div>
</div>
<div id="lists" class="section level2">
<h2><span class="header-section-number">9.3</span> Lists</h2>
<p>These are the one-size fit all structure… A list is an object composed of any other object, even… another list! Very useful data structure!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">school&lt;-<span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Tertiary&quot;</span>), <span class="dt">ordered=</span><span class="ot">TRUE</span>)
mylist &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">numbers=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">60</span>),
                <span class="dt">somenames=</span><span class="kw">c</span>(<span class="st">&quot;Jim&quot;</span>,<span class="st">&quot;Jules&quot;</span>),
                <span class="dt">results=</span> <span class="kw">c</span>(T,F,F,T),
                <span class="dt">school=</span>school)
mylist
<span class="co">#R&gt; $numbers</span>
<span class="co">#R&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23</span>
<span class="co">#R&gt; [24] 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46</span>
<span class="co">#R&gt; [47] 47 48 49 50 51 52 53 54 55 56 57 58 59 60</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $somenames</span>
<span class="co">#R&gt; [1] &quot;Jim&quot;   &quot;Jules&quot;</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $results</span>
<span class="co">#R&gt; [1]  TRUE FALSE FALSE  TRUE</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $school</span>
<span class="co">#R&gt; [1] Primary   Secondary Tertiary </span>
<span class="co">#R&gt; Levels: Primary &lt; Secondary &lt; Tertiary</span>

<span class="co"># change the names of the elements of the list</span>
<span class="kw">names</span>(mylist) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;O&quot;</span>,<span class="st">&quot;R&quot;</span>,<span class="st">&quot;S&quot;</span>)</code></pre></div>
</div>
<div id="data-frames" class="section level2">
<h2><span class="header-section-number">9.4</span> Data frames</h2>
<p>Data frames are the second most important data structure in R. We can think of it as a better version of a data set in Excel. It stacks together observations over many variables, each of these variables being a vector. A data frame is a special type of list where every element of the list has same length.</p>
<p>Data frames can have additional attributes such as rownames(), which can be useful for annotating data, like subject_id or sample_id. But most of the time they are not used.</p>
<p>Some additional information on data frames:</p>
<p>Usually created by read.csv() and read.table(). Can convert to matrix with data.matrix() Coercion will be forced and not always what you expect. Can also create with data.frame() function. Find the number of rows and columns with nrow(df) and ncol(df), respectively. Rownames are usually 1..n.</p>
<p>e.g.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># mtcars is a built-in data set</span>
<span class="kw">data</span>(mtcars)
<span class="kw">class</span>(mtcars)
<span class="co">#R&gt; [1] &quot;data.frame&quot;</span>
mtcars
<span class="co">#R&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#R&gt; Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="co">#R&gt; Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="co">#R&gt; Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="co">#R&gt; Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="co">#R&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="co">#R&gt; Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="co">#R&gt; Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4</span>
<span class="co">#R&gt; Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2</span>
<span class="co">#R&gt; Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2</span>
<span class="co">#R&gt; Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4</span>
<span class="co">#R&gt; Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4</span>
<span class="co">#R&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3</span>
<span class="co">#R&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3</span>
<span class="co">#R&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3</span>
<span class="co">#R&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4</span>
<span class="co">#R&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="co">#R&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4</span>
<span class="co">#R&gt; Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span>
<span class="co">#R&gt; Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2</span>
<span class="co">#R&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1</span>
<span class="co">#R&gt; Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1</span>
<span class="co">#R&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2</span>
<span class="co">#R&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2</span>
<span class="co">#R&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4</span>
<span class="co">#R&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2</span>
<span class="co">#R&gt; Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1</span>
<span class="co">#R&gt; Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2</span>
<span class="co">#R&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2</span>
<span class="co">#R&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4</span>
<span class="co">#R&gt; Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</span>
<span class="co">#R&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8</span>
<span class="co">#R&gt; Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</span>
<span class="kw">head</span>(mtcars)
<span class="co">#R&gt;                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#R&gt; Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="co">#R&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="co">#R&gt; Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="co">#R&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="co">#R&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="co">#R&gt; Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="kw">str</span>(mtcars)
<span class="co">#R&gt; &#39;data.frame&#39;:   32 obs. of  11 variables:</span>
<span class="co">#R&gt;  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span>
<span class="co">#R&gt;  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...</span>
<span class="co">#R&gt;  $ disp: num  160 160 108 258 360 ...</span>
<span class="co">#R&gt;  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...</span>
<span class="co">#R&gt;  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...</span>
<span class="co">#R&gt;  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...</span>
<span class="co">#R&gt;  $ qsec: num  16.5 17 18.6 19.4 17 ...</span>
<span class="co">#R&gt;  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...</span>
<span class="co">#R&gt;  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...</span>
<span class="co">#R&gt;  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...</span>
<span class="co">#R&gt;  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</span>

<span class="co"># names of the variables in the data frame</span>
<span class="kw">names</span>(mtcars) 
<span class="co">#R&gt;  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;</span>
<span class="co">#R&gt; [11] &quot;carb&quot;</span>
<span class="kw">length</span>(mtcars)
<span class="co">#R&gt; [1] 11</span>
<span class="kw">nrow</span>(mtcars)
<span class="co">#R&gt; [1] 32</span></code></pre></div>
<div id="data-frame-creation" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Data frame creation</h3>
<p>A data frame can be created manually by providing the function <code>data.frame</code> with the corresponding vectors or with the use of one method above. The vectors should be of same length, otherwise R recycles values. The data frame requires a name for each vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">let=</span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>],
                 <span class="dt">num1=</span><span class="dv">10</span><span class="op">:</span><span class="dv">16</span>, 
                 <span class="dt">num2=</span><span class="kw">floor</span>(<span class="kw">rnorm</span>(<span class="dv">7</span>,<span class="dv">100</span>,<span class="dv">10</span>)))
df
<span class="co">#R&gt;   let num1 num2</span>
<span class="co">#R&gt; 1   A   10   99</span>
<span class="co">#R&gt; 2   B   11  100</span>
<span class="co">#R&gt; 3   C   12  101</span>
<span class="co">#R&gt; 4   D   13  109</span>
<span class="co">#R&gt; 5   E   14  102</span>
<span class="co">#R&gt; 6   F   15   94</span>
<span class="co">#R&gt; 7   G   16  113</span>
<span class="kw">names</span>(df)
<span class="co">#R&gt; [1] &quot;let&quot;  &quot;num1&quot; &quot;num2&quot;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">students &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">name=</span> <span class="kw">c</span>(<span class="st">&quot;tr&quot;</span>, <span class="st">&quot;ga&quot;</span>, <span class="st">&quot;mi&quot;</span>, <span class="st">&quot;st&quot;</span>, <span class="st">&quot;eb&quot;</span>, <span class="st">&quot;ha&quot;</span>, <span class="st">&quot;fo&quot;</span>, <span class="st">&quot;fi&quot;</span>),
                       <span class="dt">age=</span><span class="kw">c</span>(<span class="dv">23</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">33</span>, <span class="dv">28</span>, <span class="dv">24</span>, <span class="dv">33</span>, <span class="dv">41</span>),
                       <span class="dt">like=</span> <span class="kw">c</span>(T, T, T, T, F, F, T, T)) 
students
<span class="co">#R&gt;   name age  like</span>
<span class="co">#R&gt; 1   tr  23  TRUE</span>
<span class="co">#R&gt; 2   ga  23  TRUE</span>
<span class="co">#R&gt; 3   mi  24  TRUE</span>
<span class="co">#R&gt; 4   st  33  TRUE</span>
<span class="co">#R&gt; 5   eb  28 FALSE</span>
<span class="co">#R&gt; 6   ha  24 FALSE</span>
<span class="co">#R&gt; 7   fo  33  TRUE</span>
<span class="co">#R&gt; 8   fi  41  TRUE</span></code></pre></div>
<p>Useful functions:</p>
<p>head() - see first 6 rows tail() - see last 6 rows dim() - see dimensions nrow() - number of rows ncol() - number of columns str() - structure of each column names() - will list the names attribute for a data frame (or any object really), which gives the column names.</p>
</div>
<div id="data-frame-combination" class="section level3">
<h3><span class="header-section-number">9.4.2</span> Data frame combination</h3>
<p>Example for data set combination:</p>
<pre><code>df &lt;- data.frame(id = letters[1:10], x = 1:10, y = rnorm(10))
df</code></pre>
<pre><code> id x       y</code></pre>
<p>1 a 1 -1.37593 2 b 2 0.47094 3 c 3 -0.16046 4 d 4 -1.36914 5 e 5 0.39763 6 f 6 -1.92516 7 g 7 0.04107 8 h 8 -1.04832 9 i 9 -0.16875 10 j 10 0.82251</p>
<p>`<code>cbind(df, data.frame(z = 4))</code></p>
<pre><code> id x    y    z</code></pre>
<p>1 a 1 -1.37593 4 2 b 2 0.47094 4 3 c 3 -0.16046 4 4 d 4 -1.36914 4 5 e 5 0.39763 4 6 f 6 -1.92516 4 7 g 7 0.04107 4 8 h 8 -1.04832 4 9 i 9 -0.16875 4 10 j 10 0.82251 4</p>
</div>
</div>
<div id="a-word-about-attributes" class="section level2">
<h2><span class="header-section-number">9.5</span> A word about attributes</h2>
<p>Attributes are important characteristics of vectors (and other data structures).<br />
They can be seen as some meta data that defines the nature of the object. This is to say that a given attribute can determine how a function applies to an object. Here are three important attributes:</p>
<ul>
<li>the names, <code>names()</code>,</li>
<li>the dimensions, <code>dim()</code>,</li>
<li>the class, <code>class</code>.</li>
</ul>
<p>To illustrate the use of attributes, recall the case of a factor vector. The fact that the vector on which it builds is given the attribute of a class (factor) turns that vector into a special one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.7</span>, <span class="fl">1.3</span>, <span class="dv">4</span>, <span class="fl">3.3</span>, <span class="fl">3.3</span>, <span class="dv">2</span>, <span class="fl">2.3</span>, <span class="fl">2.3</span>)
vec
<span class="co">#R&gt; [1] 1.7 1.3 4.0 3.3 3.3 2.0 2.3 2.3</span>
<span class="kw">table</span>(vec)
<span class="co">#R&gt; vec</span>
<span class="co">#R&gt; 1.3 1.7   2 2.3 3.3   4 </span>
<span class="co">#R&gt;   1   1   1   2   2   1</span>

vec.f &lt;-<span class="st"> </span><span class="kw">factor</span>(vec,
                <span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">1.3</span>, <span class="fl">1.7</span>, <span class="dv">2</span>, <span class="fl">2.3</span>, <span class="fl">2.7</span>, <span class="dv">3</span>, <span class="fl">3.3</span>, <span class="fl">3.7</span>, <span class="dv">4</span>, <span class="dv">5</span>),
                <span class="dt">ordered=</span><span class="ot">TRUE</span>)
vec.f
<span class="co">#R&gt; [1] 1.7 1.3 4   3.3 3.3 2   2.3 2.3</span>
<span class="co">#R&gt; Levels: 1 &lt; 1.3 &lt; 1.7 &lt; 2 &lt; 2.3 &lt; 2.7 &lt; 3 &lt; 3.3 &lt; 3.7 &lt; 4 &lt; 5</span>
<span class="kw">table</span>(vec.f)
<span class="co">#R&gt; vec.f</span>
<span class="co">#R&gt;   1 1.3 1.7   2 2.3 2.7   3 3.3 3.7   4   5 </span>
<span class="co">#R&gt;   0   1   1   1   2   0   0   2   0   1   0</span></code></pre></div>
</div>
<div id="environments" class="section level2">
<h2><span class="header-section-number">9.6</span> Environments</h2>
<p>An environment is similar to a bag/list of names. It can be seen as the space were these names “live”.<br />
Environments can include environments. In that case, the enclosing environment is called the parent environment.<br />
The most common environment is the <code>globalenv()</code> also called the <code>workspace</code>.</p>
<!--chapter:end:09-data_structures.Rmd-->
</div>
<div id="head" class="section level2">
<h2><span class="header-section-number">9.7</span> &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</h2>
<p>output: pdf_document: default html_document: default — # (PART) R Basics {-}</p>
</div>
</div>
<div id="rcalc" class="section level1">
<h1><span class="header-section-number">10</span> R as a calculator</h1>
<p>R can also be used as a simple calculator. For instance, 25+12=37.</p>
<p>Here are a few more examples of how R can be used as a calculator with different commands:</p>
<div id="usual-operators" class="section level2">
<h2><span class="header-section-number">10.1</span> Usual operators</h2>
<div id="simple-operations" class="section level3">
<h3><span class="header-section-number">10.1.1</span> Simple operations</h3>
<p>The usual symbols <code>+, -, *, /</code> apply .</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span>
<span class="co">#R&gt; [1] 8</span>
<span class="dv">56</span><span class="op">/</span><span class="st"> </span><span class="dv">6</span>
<span class="co">#R&gt; [1] 9.333333</span></code></pre></div>
</div>
</div>
<div id="order-of-operations" class="section level2">
<h2><span class="header-section-number">10.2</span> Order of operations</h2>
<p>The order of arithmetic operations is determined by the PEMDAS (Parenthesis, exponents, multiplication, division, addition, subtraction) convention, which implies that parentheses get highest priority, followed by exponentiation, followed by multiplication and division, followed by addition and subtraction. The second example of using R in the calculator mode is listed below:</p>
<pre class="{r"><code>4 + 9 * 6 # PEMDAS (Multiplication before addition)</code></pre>
<p>[1] 58</p>
<p>For R operations, it is not necessary to use an equal sign is. The return key serves that role and gives you the result of the operation As you can see above, the response from R is [1] 58, which shows you that R made use of the PEMDAS convention (Multiplication before addition). The [1] that appears before the 38 indicates that the result is a vector of length one. More details on vectors will be given in the final chapter of the book.</p>
<p>Operation without making use of spaces:</p>
<pre class="{r"><code>&gt; 5+9*6 # no spaces
[1] 58</code></pre>
<p>This still works, yet you could imagine how difficult this would be to read if it was 40 or 50 characters long.</p>
</div>
<div id="number-of-digits-displayed" class="section level2">
<h2><span class="header-section-number">10.3</span> Number of digits displayed</h2>
<p>The default number of digits displayed in R is seven digits. Yet, R must make the decision on how many digits to display. Therefore, the number of digits shown can be altered, as shown below (Important: R does not include commas to separate groups of three digits when displaying the result):</p>
<pre class="{r"><code>10 * 10 ˆ 3 # exponentiation first</code></pre>
<p>[1] 10000</p>
<p>Now consider a calculation of larger numbers.</p>
<pre class="{r"><code>55555555 * 55555555 # result in scientific notation
[1] 3.08642e+15</code></pre>
<p>The result of this calculation is expressed in scientific notation: 3.08642 · 1015. With only seven digits displayed, it is not possible to know the exact value of the product.</p>
<p>By default, R displays seven digits, but more digits are stored. As an illustration, the built-in constant π is designated with pi.</p>
<pre class="{r"><code>pi # built in constant</code></pre>
<p>[1] 3.141593</p>
<div id="parentheses" class="section level3">
<h3><span class="header-section-number">10.3.1</span> Parentheses</h3>
<p>Parentheses are or can be used to alter the order of operations. But they are also a common source of error when they are not matched.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dv">4</span><span class="op">+</span><span class="dv">3</span>)<span class="op">*</span>((<span class="dv">7</span><span class="op">-</span><span class="dv">3</span>)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>.<span class="dv">05</span>))
<span class="co">#R&gt; [1] 26.66667</span></code></pre></div>
<p>The next expression will generate an error and prevent the compilation of the whole book.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dv">4</span><span class="op">+</span><span class="dv">3</span>)<span class="op">*</span>((<span class="dv">7</span><span class="op">-</span><span class="dv">3</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>.<span class="dv">05</span>))</code></pre></div>
<p>Other examples of different orders through adding parantheses:</p>
<pre class="{r"><code>5 + (6 / 7) ˆ 2 # division first, then exponentiation, then addition</code></pre>
<p>[1] 5.73</p>
<pre class="{r"><code>(2 + 1) / 5 ˆ 2 # addition first, then exponentiation, then division</code></pre>
<p>[1] 0.12</p>
<pre class="{r"><code>(9 + 3 / 4) ˆ 2 # division first, then addition, then exponentiation</code></pre>
<p>[1] 95.06</p>
<pre class="{r"><code>((4 + 7) / 10) ˆ 2 # addition first, then division, then exponentiation</code></pre>
<p>[1] 1.21</p>
</div>
<div id="exponents" class="section level3">
<h3><span class="header-section-number">10.3.2</span> Exponents</h3>
<p>There are two ways of expressing the power of a number: <code>^</code> and <code>**</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">3</span><span class="op">^</span><span class="dv">4</span>
<span class="co">#R&gt; [1] 81</span>
<span class="dv">3</span><span class="op">**</span><span class="dv">4</span>
<span class="co">#R&gt; [1] 81</span></code></pre></div>
</div>
</div>
<div id="unusual-operators" class="section level2">
<h2><span class="header-section-number">10.4</span> Unusual operators</h2>
<div id="special-operations" class="section level3">
<h3><span class="header-section-number">10.4.1</span> Special operations</h3>
<p>The symbols <code>%/%</code> and <code>%%</code> return the entire part of the result of the division and the rest of the division, respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">56</span><span class="op">/</span><span class="dv">6</span>
<span class="co">#R&gt; [1] 9.333333</span>
<span class="dv">56</span><span class="op">%/%</span><span class="dv">6</span>
<span class="co">#R&gt; [1] 9</span>
<span class="dv">56</span><span class="op">%%</span><span class="dv">6</span>
<span class="co">#R&gt; [1] 2</span></code></pre></div>
</div>
</div>
<div id="usual-functions" class="section level2">
<h2><span class="header-section-number">10.5</span> Usual functions</h2>
<p>The common functions found in any calculator also have an equivalent on R. The following examples need no further comment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">log</span>(<span class="dv">100</span>)
<span class="co">#R&gt; [1] 4.60517</span>
<span class="kw">sqrt</span>(<span class="dv">100</span>)
<span class="co">#R&gt; [1] 10</span></code></pre></div>
</div>
<div id="unusual-functions" class="section level2">
<h2><span class="header-section-number">10.6</span> Unusual functions</h2>
<p>There are several other functions applied to numbers that one does not usually find in a calculator.<br />
A few examples below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># floor / ceiling for the closest integer</span>
<span class="kw">floor</span>(<span class="fl">13.47</span>)
<span class="co">#R&gt; [1] 13</span>
<span class="kw">ceiling</span>(<span class="fl">13.47</span>)
<span class="co">#R&gt; [1] 14</span></code></pre></div>
<!--chapter:end:10-calculator.Rmd-->
</div>
</div>
<div id="simple-functions-on-vectors" class="section level1">
<h1><span class="header-section-number">11</span> Simple functions on vectors</h1>
<p>In this section, we illustrate calculations with a single vector.</p>
<div id="element-by-element-evaluation" class="section level2">
<h2><span class="header-section-number">11.1</span> Element by element evaluation</h2>
<p>The main point to notice is how these functions are carried <strong>element by element</strong>. This means that the function is typically applied for each element individually and in sequence.</p>
<p>The following simple example illustrates this procedure and emphasizes the effect on the length of the vectors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create two numeric vector of same length</span>
visits1 &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">2</span>, <span class="dv">45</span>, <span class="dv">75</span>, <span class="dv">65</span>, <span class="dv">11</span>, <span class="dv">3</span>)
visits2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">23</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">78</span>, <span class="dv">12</span>, <span class="dv">0</span>, <span class="dv">200</span>)
<span class="kw">length</span>(visits1)
<span class="co">#R&gt; [1] 7</span>
<span class="kw">length</span>(visits1) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(visits2)
<span class="co">#R&gt; [1] TRUE</span>

total &lt;-<span class="st"> </span>visits1 <span class="op">+</span><span class="st"> </span>visits2
<span class="co"># their sum is the vector of same length, with the element by element sums</span>

<span class="kw">length</span>(total)
<span class="co">#R&gt; [1] 7</span>
total
<span class="co">#R&gt; [1]  35   6  50 153  77  11 203</span></code></pre></div>
<p>Another clear example with the function <code>^2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">total.p2 &lt;-<span class="st"> </span>total<span class="op">^</span><span class="dv">2</span>
total.p2
<span class="co">#R&gt; [1]  1225    36  2500 23409  5929   121 41209</span>

(trop &lt;-<span class="st"> </span>total <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)
<span class="co">#R&gt; [1]  33   4  48 151  75   9 201</span>
<span class="kw">length</span>(trop)
<span class="co">#R&gt; [1] 7</span></code></pre></div>
</div>
<div id="recycling-rule" class="section level2">
<h2><span class="header-section-number">11.2</span> Recycling rule</h2>
<p>With the emphasis on the length of the vectors above, one could wonder what happens when vectors’ length differ. This is an important point to remember: the shortest vector has its elements <strong>recycled</strong> as much as it is necessary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">34</span>, <span class="dv">50</span>)
l2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">3</span>)
tt &lt;-<span class="st"> </span>l3 <span class="op">+</span><span class="st"> </span><span class="dv">5</span>
tt
<span class="co">#R&gt; [1] 17 39 55</span>

ltotal &lt;-<span class="st"> </span>l3<span class="op">+</span>l2 <span class="co"># recycling!!!</span>
<span class="co">#R&gt; Warning in l3 + l2: longer object length is not a multiple of shorter</span>
<span class="co">#R&gt; object length</span>
ltotal
<span class="co">#R&gt; [1] 22 37 60</span></code></pre></div>
</div>
<div id="functions-for-the-whole-vector" class="section level2">
<h2><span class="header-section-number">11.3</span> Functions for the whole vector</h2>
<p>Some functions are meant to be applied to whole vector and do not necessarily return a vector of the same length of the vector to which it is applied.<br />
Here is an illustration of some of these functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">28</span>, <span class="dv">33</span>, <span class="dv">39</span>, <span class="dv">56</span>, <span class="dv">34</span>, <span class="dv">45</span>, <span class="dv">27</span>, <span class="dv">40</span>)
ages
<span class="co">#R&gt; [1] 28 33 39 56 34 45 27 40</span>
<span class="kw">max</span>(ages)
<span class="co">#R&gt; [1] 56</span>
<span class="kw">sum</span>(ages)
<span class="co">#R&gt; [1] 302</span>
<span class="kw">length</span>(ages)
<span class="co">#R&gt; [1] 8</span>

ages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">28</span>, <span class="dv">33</span>, <span class="dv">39</span>, <span class="dv">56</span>, <span class="dv">34</span>, <span class="dv">45</span>, <span class="dv">27</span>, <span class="dv">40</span>, <span class="ot">NA</span>)
<span class="kw">mean</span>(ages)
<span class="co">#R&gt; [1] NA</span>

<span class="co"># for help on a command, simply type ? in front of it</span>
?mean</code></pre></div>
<!--chapter:end:32-vectorized_functions.Rmd-->
</div>
</div>
<div id="subset" class="section level1">
<h1><span class="header-section-number">12</span> Subsetting</h1>
<p>There are three subsetting operators: <code>$</code>, <code>[]</code> and <code>[[]]</code>.<br />
Some functions also allow to create subsets. We can combine subsetting and assignment to change some parts of an object.<br />
Sub-setting is better used in complement with <code>str()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">va &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">13.1</span>, <span class="op">-</span><span class="fl">15.2</span>, <span class="fl">0.3</span>, <span class="fl">2.4</span>, <span class="fl">10.5</span>, <span class="op">-</span><span class="fl">3.6</span>, <span class="fl">9.7</span>) <span class="co"># create the vector va</span>
<span class="kw">str</span>(va)
<span class="co">#R&gt;  num [1:7] 13.1 -15.2 0.3 2.4 10.5 -3.6 9.7</span>
<span class="kw">str</span>(mtcars)
<span class="co">#R&gt; &#39;data.frame&#39;:   32 obs. of  11 variables:</span>
<span class="co">#R&gt;  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...</span>
<span class="co">#R&gt;  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...</span>
<span class="co">#R&gt;  $ disp: num  160 160 108 258 360 ...</span>
<span class="co">#R&gt;  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...</span>
<span class="co">#R&gt;  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...</span>
<span class="co">#R&gt;  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...</span>
<span class="co">#R&gt;  $ qsec: num  16.5 17 18.6 19.4 17 ...</span>
<span class="co">#R&gt;  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...</span>
<span class="co">#R&gt;  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...</span>
<span class="co">#R&gt;  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...</span>
<span class="co">#R&gt;  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</span></code></pre></div>
<p>One can see from this call, that <code>va</code> is a simple vector with 7 elements. Subsetting means choosing among these.</p>
<div id="section" class="section level2">
<h2><span class="header-section-number">12.1</span> <code>[]</code></h2>
<p>Applies to vectors, matrices, lists and data frames.<br />
Can be used with:</p>
<pre><code>- positive or negative values,
- many values in a vector,
- logical, `NA`,
- character vectors when names exist.</code></pre>
<div id="on-a-vector" class="section level3">
<h3><span class="header-section-number">12.1.1</span> On a vector</h3>
<p>Here are a few examples of that object used on a vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">va &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">13.1</span>, <span class="op">-</span><span class="fl">15.2</span>, <span class="fl">0.3</span>, <span class="fl">2.4</span>, <span class="fl">10.5</span>, <span class="op">-</span><span class="fl">3.6</span>, <span class="fl">9.7</span>)
va[<span class="dv">1</span>] <span class="co"># element 1</span>
<span class="co">#R&gt; [1] 13.1</span>
va[<span class="kw">c</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>)] <span class="co"># elements 3 to 5</span>
<span class="co">#R&gt; [1]  0.3  2.4 10.5</span>
va[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">7</span>)]
<span class="co">#R&gt; [1] -15.2   9.7</span>
va[<span class="op">-</span><span class="dv">1</span>] <span class="co"># all elements minus the element 1</span>
<span class="co">#R&gt; [1] -15.2   0.3   2.4  10.5  -3.6   9.7</span>
va[<span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="op">-</span><span class="dv">7</span>)]
<span class="co">#R&gt; [1] 13.1  0.3  2.4 10.5 -3.6</span>
va[<span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>,<span class="op">-</span><span class="dv">7</span>)]
<span class="co">#R&gt; [1] 13.1  0.3  2.4 10.5 -3.6</span>
va[<span class="kw">c</span>(<span class="ot">TRUE</span>,<span class="ot">TRUE</span>,<span class="ot">TRUE</span>,<span class="ot">FALSE</span>,<span class="ot">FALSE</span>,<span class="ot">TRUE</span>,<span class="ot">FALSE</span>)] 
<span class="co">#R&gt; [1]  13.1 -15.2   0.3  -3.6</span>
va[<span class="kw">c</span>(<span class="ot">TRUE</span>,<span class="ot">FALSE</span>)] <span class="co"># notice the recycling at play here</span>
<span class="co">#R&gt; [1] 13.1  0.3 10.5  9.7</span>
va[<span class="ot">NA</span>] 
<span class="co">#R&gt; [1] NA NA NA NA NA NA NA</span>
va[] <span class="co"># nothing selected gives the full vector</span>
<span class="co">#R&gt; [1]  13.1 -15.2   0.3   2.4  10.5  -3.6   9.7</span>
<span class="kw">names</span>(va)&lt;-letters[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(va)] <span class="co"># give names to va</span>
<span class="co"># notice that we subset the vector letters (given by R) and that we don&#39;t</span>
<span class="co"># specify the length but give a general value</span>
<span class="co"># now we can subset using names</span>
va
<span class="co">#R&gt;     a     b     c     d     e     f     g </span>
<span class="co">#R&gt;  13.1 -15.2   0.3   2.4  10.5  -3.6   9.7</span>
va[<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;e&quot;</span>,<span class="st">&quot;b&quot;</span>)]
<span class="co">#R&gt;     a     e     b </span>
<span class="co">#R&gt;  13.1  10.5 -15.2</span></code></pre></div>
</div>
<div id="on-a-list" class="section level3">
<h3><span class="header-section-number">12.1.2</span> On a list</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mylist&lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">numbers=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>), 
              <span class="dt">ournames=</span><span class="kw">c</span>(<span class="st">&quot;Jim&quot;</span>,<span class="st">&quot;Jules&quot;</span>), 
              <span class="dt">results=</span> <span class="kw">c</span>(T,F,F,T), 
              <span class="dt">school=</span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Tertiary&quot;</span>), <span class="dt">ordered=</span><span class="ot">TRUE</span>))
<span class="kw">str</span>(mylist)
<span class="co">#R&gt; List of 4</span>
<span class="co">#R&gt;  $ numbers : int [1:20] 1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">#R&gt;  $ ournames: chr [1:2] &quot;Jim&quot; &quot;Jules&quot;</span>
<span class="co">#R&gt;  $ results : logi [1:4] TRUE FALSE FALSE TRUE</span>
<span class="co">#R&gt;  $ school  : Ord.factor w/ 3 levels &quot;Primary&quot;&lt;&quot;Secondary&quot;&lt;..: 1 2 3</span>

mylist[<span class="dv">1</span>] <span class="co"># first element of the list</span>
<span class="co">#R&gt; $numbers</span>
<span class="co">#R&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</span>
<span class="kw">class</span>(mylist[<span class="dv">1</span>])
<span class="co">#R&gt; [1] &quot;list&quot;</span>
mylist[[<span class="dv">3</span>]][<span class="dv">3</span>]
<span class="co">#R&gt; [1] FALSE</span></code></pre></div>
<p>Notice that the result of this subsetting is a list!</p>
</div>
<div id="on-a-matrix" class="section level3">
<h3><span class="header-section-number">12.1.3</span> On a matrix</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">42</span>)
my.mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">floor</span>(<span class="kw">runif</span>(<span class="dv">30</span>)<span class="op">*</span><span class="dv">10</span>), <span class="dt">nrow=</span><span class="dv">5</span>)
my.mat
<span class="co">#R&gt;      [,1] [,2] [,3] [,4] [,5] [,6]</span>
<span class="co">#R&gt; [1,]    9    5    4    9    9    5</span>
<span class="co">#R&gt; [2,]    9    7    7    9    1    3</span>
<span class="co">#R&gt; [3,]    2    1    9    1    9    9</span>
<span class="co">#R&gt; [4,]    8    6    2    4    9    4</span>
<span class="co">#R&gt; [5,]    6    7    4    5    0    8</span>
<span class="kw">str</span>(my.mat)
<span class="co">#R&gt;  num [1:5, 1:6] 9 9 2 8 6 5 7 1 6 7 ...</span>
<span class="kw">length</span>(my.mat)
<span class="co">#R&gt; [1] 30</span></code></pre></div>
<p>The structure shows that there are r length(dim(my.mat)) dimensions. For subsetting, we must give r length(dim(my.mat)) dimensions! Same rules as for the vectors apply.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 2nd row, 3rd column</span>
my.mat[<span class="dv">2</span>,<span class="dv">3</span>] 
<span class="co">#R&gt; [1] 7</span>
<span class="co"># all but first row, all columns</span>
my.mat[<span class="op">-</span><span class="dv">1</span>,]
<span class="co">#R&gt;      [,1] [,2] [,3] [,4] [,5] [,6]</span>
<span class="co">#R&gt; [1,]    9    7    7    9    1    3</span>
<span class="co">#R&gt; [2,]    2    1    9    1    9    9</span>
<span class="co">#R&gt; [3,]    8    6    2    4    9    4</span>
<span class="co">#R&gt; [4,]    6    7    4    5    0    8</span>
<span class="kw">colnames</span>(my.mat) &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(my.mat)] <span class="co"># give names to the columns</span>
<span class="kw">rownames</span>(my.mat) &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(my.mat)] <span class="co"># give names to the rows</span>
my.mat
<span class="co">#R&gt;   a b c d e f</span>
<span class="co">#R&gt; A 9 5 4 9 9 5</span>
<span class="co">#R&gt; B 9 7 7 9 1 3</span>
<span class="co">#R&gt; C 2 1 9 1 9 9</span>
<span class="co">#R&gt; D 8 6 2 4 9 4</span>
<span class="co">#R&gt; E 6 7 4 5 0 8</span>
my.mat[<span class="st">&quot;C&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;e&quot;</span>)]
<span class="co">#R&gt; a c e </span>
<span class="co">#R&gt; 2 9 9</span></code></pre></div>
</div>
</div>
<div id="section-1" class="section level2">
<h2><span class="header-section-number">12.2</span> <code>[[]]</code></h2>
<p>This object is used mainly for lists.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mylist&lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">numbers=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>), 
              <span class="dt">ournames=</span><span class="kw">c</span>(<span class="st">&quot;Jim&quot;</span>,<span class="st">&quot;Jules&quot;</span>), 
              <span class="dt">results=</span> <span class="kw">c</span>(T,F,F,T), 
              <span class="dt">school=</span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Tertiary&quot;</span>), <span class="dt">ordered=</span><span class="ot">TRUE</span>))
<span class="kw">str</span>(mylist)
<span class="co">#R&gt; List of 4</span>
<span class="co">#R&gt;  $ numbers : int [1:20] 1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">#R&gt;  $ ournames: chr [1:2] &quot;Jim&quot; &quot;Jules&quot;</span>
<span class="co">#R&gt;  $ results : logi [1:4] TRUE FALSE FALSE TRUE</span>
<span class="co">#R&gt;  $ school  : Ord.factor w/ 3 levels &quot;Primary&quot;&lt;&quot;Secondary&quot;&lt;..: 1 2 3</span>
mylist[[<span class="dv">1</span>]]
<span class="co">#R&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</span></code></pre></div>
</div>
<div id="section-2" class="section level2">
<h2><span class="header-section-number">12.3</span> <code>$</code></h2>
<p>This object is usually for data frames, where it gives the variable.<br />
It allows partial matching (e.g., <code>mtcars$gear</code> is the same as <code>mtcars$gea</code>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mtcars)
mtcars
<span class="co">#R&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#R&gt; Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="co">#R&gt; Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="co">#R&gt; Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="co">#R&gt; Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="co">#R&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="co">#R&gt; Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="co">#R&gt; Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4</span>
<span class="co">#R&gt; Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2</span>
<span class="co">#R&gt; Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2</span>
<span class="co">#R&gt; Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4</span>
<span class="co">#R&gt; Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4</span>
<span class="co">#R&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3</span>
<span class="co">#R&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3</span>
<span class="co">#R&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3</span>
<span class="co">#R&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4</span>
<span class="co">#R&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="co">#R&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4</span>
<span class="co">#R&gt; Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span>
<span class="co">#R&gt; Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2</span>
<span class="co">#R&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1</span>
<span class="co">#R&gt; Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1</span>
<span class="co">#R&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2</span>
<span class="co">#R&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2</span>
<span class="co">#R&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4</span>
<span class="co">#R&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2</span>
<span class="co">#R&gt; Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1</span>
<span class="co">#R&gt; Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2</span>
<span class="co">#R&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2</span>
<span class="co">#R&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4</span>
<span class="co">#R&gt; Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</span>
<span class="co">#R&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8</span>
<span class="co">#R&gt; Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</span>
mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">4</span>]
<span class="co">#R&gt; [1] 110 110  93 110 175</span>
aa &lt;-<span class="st"> </span>mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="kw">c</span>(<span class="st">&quot;cyl&quot;</span>,<span class="st">&quot;hp&quot;</span>)]
<span class="kw">class</span>(aa)
<span class="co">#R&gt; [1] &quot;data.frame&quot;</span>
aa
<span class="co">#R&gt;                   cyl  hp</span>
<span class="co">#R&gt; Mazda RX4           6 110</span>
<span class="co">#R&gt; Mazda RX4 Wag       6 110</span>
<span class="co">#R&gt; Datsun 710          4  93</span>
<span class="co">#R&gt; Hornet 4 Drive      6 110</span>
<span class="co">#R&gt; Hornet Sportabout   8 175</span>

<span class="kw">names</span>(mtcars)
<span class="co">#R&gt;  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;</span>
<span class="co">#R&gt; [11] &quot;carb&quot;</span>
mtcars<span class="op">$</span>hp[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#R&gt; [1] 110 110  93 110 175</span>

mtcars[[<span class="st">&quot;mpg&quot;</span>]] <span class="co"># just exactly the same, but R users prefer the $</span>
<span class="co">#R&gt;  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2</span>
<span class="co">#R&gt; [15] 10.4 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4</span>
<span class="co">#R&gt; [29] 15.8 19.7 15.0 21.4</span>
mtcars[<span class="st">&quot;mpg&quot;</span>] <span class="co"># NOT the same at all! [] preserves the class</span>
<span class="co">#R&gt;                      mpg</span>
<span class="co">#R&gt; Mazda RX4           21.0</span>
<span class="co">#R&gt; Mazda RX4 Wag       21.0</span>
<span class="co">#R&gt; Datsun 710          22.8</span>
<span class="co">#R&gt; Hornet 4 Drive      21.4</span>
<span class="co">#R&gt; Hornet Sportabout   18.7</span>
<span class="co">#R&gt; Valiant             18.1</span>
<span class="co">#R&gt; Duster 360          14.3</span>
<span class="co">#R&gt; Merc 240D           24.4</span>
<span class="co">#R&gt; Merc 230            22.8</span>
<span class="co">#R&gt; Merc 280            19.2</span>
<span class="co">#R&gt; Merc 280C           17.8</span>
<span class="co">#R&gt; Merc 450SE          16.4</span>
<span class="co">#R&gt; Merc 450SL          17.3</span>
<span class="co">#R&gt; Merc 450SLC         15.2</span>
<span class="co">#R&gt; Cadillac Fleetwood  10.4</span>
<span class="co">#R&gt; Lincoln Continental 10.4</span>
<span class="co">#R&gt; Chrysler Imperial   14.7</span>
<span class="co">#R&gt; Fiat 128            32.4</span>
<span class="co">#R&gt; Honda Civic         30.4</span>
<span class="co">#R&gt; Toyota Corolla      33.9</span>
<span class="co">#R&gt; Toyota Corona       21.5</span>
<span class="co">#R&gt; Dodge Challenger    15.5</span>
<span class="co">#R&gt; AMC Javelin         15.2</span>
<span class="co">#R&gt; Camaro Z28          13.3</span>
<span class="co">#R&gt; Pontiac Firebird    19.2</span>
<span class="co">#R&gt; Fiat X1-9           27.3</span>
<span class="co">#R&gt; Porsche 914-2       26.0</span>
<span class="co">#R&gt; Lotus Europa        30.4</span>
<span class="co">#R&gt; Ford Pantera L      15.8</span>
<span class="co">#R&gt; Ferrari Dino        19.7</span>
<span class="co">#R&gt; Maserati Bora       15.0</span>
<span class="co">#R&gt; Volvo 142E          21.4</span>
<span class="kw">class</span>(mtcars[<span class="st">&quot;mpg&quot;</span>])
<span class="co">#R&gt; [1] &quot;data.frame&quot;</span></code></pre></div>
</div>
<div id="combining-subsetting" class="section level2">
<h2><span class="header-section-number">12.4</span> Combining subsetting</h2>
<p>Notice that we can often subset further until having the desired subset. Here are a few examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars<span class="op">$</span>mpg[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]
<span class="co">#R&gt; [1] 21.0 21.0 22.8 21.4</span>
mylist[[<span class="st">&quot;ournames&quot;</span>]][<span class="dv">1</span>]
<span class="co">#R&gt; [1] &quot;Jim&quot;</span>
mylist<span class="op">$</span>ournames[<span class="dv">1</span>]
<span class="co">#R&gt; [1] &quot;Jim&quot;</span></code></pre></div>
</div>
<div id="subsetting-with-one-condition" class="section level2">
<h2><span class="header-section-number">12.5</span> Subsetting with one condition</h2>
<p>We can use conditions for subsetting</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars[mtcars<span class="op">$</span>mpg<span class="op">&lt;=</span><span class="dv">20</span>, ]
<span class="co">#R&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#R&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="co">#R&gt; Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="co">#R&gt; Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4</span>
<span class="co">#R&gt; Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4</span>
<span class="co">#R&gt; Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4</span>
<span class="co">#R&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3</span>
<span class="co">#R&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3</span>
<span class="co">#R&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3</span>
<span class="co">#R&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4</span>
<span class="co">#R&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="co">#R&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4</span>
<span class="co">#R&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2</span>
<span class="co">#R&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2</span>
<span class="co">#R&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4</span>
<span class="co">#R&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2</span>
<span class="co">#R&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4</span>
<span class="co">#R&gt; Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</span>
<span class="co">#R&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8</span>
mtcars[mtcars<span class="op">$</span>cyl<span class="op">==</span><span class="dv">8</span>,]
<span class="co">#R&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#R&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="co">#R&gt; Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4</span>
<span class="co">#R&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3</span>
<span class="co">#R&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3</span>
<span class="co">#R&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3</span>
<span class="co">#R&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4</span>
<span class="co">#R&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="co">#R&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4</span>
<span class="co">#R&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2</span>
<span class="co">#R&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2</span>
<span class="co">#R&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4</span>
<span class="co">#R&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2</span>
<span class="co">#R&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4</span>
<span class="co">#R&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8</span>
mtcars[mtcars<span class="op">$</span>cyl<span class="op">==</span><span class="dv">8</span> <span class="op">&amp;</span><span class="st"> </span>mtcars<span class="op">$</span>carb<span class="op">==</span><span class="dv">4</span>,]
<span class="co">#R&gt;                      mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#R&gt; Duster 360          14.3   8  360 245 3.21 3.570 15.84  0  0    3    4</span>
<span class="co">#R&gt; Cadillac Fleetwood  10.4   8  472 205 2.93 5.250 17.98  0  0    3    4</span>
<span class="co">#R&gt; Lincoln Continental 10.4   8  460 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="co">#R&gt; Chrysler Imperial   14.7   8  440 230 3.23 5.345 17.42  0  0    3    4</span>
<span class="co">#R&gt; Camaro Z28          13.3   8  350 245 3.73 3.840 15.41  0  0    3    4</span>
<span class="co">#R&gt; Ford Pantera L      15.8   8  351 264 4.22 3.170 14.50  0  1    5    4</span>
mtcars[mtcars<span class="op">$</span>cyl<span class="op">==</span><span class="dv">8</span>, <span class="kw">c</span>(<span class="st">&quot;cyl&quot;</span>, <span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;wt&quot;</span>)]
<span class="co">#R&gt;                     cyl  mpg    wt</span>
<span class="co">#R&gt; Hornet Sportabout     8 18.7 3.440</span>
<span class="co">#R&gt; Duster 360            8 14.3 3.570</span>
<span class="co">#R&gt; Merc 450SE            8 16.4 4.070</span>
<span class="co">#R&gt; Merc 450SL            8 17.3 3.730</span>
<span class="co">#R&gt; Merc 450SLC           8 15.2 3.780</span>
<span class="co">#R&gt; Cadillac Fleetwood    8 10.4 5.250</span>
<span class="co">#R&gt; Lincoln Continental   8 10.4 5.424</span>
<span class="co">#R&gt; Chrysler Imperial     8 14.7 5.345</span>
<span class="co">#R&gt; Dodge Challenger      8 15.5 3.520</span>
<span class="co">#R&gt; AMC Javelin           8 15.2 3.435</span>
<span class="co">#R&gt; Camaro Z28            8 13.3 3.840</span>
<span class="co">#R&gt; Pontiac Firebird      8 19.2 3.845</span>
<span class="co">#R&gt; Ford Pantera L        8 15.8 3.170</span>
<span class="co">#R&gt; Maserati Bora         8 15.0 3.570</span></code></pre></div>
</div>
<div id="subsetting-and-assignment" class="section level2">
<h2><span class="header-section-number">12.6</span> Subsetting and assignment</h2>
<p>Subsetting can be used to change a part of an object through assignment. Assign <code>NULL</code> to delete subset</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.mat
<span class="co">#R&gt;   a b c d e f</span>
<span class="co">#R&gt; A 9 5 4 9 9 5</span>
<span class="co">#R&gt; B 9 7 7 9 1 3</span>
<span class="co">#R&gt; C 2 1 9 1 9 9</span>
<span class="co">#R&gt; D 8 6 2 4 9 4</span>
<span class="co">#R&gt; E 6 7 4 5 0 8</span>
my.mat[,<span class="dv">1</span>]&lt;-<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(my.mat)
my.mat
<span class="co">#R&gt;   a b c d e f</span>
<span class="co">#R&gt; A 1 5 4 9 9 5</span>
<span class="co">#R&gt; B 2 7 7 9 1 3</span>
<span class="co">#R&gt; C 3 1 9 1 9 9</span>
<span class="co">#R&gt; D 4 6 2 4 9 4</span>
<span class="co">#R&gt; E 5 7 4 5 0 8</span>
mtcars<span class="op">$</span>mpg[<span class="dv">1</span>]&lt;-<span class="dv">1234</span>
<span class="kw">names</span>(mtcars)
<span class="co">#R&gt;  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;</span>
<span class="co">#R&gt; [11] &quot;carb&quot;</span>
mtcars<span class="op">$</span>drat&lt;-<span class="ot">NULL</span> <span class="co"># delete variable drat in data frame mtcars</span>
<span class="co"># does not delete in matrix</span>
<span class="kw">names</span>(mtcars)
<span class="co">#R&gt;  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot; &quot;carb&quot;</span></code></pre></div>
</div>
<div id="using-which" class="section level2">
<h2><span class="header-section-number">12.7</span> Using <code>which()</code></h2>
<p><code>which()</code> gives the integers that correspond to the boolean (logical) <code>TRUE</code>.<br />
This can help subsetting</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vb&lt;-<span class="dv">1500</span><span class="op">:</span><span class="dv">1530</span>
vb
<span class="co">#R&gt;  [1] 1500 1501 1502 1503 1504 1505 1506 1507 1508 1509 1510 1511 1512 1513</span>
<span class="co">#R&gt; [15] 1514 1515 1516 1517 1518 1519 1520 1521 1522 1523 1524 1525 1526 1527</span>
<span class="co">#R&gt; [29] 1528 1529 1530</span>
<span class="kw">which</span>(vb<span class="op">%%</span><span class="dv">5</span><span class="op">==</span><span class="dv">0</span>) <span class="co"># which is divisible by 5 (modulo is 0) ?</span>
<span class="co">#R&gt; [1]  1  6 11 16 21 26 31</span>
<span class="co"># notice that this is asking each element of vb, </span>
<span class="co"># which() reports the positions for which the answer is TRUE </span>
vb[<span class="kw">which</span>(vb<span class="op">%%</span><span class="dv">5</span><span class="op">==</span><span class="dv">0</span>)] 
<span class="co">#R&gt; [1] 1500 1505 1510 1515 1520 1525 1530</span></code></pre></div>
</div>
<div id="more-advanced-stuff" class="section level2">
<h2><span class="header-section-number">12.8</span> More advanced stuff</h2>
<div id="difference-between-simplifying-and-preserving" class="section level3">
<h3><span class="header-section-number">12.8.1</span> Difference between simplifying and preserving</h3>
<p>We say ‘preserve’ to say the same structure is maintained when subsetting (e.g., a subset of a data frame remains a data frame).<br />
Simplifying does not keep the structure but gives the simplest output possible.<br />
<code>drop</code> argument allows to preserve (<code>drop=FALSE</code>) or not (<code>drop= TRUE</code>).<br />
<code>[]</code> usually preserves, <code>[[]]</code> usually simplifies.<br />
To better understand, check the classes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all.equal</span>(<span class="kw">class</span>(mylist[<span class="dv">1</span>]), <span class="kw">class</span>(mylist[[<span class="dv">1</span>]]))
<span class="co">#R&gt; [1] &quot;1 string mismatch&quot;</span>
<span class="kw">class</span>(mylist[<span class="dv">1</span>])
<span class="co">#R&gt; [1] &quot;list&quot;</span>
<span class="kw">class</span>(mylist[[<span class="dv">1</span>]])
<span class="co">#R&gt; [1] &quot;integer&quot;</span>
<span class="kw">all.equal</span>(<span class="kw">class</span>(mylist), <span class="kw">class</span>(mylist[<span class="dv">1</span>]))
<span class="co">#R&gt; [1] TRUE</span>
<span class="kw">all.equal</span>(<span class="kw">class</span>(mylist), <span class="kw">class</span>(mylist[[<span class="dv">1</span>]]))
<span class="co">#R&gt; [1] &quot;1 string mismatch&quot;</span></code></pre></div>
<p>We see that <code>[]</code> has preserved the class of <code>mylist</code> (r class(mylist)), while <code>[[]]</code> has not! Another striking example is the following.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ma2 &lt;-<span class="st"> </span>my.mat[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]
<span class="kw">class</span>(ma2)
<span class="co">#R&gt; [1] &quot;matrix&quot;</span>
ma3 &lt;-<span class="st"> </span>my.mat[<span class="dv">1</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]
<span class="kw">class</span>(ma3)
<span class="co">#R&gt; [1] &quot;numeric&quot;</span></code></pre></div>
<p><code>ma3</code> is NOT a matrix anymore!!! This is because one of its dimensions is 1. Losing track of the class when subsetting can generate lots of problems in the middle of a large code. And it is a common source of error! To be sure of keeping the class, we can use <code>drop=FALSE</code> (the class will not be dropped to, usually, a vector).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ma4 &lt;-<span class="st"> </span>my.mat[<span class="dv">1</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, drop=<span class="ot">FALSE</span>]
ma4
<span class="co">#R&gt;   a b c</span>
<span class="co">#R&gt; A 1 5 4</span>
<span class="kw">class</span>(ma4)
<span class="co">#R&gt; [1] &quot;matrix&quot;</span></code></pre></div>
<!--chapter:end:34-subset.Rmd-->
</div>
</div>
</div>
<div id="conditions" class="section level1">
<h1><span class="header-section-number">13</span> Conditions</h1>
<p>The general purpose of conditions is to control the flow of our code when executed by R.<br />
In R, it builds on statements such as <code>if</code> and <code>else</code>.</p>
<div id="if-statement" class="section level2">
<h2><span class="header-section-number">13.1</span> <code>if</code> statement</h2>
<p>The simplest form for a condition uses a <code>if</code> statement.<br />
The form is then:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (condition) {
<span class="co"># code to be executed if the condition is TRUE</span>
}</code></pre></div>
<p>The key point is that R will run the code until it finds a condition that is met. If it doesn’t find any, it continues to the next lines of code.<br />
Here is an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gains &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">4</span>)
gains
<span class="co">#R&gt; [1] 10  3 -5  0 -4 12  4</span>
<span class="kw">sum</span>(gains)
<span class="co">#R&gt; [1] 20</span>

<span class="cf">if</span> (<span class="kw">sum</span>(gains) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">print</span>(<span class="st">&quot;Congratulations, you are winning!&quot;</span>)
}
<span class="co">#R&gt; [1] &quot;Congratulations, you are winning!&quot;</span>

<span class="co"># change the -4 in &#39;gains&#39; to -40</span>

gains[gains<span class="op">==-</span><span class="dv">4</span>] &lt;-<span class="st"> </span><span class="op">-</span><span class="dv">40</span>
gains
<span class="co">#R&gt; [1]  10   3  -5   0 -40  12   4</span>

<span class="cf">if</span> (<span class="kw">sum</span>(gains) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">print</span>(<span class="st">&quot;Congratulations, you are winning!&quot;</span>)
} <span class="co"># notice that there is no output, because the condition was not met</span></code></pre></div>
</div>
<div id="else-statement" class="section level2">
<h2><span class="header-section-number">13.2</span> <code>else</code> statement</h2>
<p>What happens when the condition is not met? It’s on the user to decide. It can be nothing or… something else!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (condition) { 
<span class="co"># code to be executed if the condition is TRUE</span>
} <span class="cf">else</span> {
<span class="co"># code to be executed if the condition FALSE</span>
}</code></pre></div>
<p>Here is an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gains&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">4</span>)
gains[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="op">-</span><span class="dv">10</span> <span class="co"># change the first element of gains</span>
<span class="kw">sum</span>(gains)
<span class="co">#R&gt; [1] 0</span>

<span class="cf">if</span> (<span class="kw">sum</span>(gains) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">print</span>(<span class="st">&quot;Congratulations, you are winning!&quot;</span>)
} <span class="cf">else</span> {
  <span class="kw">print</span>(<span class="st">&quot;You are not winning!&quot;</span>)
} <span class="co"># notice that now there is an output!</span>
<span class="co">#R&gt; [1] &quot;You are not winning!&quot;</span></code></pre></div>
</div>
<div id="else-if-statement" class="section level2">
<h2><span class="header-section-number">13.3</span> <code>else if</code> statement</h2>
<p><code>else if</code> allows us to introduce another condition to our flow of code</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (condition_<span class="dv">1</span>) { 
<span class="co"># code to be executed if the condition_1 is TRUE</span>
} <span class="cf">else</span> <span class="cf">if</span> (condition_<span class="dv">2</span>) {
<span class="co"># code to be executed if the condition_2 is TRUE</span>
} <span class="cf">else</span> {
<span class="co"># code to be executed if NEITHER condition_1 NOR condition_2 is TRUE</span>
}</code></pre></div>
<p>We can use as many <code>else if</code> statements as we want.<br />
Here is an example with only one <code>else if</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gains &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">4</span>)
gains[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="op">-</span><span class="dv">20</span> <span class="co"># change the first element of &#39;gains&#39;</span>
<span class="kw">sum</span>(gains)
<span class="co">#R&gt; [1] -10</span>

<span class="cf">if</span> (<span class="kw">sum</span>(gains) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">print</span>(<span class="st">&quot;Congratulations, you are winning!&quot;</span>)
} <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">sum</span>(gains)<span class="op">==</span><span class="dv">0</span>) {
  <span class="kw">print</span>(<span class="st">&quot;You just break even!&quot;</span>)
} <span class="cf">else</span> {
  <span class="kw">print</span>(<span class="st">&quot;You are losing!&quot;</span>)
}
<span class="co">#R&gt; [1] &quot;You are losing!&quot;</span></code></pre></div>
<p>Notice the potential problem of not putting a <code>else</code> statement at the end of the conditions system.</p>
</div>
<div id="ifelse-statement" class="section level2">
<h2><span class="header-section-number">13.4</span> <code>ifelse</code> statement</h2>
<p>For <strong>short</strong> conditions, we can use <code>ifelse</code>.<br />
The form is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ifelse</span>(condition, value <span class="cf">if</span> condition met, value <span class="cf">if</span> value not met)</code></pre></div>
<p>Here is an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gains &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">4</span>, <span class="dv">12</span>, <span class="dv">4</span>)
sign &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">sum</span>(gains)<span class="op">&gt;=</span><span class="dv">0</span>,<span class="st">&quot;+&quot;</span>,<span class="st">&quot;-&quot;</span>)
sign
<span class="co">#R&gt; [1] &quot;+&quot;</span></code></pre></div>
</div>
<div id="logical-operators-and" class="section level2">
<h2><span class="header-section-number">13.5</span> Logical operators: <code>&amp;</code>, <code>|</code> and <code>!</code></h2>
<p>Logical operators are used to combine, mix or negate several conditions: - <code>&amp;</code> means AND - <code>|</code> means OR - <code>!</code> means NOT</p>
<p>De Morgan’s laws may help here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dv">10</span><span class="op">%%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="dv">27</span><span class="op">%%</span><span class="dv">3</span><span class="op">==</span><span class="dv">0</span>) <span class="co"># equivalent to (TRUE and TRUE), hence TRUE</span>
<span class="co">#R&gt; [1] TRUE</span>
<span class="ot">TRUE</span> <span class="op">&amp;</span><span class="st"> </span><span class="ot">FALSE</span>
<span class="co">#R&gt; [1] FALSE</span>
<span class="op">!</span><span class="ot">TRUE</span> 
<span class="co">#R&gt; [1] FALSE</span>
<span class="op">!</span>(<span class="ot">TRUE</span> <span class="op">&amp;</span><span class="st"> </span><span class="ot">TRUE</span>)
<span class="co">#R&gt; [1] FALSE</span>
<span class="op">!</span>(<span class="ot">TRUE</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="ot">TRUE</span>)
<span class="co">#R&gt; [1] TRUE</span>
((<span class="dv">10</span><span class="op">%%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="dv">27</span><span class="op">%%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span>)) <span class="co"># equivalent to (TRUE and FALSE), hence FALSE</span>
<span class="co">#R&gt; [1] FALSE</span>
((<span class="dv">10</span><span class="op">%%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span><span class="dv">27</span><span class="op">%%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span>)) <span class="co"># equivalent to (TRUE or FALSE), hence TRUE</span>
<span class="co">#R&gt; [1] TRUE</span></code></pre></div>
</div>
<div id="writing-and-interpreting-a-condition" class="section level2">
<h2><span class="header-section-number">13.6</span> Writing and interpreting a condition</h2>
<p>Notice that what R looks for in a condition is a either a TRUE or a FALSE.<br />
If it encounters a TRUE, it executes the commands, otherwise, it doesn’t.<br />
Remember there are many ways to obtain one of these two logicals. Any of these ways will work as a condition.<br />
Here are examples of less trivial ways of writing a condition</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gains&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">3</span>,<span class="op">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">4</span>,<span class="dv">12</span>,<span class="dv">4</span>)

<span class="cf">if</span> (<span class="kw">is.numeric</span>(gains)) {
  <span class="kw">print</span>(<span class="st">&quot;Seems like it is a numeric vector...&quot;</span>)
}
<span class="co">#R&gt; [1] &quot;Seems like it is a numeric vector...&quot;</span>
<span class="co"># here, is.numeric(gains) evaluates to TRUE, hence, the code is executed!</span>
<span class="co"># the beginner&#39;s way would be to replace the condition by</span>
<span class="co"># if (class(gains)==&quot;numeric&quot;)</span>

<span class="cf">if</span> (<span class="op">!</span><span class="kw">is.factor</span>(gains)) {
  <span class="kw">print</span>(<span class="st">&quot;Yeah! We avoided the factor...&quot;</span>)
}
<span class="co">#R&gt; [1] &quot;Yeah! We avoided the factor...&quot;</span>
<span class="co"># the beginner would write if (class(gains)!=&quot;factor&quot;)</span></code></pre></div>
<!--chapter:end:36-conditions.Rmd-->
</div>
</div>
<div id="functions" class="section level1">
<h1><span class="header-section-number">14</span> Functions</h1>
<p>Everything that happens in R is a function call. If we want R to do something, we must use a function, may it be as simple as a parentheses <code>(</code>. If the function is not built-in or coming in a package, one must write it. A function is itself an object. When applied to another object, the function “makes something” to that object and returns an object.</p>
<div id="structure-of-a-simple-function" class="section level2">
<h2><span class="header-section-number">14.1</span> Structure of a simple function</h2>
<p>Here is a simple example of a function that returns the square of the object provided.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pow_two &lt;-<span class="st"> </span><span class="cf">function</span>(a){
  a<span class="op">^</span><span class="dv">2</span>
}
<span class="kw">pow_two</span>(<span class="dv">12</span>)
<span class="co">#R&gt; [1] 144</span></code></pre></div>
<div id="name-of-the-function" class="section level3">
<h3><span class="header-section-number">14.1.1</span> Name of the function</h3>
<p>In our example above, the name was <code>pow_two</code>. To call, i.e., to use the function later in the code, type <code>pow_two()</code>.</p>
</div>
<div id="arguments" class="section level3">
<h3><span class="header-section-number">14.1.2</span> Arguments</h3>
<p>The arguments are given in the parentheses right after <code>function</code>.<br />
Here, we use an argument <code>a</code>, which can be any object, e.g., a vector</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pow_two</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="co">#R&gt;  [1]   1   4   9  16  25  36  49  64  81 100</span></code></pre></div>
<p>When using this function, we can see that one argument only must be passed.<br />
A value for the argument is then given in the parentheses when calling the function, e.g., <code>pow_two(12)</code>.<br />
A function can have several arguments</p>
</div>
<div id="commands" class="section level3">
<h3><span class="header-section-number">14.1.3</span> Commands</h3>
<p>The commands will be executed, if possible.<br />
One command source of error is when the class of the argument provided is NOT compatible with the commands in the function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pow_two</span>(<span class="st">&quot;hello&quot;</span>) <span class="co"># this can&#39;t work</span>
<span class="co">#R&gt; Error in a^2: non-numeric argument to binary operator</span></code></pre></div>
</div>
<div id="return-of-a-function" class="section level3">
<h3><span class="header-section-number">14.1.4</span> Return of a function</h3>
<p>The return of a function is given by the last expression executed inside the function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_f &lt;-<span class="st"> </span><span class="cf">function</span>(a){
  a<span class="op">^</span><span class="dv">2</span>
  a<span class="op">^</span><span class="dv">3</span> <span class="co"># THIS is the last expression executed</span>
}
<span class="kw">my_f</span>(<span class="dv">5</span>)
<span class="co">#R&gt; [1] 125</span></code></pre></div>
<p>We can use <code>return()</code> in the function in order to chose what it returns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_f2 &lt;-<span class="st"> </span><span class="cf">function</span>(a){
  <span class="kw">return</span>(a<span class="op">^</span><span class="dv">2</span>)
  a<span class="op">^</span><span class="dv">3</span>
}
<span class="kw">my_f2</span>(<span class="dv">5</span>)
<span class="co">#R&gt; [1] 25</span></code></pre></div>
<p>A function can return only one object; this is not really a problem as we can always stack everything in a <code>list()</code> and have the function return the list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_f3 &lt;-<span class="st"> </span><span class="cf">function</span>(a){
  <span class="kw">list</span>(<span class="dt">ptwo=</span>a<span class="op">^</span><span class="dv">2</span>, <span class="dt">pthree=</span>a<span class="op">^</span><span class="dv">3</span>, <span class="dt">pfour=</span>a<span class="op">^</span><span class="dv">4</span>) 
}
<span class="kw">my_f3</span>(<span class="dv">5</span><span class="op">:</span><span class="dv">20</span>)
<span class="co">#R&gt; $ptwo</span>
<span class="co">#R&gt;  [1]  25  36  49  64  81 100 121 144 169 196 225 256 289 324 361 400</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $pthree</span>
<span class="co">#R&gt;  [1]  125  216  343  512  729 1000 1331 1728 2197 2744 3375 4096 4913 5832</span>
<span class="co">#R&gt; [15] 6859 8000</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $pfour</span>
<span class="co">#R&gt;  [1]    625   1296   2401   4096   6561  10000  14641  20736  28561  38416</span>
<span class="co">#R&gt; [11]  50625  65536  83521 104976 130321 160000</span></code></pre></div>
<p>If we want to use the return of our function, we must assign it to an object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">my_f3</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) <span class="co"># evaluates the function above on the vector 1:5</span>
x<span class="op">$</span>pthree <span class="co"># shows the element pthree of the saved list x</span>
<span class="co">#R&gt; [1]   1   8  27  64 125</span></code></pre></div>
<p>An example where we better use <code>return</code> is the following</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pow_three &lt;-<span class="st"> </span><span class="cf">function</span>(a){
  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.numeric</span>(a)) {
    <span class="kw">return</span>(<span class="kw">print</span>(<span class="st">&quot;You must give a numeric vector!&quot;</span>))
  } <span class="cf">else</span> {
    <span class="kw">return</span>(a<span class="op">^</span><span class="dv">3</span>)
  }
  
}
<span class="kw">pow_three</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)
<span class="co">#R&gt; [1]  1  8 27 64</span></code></pre></div>
</div>
</div>
<div id="multiple-arguments-and-their-identification" class="section level2">
<h2><span class="header-section-number">14.2</span> Multiple arguments and their identification</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pow &lt;-<span class="st"> </span><span class="cf">function</span>(a, p){
  a<span class="op">^</span>p
}
<span class="kw">pow</span>(<span class="dv">12</span>, <span class="fl">0.5</span>)
<span class="co">#R&gt; [1] 3.464102</span></code></pre></div>
<p>As mentioned above, a function can have several arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_f4 &lt;-<span class="st"> </span><span class="cf">function</span>(abc, xyz){
  <span class="kw">c</span>(abc<span class="op">^</span><span class="dv">2</span>, xyz<span class="op">^</span><span class="dv">3</span>)
}
<span class="kw">my_f4</span>(<span class="dv">5</span>) <span class="co"># this won&#39;t work because xyz is missing</span>
<span class="co">#R&gt; Error in my_f4(5): argument &quot;xyz&quot; is missing, with no default</span>
<span class="kw">my_f4</span>(<span class="dv">5</span>, <span class="dv">10</span>)
<span class="co">#R&gt; [1]   25 1000</span></code></pre></div>
<p>R has at least two ways of identifying arguments, by position and by name.<br />
If no name is specified, R uses the arguments according to their positions in the definition of the function.<br />
In the example above, R understands that <code>abc=5</code> and <code>xyz=10</code> because of the way they are given in the call <code>my_f4(5, 10)</code>.<br />
Identification by names would be</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">my_f4</span>(<span class="dv">5</span>, <span class="dv">10</span>)
<span class="co">#R&gt; [1]   25 1000</span>
<span class="kw">my_f4</span>(<span class="dt">abc=</span><span class="dv">5</span>, <span class="dt">xyz=</span><span class="dv">10</span>) <span class="co"># same as before</span>
<span class="co">#R&gt; [1]   25 1000</span>
<span class="kw">my_f4</span>(<span class="dt">xyz=</span><span class="dv">5</span>, <span class="dt">abc=</span><span class="dv">10</span>) 
<span class="co">#R&gt; [1] 100 125</span>
<span class="co"># different from before because the names are more important than the position</span>
<span class="kw">my_f4</span>(<span class="dt">xyz=</span><span class="dv">5</span>, <span class="dv">10</span>) <span class="co"># a mix between name and position </span>
<span class="co">#R&gt; [1] 100 125</span></code></pre></div>
<div id="default-values" class="section level3">
<h3><span class="header-section-number">14.2.1</span> Default values</h3>
<p>A function can be defined with default values for their arguments.<br />
R will use the values provided in the call; if one is missing, R will use the default value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
my_f4 &lt;-<span class="st"> </span><span class="cf">function</span>(abc, <span class="dt">xyz=</span><span class="dv">2</span>){
  <span class="kw">c</span>(abc<span class="op">^</span><span class="dv">2</span>, xyz<span class="op">^</span><span class="dv">3</span>)
}
<span class="kw">my_f4</span>(<span class="dv">5</span>) 
<span class="co">#R&gt; [1] 25  8</span>

my_f5 &lt;-<span class="st"> </span><span class="cf">function</span>(a, tada){
  <span class="cf">if</span> (tada<span class="op">==</span><span class="ot">TRUE</span>){
    <span class="kw">plot</span>(a)
  } <span class="cf">else</span> {
    <span class="kw">sum</span>(a)
  }
}


<span class="kw">my_f5</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">tada=</span><span class="ot">FALSE</span>)
<span class="co">#R&gt; [1] 210</span>

my_f6 &lt;-<span class="st"> </span><span class="cf">function</span>(a, <span class="dt">tada=</span><span class="ot">TRUE</span>){
  <span class="cf">if</span> (tada<span class="op">==</span><span class="ot">TRUE</span>){
    <span class="kw">plot</span>(a)
  } <span class="cf">else</span> {
    <span class="kw">sum</span>(a)
  }
}

<span class="kw">my_f6</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, <span class="dt">tada=</span><span class="ot">FALSE</span>)
<span class="co">#R&gt; [1] 465</span></code></pre></div>
<!--chapter:end:40-functions.Rmd-->
</div>
</div>
</div>
<div id="loops" class="section level1">
<h1><span class="header-section-number">15</span> Loops (avoid them)</h1>
<div id="introduction-to-loops-with-a-silly-example-bad-r-coding" class="section level2">
<h2><span class="header-section-number">15.1</span> Introduction to loops with a silly example (bad R coding)</h2>
<p>Loops allow to iterate a set of functions / lines of code over a predefined list of elements.<br />
They are common in many languages but are not highly regarded in R because:</p>
<ul>
<li>they do not represent an efficient way of producing a result,</li>
<li>functionals, functions that return a vector such as the <code>apply</code> family, are preferred.</li>
</ul>
<p>This section serves as an introduction to the functionals because it helps understand the structure of the problem.</p>
<p>Now the silly example. Suppose our gains at a game over the week are, in euros,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gains &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">3</span>,<span class="op">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">4</span>,<span class="dv">12</span>,<span class="dv">4</span>)
gains
<span class="co">#R&gt; [1] 10  3 -5  0 -4 12  4</span></code></pre></div>
<p>Now, suppose we want to transform each gain into dollars, i.e., we must multiply each gain by 1.30. An intuitive way would be to take each gain <em>separately</em> and multiply it 1.12. Let’s do it by hand:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gains_d &lt;-<span class="kw">numeric</span>(<span class="kw">length</span>(gains)) <span class="co"># create a numeric vector of same length as gains</span>
gains_d[<span class="dv">1</span>] &lt;-<span class="st"> </span>gains[<span class="dv">1</span>]<span class="op">*</span><span class="fl">1.12</span> 
gains_d[<span class="dv">2</span>] &lt;-<span class="st"> </span>gains[<span class="dv">2</span>]<span class="op">*</span><span class="fl">1.12</span>
gains_d[<span class="dv">3</span>] &lt;-<span class="st"> </span>gains[<span class="dv">3</span>]<span class="op">*</span><span class="fl">1.12</span>
gains_d[<span class="dv">4</span>] &lt;-<span class="st"> </span>gains[<span class="dv">4</span>]<span class="op">*</span><span class="fl">1.12</span>
gains_d[<span class="dv">5</span>] &lt;-<span class="st"> </span>gains[<span class="dv">5</span>]<span class="op">*</span><span class="fl">1.12</span>
gains_d[<span class="dv">6</span>] &lt;-<span class="st"> </span>gains[<span class="dv">6</span>]<span class="op">*</span><span class="fl">1.12</span>
gains_d[<span class="dv">7</span>] &lt;-<span class="st"> </span>gains[<span class="dv">7</span>]<span class="op">*</span><span class="fl">1.12</span>
gains_d
<span class="co">#R&gt; [1] 11.20  3.36 -5.60  0.00 -4.48 13.44  4.48</span></code></pre></div>
<p>We recognize that the structure of each line of code: the first line is for the element 1 of the vectors, the second line for the second element of the vectors, etc.<br />
Doing a loop builds on that observation. But it asks the program to make the change between each line automatically.<br />
In this silly case, we want the program to evaluate a line with the value 1 and then, when it has finished, do the same line but with a 2 instead of a 1. And we want it to do it <strong>for</strong> the elements 1, 2, 3, 4, …, 7.<br />
This is what a loop does!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create an empty numeric vector of same length as gains</span>
gains_d2 &lt;-<span class="kw">numeric</span>(<span class="kw">length</span>(gains)) 

<span class="co"># now the loop</span>
<span class="co"># first for i=1, then i=2, then i=3, etc... until i=length(gains)</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(gains)) {  
  gains_d2[i] &lt;-<span class="st"> </span>gains[i]<span class="op">*</span><span class="fl">1.12</span> 
}
gains_d2
<span class="co">#R&gt; [1] 11.20  3.36 -5.60  0.00 -4.48 13.44  4.48</span></code></pre></div>
</div>
<div id="general-form-of-a-for-loop" class="section level2">
<h2><span class="header-section-number">15.2</span> General form of a <code>for</code> loop</h2>
<p>The general form of a loop is the following</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> list<span class="op">-</span>of<span class="op">-</span>elements) {
<span class="co"># code invoking i identifier</span>
}</code></pre></div>
<p>A few words about this simple form are the following.</p>
<ul>
<li>The <code>i</code> is the identifier to be used in the code; we can use anything (e.g., <code>x</code>, <code>kk</code>, <code>element</code>, …); we only need to be consistent and, if any, use that identifier in the code inside the loop.</li>
<li>The <code>in</code> is self-describing.</li>
<li>The list of elements is generally a vector, but it can also be a list.</li>
<li>The loop executes some code but does not need to return an object.</li>
</ul>
<div id="no-identifier-in-the-code" class="section level3">
<h3><span class="header-section-number">15.2.1</span> No identifier in the code?</h3>
<p>The program will run the code in the loop until it finds the identifier, replaces it with the current value of the loop and executes all the commands.<br />
If it doesn’t find it, then the program executes everything till the end of the loop and then starts again with the next value of the loop.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (kk <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) {
  <span class="kw">print</span>(<span class="st">&quot;I&#39;m working on it...&quot;</span>)
}
<span class="co">#R&gt; [1] &quot;I&#39;m working on it...&quot;</span>
<span class="co">#R&gt; [1] &quot;I&#39;m working on it...&quot;</span>
<span class="co">#R&gt; [1] &quot;I&#39;m working on it...&quot;</span>
<span class="co">#R&gt; [1] &quot;I&#39;m working on it...&quot;</span>

<span class="cf">for</span> (kk <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) {
  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;This is loop number&quot;</span>, kk))
}
<span class="co">#R&gt; [1] &quot;This is loop number 1&quot;</span>
<span class="co">#R&gt; [1] &quot;This is loop number 2&quot;</span>
<span class="co">#R&gt; [1] &quot;This is loop number 3&quot;</span>
<span class="co">#R&gt; [1] &quot;This is loop number 4&quot;</span>
<span class="co">#R&gt; [1] &quot;This is loop number 5&quot;</span></code></pre></div>
</div>
</div>
<div id="a-good-example-of-a-loop" class="section level2">
<h2><span class="header-section-number">15.3</span> A good example of a loop</h2>
<p>Suppose we want to know, every day, what is our cumulative gain until and including that day. This implies that we must to create another <code>cumulative_gains</code> with the same length as <code>gains</code>.</p>
<p>Then, we could run the following loop.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create an empty vector</span>
cumulative_gains &lt;-<span class="kw">numeric</span>(<span class="kw">length</span>(gains)) 

cumulative_gains[<span class="dv">1</span>] &lt;-<span class="st"> </span>gains[<span class="dv">1</span>]  
 
<span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(gains)){
  cumulative_gains[k]&lt;-cumulative_gains[k<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>gains[k]
}
gains
<span class="co">#R&gt; [1] 10  3 -5  0 -4 12  4</span>
cumulative_gains
<span class="co">#R&gt; [1] 10 13  8  8  4 16 20</span></code></pre></div>
</div>
<div id="looping-over-non-numeric-elements" class="section level2">
<h2><span class="header-section-number">15.4</span> Looping over non-numeric elements</h2>
<p>The examples above could give the impression that we must loop over numeric values. But it is not so!<br />
The identifiers above simply took the values, one after the other, of the vector provided. Since we always gave a numeric vector, the identifier was always numeric.<br />
Here, we show that we can also loop over other types of vectors, for instance a character vector.<br />
The example is simple: we want to count the number of letters in each element of the character vector and print the result in the console. You can use the built-in function <code>nchar()</code>; <code>nchar(&quot;Cologne&quot;)=</code>7.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cities &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Lisbon&quot;</span>, <span class="st">&quot;Paris&quot;</span>, <span class="st">&quot;Washington&quot;</span>, <span class="st">&quot;Antananarivo&quot;</span>)
cities
<span class="co">#R&gt; [1] &quot;Lisbon&quot;       &quot;Paris&quot;        &quot;Washington&quot;   &quot;Antananarivo&quot;</span>

<span class="cf">for</span> (cit <span class="cf">in</span> cities) {
  <span class="kw">print</span>(<span class="kw">paste</span>(cit, <span class="st">&quot;has&quot;</span>, <span class="kw">nchar</span>(cit), <span class="st">&quot;letters.&quot;</span>))
}
<span class="co">#R&gt; [1] &quot;Lisbon has 6 letters.&quot;</span>
<span class="co">#R&gt; [1] &quot;Paris has 5 letters.&quot;</span>
<span class="co">#R&gt; [1] &quot;Washington has 10 letters.&quot;</span>
<span class="co">#R&gt; [1] &quot;Antananarivo has 12 letters.&quot;</span></code></pre></div>
<p>To store these values in a vector <code>number_letters</code>, we could write</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">number_letters &lt;-<span class="st"> </span><span class="ot">NULL</span>

<span class="cf">for</span> (cit <span class="cf">in</span> cities) {
  number_letters &lt;-<span class="st"> </span><span class="kw">c</span>(number_letters, <span class="kw">nchar</span>(cit)) 
}

<span class="kw">names</span>(number_letters) &lt;-<span class="st"> </span>cities
number_letters
<span class="co">#R&gt;       Lisbon        Paris   Washington Antananarivo </span>
<span class="co">#R&gt;            6            5           10           12</span></code></pre></div>
</div>
<div id="more-advanced-stuff-1" class="section level2">
<h2><span class="header-section-number">15.5</span> More advanced stuff</h2>
<div id="loop-over-a-list" class="section level3">
<h3><span class="header-section-number">15.5.1</span> Loop over a <code>list</code></h3>
<p>We can loop over the elements of a <code>list</code>. Remember, however, that the elements of a <code>list</code> can be of any type. Therefore, we must make sure that the code inside the loop can be applied to each element of the <code>list</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mylist&lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">numbers=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>), 
              <span class="dt">cities=</span><span class="kw">c</span>(<span class="st">&quot;Cologne&quot;</span>,<span class="st">&quot;Lisbon&quot;</span>), 
              <span class="dt">results=</span> <span class="kw">c</span>(T,F,F,T), 
              <span class="dt">school=</span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Tertiary&quot;</span>), <span class="dt">ordered=</span><span class="ot">TRUE</span>))

<span class="cf">for</span> (kk <span class="cf">in</span> mylist) {
  <span class="kw">print</span>(<span class="kw">length</span>(kk))
}
<span class="co">#R&gt; [1] 20</span>
<span class="co">#R&gt; [1] 2</span>
<span class="co">#R&gt; [1] 4</span>
<span class="co">#R&gt; [1] 3</span></code></pre></div>
<p>Notice that the previous call could be done with a loop over a numeric vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># (kk in 1:4)</span>
<span class="cf">for</span> (kk <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(mylist)) { 
  <span class="kw">print</span>(<span class="kw">length</span>(mylist[[kk]]))
}
<span class="co">#R&gt; [1] 20</span>
<span class="co">#R&gt; [1] 2</span>
<span class="co">#R&gt; [1] 4</span>
<span class="co">#R&gt; [1] 3</span></code></pre></div>
</div>
<div id="while-loop" class="section level3">
<h3><span class="header-section-number">15.5.2</span> <code>while</code> loop</h3>
<p>The command <code>while</code> introduces a loop that is run while a certain condition is satisfied. Here is an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kk &lt;-<span class="st"> </span><span class="dv">6</span>
<span class="cf">while</span> (kk <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) {
  <span class="kw">print</span>(kk)
  kk &lt;-<span class="st"> </span>kk <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
}
<span class="co">#R&gt; [1] 6</span>
<span class="co">#R&gt; [1] 7</span>
<span class="co">#R&gt; [1] 8</span>
<span class="co">#R&gt; [1] 9</span></code></pre></div>
<p>Notice that the most important line is the last in the loop <code>kk &lt;- kk + 1</code>. This makes the identifier change value, in this case, it increases of 1.</p>
<p>If the identifier does not change, the program keeps running as long as the condition <code>(kk &lt; 10)</code> is satisfied… i.e., forever! Make sure that the condition is not satisfied at some point after some loops!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">repetition &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="cf">while</span> (repetition <span class="op">&lt;=</span><span class="st"> </span><span class="dv">9</span> ) {
  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;That&#39;s &quot;</span> , repetition, <span class="st">&quot;! One more! Come on!&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)) 
  repetition&lt;-<span class="st"> </span>repetition <span class="op">+</span><span class="dv">1</span>
}
<span class="co">#R&gt; [1] &quot;That&#39;s 0! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 1! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 2! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 3! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 4! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 5! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 6! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 7! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 8! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 9! One more! Come on!&quot;</span></code></pre></div>
</div>
<div id="break-next" class="section level3">
<h3><span class="header-section-number">15.5.3</span> <code>break</code> &amp; <code>next</code></h3>
<p>If we insert <code>break</code> in a loop, the program stops everything, i.e., the remaining code in the loop is skipped and the loop is not iterated over anymore.</p>
<p>You may want to use it in combination of a condition</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (condition<span class="op">==</span><span class="ot">TRUE</span>) {
  <span class="cf">break</span>
} </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">repetition &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="cf">while</span> (repetition <span class="op">&lt;=</span><span class="st"> </span><span class="dv">9</span> ) {
  <span class="cf">if</span> (repetition<span class="op">==</span><span class="dv">5</span>){
    <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;That&#39;s &quot;</span> , repetition,
                <span class="st">&quot;! Well done! I know we said 10, but that&#39;s enough for today!&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))
    <span class="cf">break</span>
  }
  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;That&#39;s &quot;</span> , repetition, <span class="st">&quot;! One more! Come on!&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)) 
  repetition&lt;-<span class="st"> </span>repetition <span class="op">+</span><span class="dv">1</span>
}
<span class="co">#R&gt; [1] &quot;That&#39;s 0! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 1! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 2! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 3! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 4! One more! Come on!&quot;</span>
<span class="co">#R&gt; [1] &quot;That&#39;s 5! Well done! I know we said 10, but that&#39;s enough for today!&quot;</span></code></pre></div>
<p>If we insert <code>next</code> in a loop, the program skips the remainder of the code in the loop and starts with the next value in the loop. Again, it’s usually combined with a condition.</p>
<!--chapter:end:42-loops.Rmd-->
</div>
</div>
</div>
<div id="import" class="section level1">
<h1><span class="header-section-number">16</span> Import data to R</h1>
<p>The first step in order to analyze data with R is to get the data in R.<br />
Data out there exists in many formats and it is not always consistently recorded. In R speaking, we will need to <code>read</code> the data from a file and put it in an object, often a data frame.<br />
Base R has has base functions to read some types of files. For special types of files, special packages are needed.</p>
<p><strong>Important note:</strong> these base functions are introduced here for documentation purpose only. Indeed, their task is usually better achieved by the functions developed in the <code>tidyverse</code> (see Chapter @ref(tidyverse) and following).</p>
<div id="reading-rectangular-data-1" class="section level2">
<h2><span class="header-section-number">16.1</span> Reading rectangular data</h2>
<p>Rectangular data is intended here as a data set with values of variables in columns and each row representing a case. Arguably, this is the simplest and probably most common way to store data sets.<br />
The ad hoc function in R is <code>read.table</code>. Other similar functions exist, e.g., <code>read.csv</code>, but they are essentially a wrapper of <code>read.table</code>.<br />
This function reads rectangular data and assigns it to an object, in almost all cases a data frame. The arguments of the function are numerous are, depending on the case, potentially very useful (check <code>?read.table</code>). We mention here a few of them in the typical call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.data &lt;-<span class="st"> </span><span class="kw">read.table</span>(...)</code></pre></div>
<p><code>file</code> is the name of the file to be read. It requires a valid path. It can also be an <code>url</code>, with some adaptations.<br />
<code>header</code> is a logical indicating whether the data’s first line gives the names of the variables.<br />
<code>sep</code> indicates the character that separates the values between columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assuming we have the file AH001.txt in the same folder</span>
df &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file=</span><span class="st">&quot;AH001.txt&quot;</span>,
                <span class="dt">header=</span><span class="ot">TRUE</span>,
                <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)
<span class="kw">head</span>(df)
<span class="co">#R&gt;   Area AreaCode AreaCode2 Grain Year Month LPrice HPrice</span>
<span class="co">#R&gt; 1   AH        1        NA    BO 1738     9     98    120</span>
<span class="co">#R&gt; 2   AH        1        NA    BO 1738    10     99    120</span>
<span class="co">#R&gt; 3   AH        1        NA    BO 1738    11    100    120</span>
<span class="co">#R&gt; 4   AH        1        NA    BO 1738    12     93    120</span>
<span class="co">#R&gt; 5   AH        1        NA    BO 1739     1     90    120</span>
<span class="co">#R&gt; 6   AH        1        NA    BO 1739     2     98    120</span></code></pre></div>
</div>
<div id="read-other-data-types-1" class="section level2">
<h2><span class="header-section-number">16.2</span> Read other data types</h2>
<p>R can import virtually all types of data. For special types, a ad hoc package will be necessary. <code>foreign</code> is one of them and it allows to import data from other applications. Its functions are of the form</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read.XXX</code></pre></div>
<p>where the <code>XXX</code> is an extension specific to the external software. Examples include “read.dta” for Stata data files, <code>read.spss</code> for SPSS files or <code>read.dbf</code> for dBASE files.</p>
<p>A very important data source type is Excel. Functions for this type of data are covered in Chapter @ref(readr) from the part on <code>tidyverse</code>.</p>
</div>
<div id="scanning-a-file-1" class="section level2">
<h2><span class="header-section-number">16.3</span> Scanning a file</h2>
<p>The base function <code>scan</code> can sometimes be useful, though it is not used to import data. <code>scan()</code> imports to a vector (or a list), which can then be used.</p>
<ul>
<li><code>what</code> gives the type of vector to be imported.<br />
</li>
<li><code>skip</code> is the number of lines to be skipped in the file.<br />
</li>
<li><code>nlines</code> determines the number of lines to be read and imported.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">what=</span><span class="kw">character</span>())
<span class="co">#df</span>
df &lt;-<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">what=</span><span class="kw">character</span>(), <span class="dt">skip=</span><span class="dv">1</span>, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)
<span class="co">#df</span>
given.line &lt;-<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">what=</span><span class="kw">character</span>(), <span class="dt">nlines=</span><span class="dv">1</span>, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)
given.line
<span class="co">#R&gt; [1] &quot;Area&quot;      &quot;AreaCode&quot;  &quot;AreaCode2&quot; &quot;Grain&quot;     &quot;Year&quot;      &quot;Month&quot;    </span>
<span class="co">#R&gt; [7] &quot;LPrice&quot;    &quot;HPrice&quot;</span></code></pre></div>
<!--chapter:end:44-import.Rmd-->
</div>
</div>
<div id="splots" class="section level1">
<h1><span class="header-section-number">17</span> Simple plots</h1>
<p>This short chapter has also only an information purpose. The package <code>ggplot2</code> described in Chapter @ref(ggplot2) allows to make much richer and elegant plots.</p>
<div id="line-plots" class="section level2">
<h2><span class="header-section-number">17.1</span> Line plots</h2>
<p>The simplest plot is a scatter plot of one variable plotted against an index (1, 2, 3, …) on the horizontal axis.<br />
In order to (scatter) plot one vector against the other, it is compulsory that they are both numeric and have the same length.<br />
The following plots illustrate the creation of a line plot in incremental steps. In the steps, the following functions and arguments are introduced:</p>
<ul>
<li><p><code>plot</code> is the main function for the plot.</p></li>
<li><p><code>type</code> argument type gives how the vector should be rendered in the plot; the <code>type</code> of the plot is any of Table @ref(tab:table-p-types).</p></li>
</ul>
<table>
<caption>(#tab:table-p-types)Plot types.</caption>
<thead>
<tr class="header">
<th align="left">Symbol</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">p</td>
<td align="left">Points</td>
</tr>
<tr class="even">
<td align="left">l</td>
<td align="left">Lines</td>
</tr>
<tr class="odd">
<td align="left">b</td>
<td align="left">Both</td>
</tr>
<tr class="even">
<td align="left">c</td>
<td align="left">The lines part alone of b</td>
</tr>
<tr class="odd">
<td align="left">o</td>
<td align="left">Both overplotted</td>
</tr>
<tr class="even">
<td align="left">s</td>
<td align="left">Steps</td>
</tr>
<tr class="odd">
<td align="left">h</td>
<td align="left">Histogram like (vertical lines)</td>
</tr>
<tr class="even">
<td align="left">n</td>
<td align="left">No plotting</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sales &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">18</span>, <span class="dv">24</span>, <span class="dv">36</span>, <span class="dv">30</span>)
date &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>)
<span class="co"># left</span>
<span class="kw">plot</span>(sales)
<span class="co"># middle</span>
<span class="kw">plot</span>(date, sales)
<span class="co"># right</span>
<span class="kw">plot</span>(date, sales, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="MyR_files/figure-html/simple-plots-1-1.png" alt="Creating a simple line plot." width="25%" /><img src="MyR_files/figure-html/simple-plots-1-2.png" alt="Creating a simple line plot." width="25%" /><img src="MyR_files/figure-html/simple-plots-1-3.png" alt="Creating a simple line plot." width="25%" />
<p class="caption">
(#fig:simple-plots-1)Creating a simple line plot.
</p>
</div>
<p>We now add further customization with new functions and arguments.</p>
<ul>
<li><code>col</code> determines the color; see this <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">Rcolor.pdf online</a> for details.</li>
<li>The <code>lty</code> argument refers to the type of line, to be chosen from the values shown in Figure @ref(fig:line-types),</li>
<li><code>lines</code> adds the plot of a vector to a previously opened plot.</li>
<li><code>axis</code> is a function that changes the axis given in its first argument with 1, 2, 3, 4 referring to the bottom, left, top, and right axis, respectively.</li>
<li><code>at</code> simply states for what values of the axis the labels should correspond.</li>
<li><code>las</code> gives the orientation of the labels (e.g., <code>1=horizontal</code>).</li>
<li><code>xlab</code> and <code>ylab</code> are the x and y axes labels, respectively.</li>
<li><code>xlim</code> and <code>ylim</code> set a numerical limit for the x and y axes labels, respectively, notice that a vector of length 2 is necessary for each.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="MyR_files/figure-html/line-types-1.png" alt="Line types." width="50%" />
<p class="caption">
(#fig:line-types)Line types.
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sales2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">19</span>, <span class="dv">22</span>, <span class="dv">28</span>, <span class="dv">32</span>) 
<span class="co"># left</span>
<span class="kw">plot</span>(date, sales, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)
<span class="kw">lines</span>(date, sales2, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span>)
<span class="co"># middle</span>
s.range &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">min</span>(sales,sales2),<span class="kw">max</span>(sales,sales2))
<span class="kw">plot</span>(date, sales, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">ylim=</span>s.range)
<span class="kw">lines</span>(date, sales2, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span>)
<span class="co"># right</span>
<span class="kw">plot</span>(date, sales, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,
     <span class="dt">ylim=</span>s.range,
     <span class="dt">axes=</span> <span class="ot">FALSE</span>, 
     <span class="dt">xlab =</span> <span class="st">&quot;Day&quot;</span>,
     <span class="dt">ylab=</span> <span class="st">&quot;Sales&quot;</span>)
<span class="kw">lines</span>(date, sales2, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span>)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span>date, <span class="dt">lab=</span><span class="kw">c</span>(<span class="st">&quot;Mon&quot;</span>,<span class="st">&quot;Tue&quot;</span>,<span class="st">&quot;Wed&quot;</span>,<span class="st">&quot;Thu&quot;</span>,<span class="st">&quot;Fri&quot;</span>))
<span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">at=</span><span class="kw">seq</span>(<span class="kw">min</span>(s.range),<span class="kw">max</span>(s.range),<span class="dv">5</span>)) </code></pre></div>
<div class="figure" style="text-align: center">
<img src="MyR_files/figure-html/simple-plots-2-1.png" alt="Custom a simple line plot." width="25%" /><img src="MyR_files/figure-html/simple-plots-2-2.png" alt="Custom a simple line plot." width="25%" /><img src="MyR_files/figure-html/simple-plots-2-3.png" alt="Custom a simple line plot." width="25%" />
<p class="caption">
(#fig:simple-plots-2)Custom a simple line plot.
</p>
</div>
<p>We now add further elements such as a legend or a title.</p>
<ul>
<li><code>legend</code> gives and places a legend; its first arguments are the location on the x and y axis respectively (this can be replaced by expressions such as <code>topleft</code>); the third is the legend itself, completed with colors and other formatting; notice that since the legend specifies two series, the formatting must also be given for each of them in vectors of length 2.</li>
<li><code>pch</code> determines the shape of the point in the plot, to be chosen from Figure @ref(fig:point-types).</li>
<li><code>cex</code> gives the expanding factor of the text.</li>
<li><code>bty</code> specifies whether of not the legend should be in a box (default, “o”) or not “n”.</li>
<li><code>title</code> gives the title to the plot.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="MyR_files/figure-html/point-types-1.png" alt="Point types." width="50%" />
<p class="caption">
(#fig:point-types)Point types.
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(date, sales, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">ylim=</span>s.range,
      <span class="dt">axes=</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;Day&quot;</span>, <span class="dt">ylab=</span> <span class="st">&quot;Sales&quot;</span>)
<span class="kw">lines</span>(date, sales2, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span>)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span>date, <span class="dt">lab=</span><span class="kw">c</span>(<span class="st">&quot;Mon&quot;</span>,<span class="st">&quot;Tue&quot;</span>,<span class="st">&quot;Wed&quot;</span>,<span class="st">&quot;Thu&quot;</span>,<span class="st">&quot;Fri&quot;</span>))
<span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">at=</span><span class="kw">seq</span>(<span class="kw">min</span>(s.range),<span class="kw">max</span>(s.range),<span class="dv">5</span>)) 
<span class="kw">legend</span>(date[<span class="dv">1</span>], s.range[<span class="dv">2</span>], <span class="kw">c</span>(<span class="st">&quot;Tom&quot;</span>,<span class="st">&quot;Mark&quot;</span>), <span class="dt">cex=</span><span class="dv">1</span>, 
   <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="dt">pch=</span><span class="kw">c</span>(<span class="ot">NA</span>,<span class="dv">1</span>), <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)
<span class="kw">title</span>(<span class="dt">main=</span><span class="st">&quot;Week Sales&quot;</span>, <span class="dt">col.main=</span><span class="st">&quot;black&quot;</span>, <span class="dt">font.main=</span><span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="MyR_files/figure-html/simple-plots-3-1.png" alt="Further customization of a simple line plot." width="50%" />
<p class="caption">
(#fig:simple-plots-3)Further customization of a simple line plot.
</p>
</div>
<p>One can help but notice how cumbersome the coding of the graph is, in particular when one needs to retype the whole code for the same graph.</p>
</div>
<div id="bar-graphs-and-histograms" class="section level2">
<h2><span class="header-section-number">17.2</span> Bar graphs and histograms</h2>
<p>This subsection illustrates the creation of these graphs with a few commented examples.</p>
<ul>
<li><code>barplot</code> takes a vector or a matrix as first argument. It is therefore important to double check how this latter is created.</li>
<li><code>density</code> applies to the colors and a single value would be recycled.</li>
<li><code>horiz</code> defaults to <code>FALSE</code> and gives the direction of the plot.</li>
<li><code>border</code> applies to the borders of the bars.</li>
<li><code>beside</code> forces side-by-side bars instead of stacking bars.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(sales,
        <span class="dt">main=</span><span class="st">&quot;Week Sales - Tom&quot;</span>,
        <span class="dt">names.arg=</span><span class="kw">c</span>(<span class="st">&quot;Mon&quot;</span>,<span class="st">&quot;Tue&quot;</span>,<span class="st">&quot;Wed&quot;</span>,<span class="st">&quot;Thu&quot;</span>,<span class="st">&quot;Fri&quot;</span>),
        <span class="dt">border=</span><span class="st">&quot;lightblue&quot;</span>,
        <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)
<span class="kw">barplot</span>(sales,
        <span class="dt">main=</span><span class="st">&quot;Week Sales - Mark&quot;</span>,
        <span class="dt">names.arg=</span><span class="kw">c</span>(<span class="st">&quot;Mon&quot;</span>,<span class="st">&quot;Tue&quot;</span>,<span class="st">&quot;Wed&quot;</span>,<span class="st">&quot;Thu&quot;</span>,<span class="st">&quot;Fri&quot;</span>),
        <span class="dt">border=</span><span class="st">&quot;red&quot;</span>,
        <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>,
        <span class="dt">horiz =</span> <span class="ot">TRUE</span>)

<span class="kw">barplot</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(sales, sales2), <span class="dt">ncol=</span><span class="dv">5</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>),
        <span class="dt">beside =</span> <span class="ot">TRUE</span>,
        <span class="dt">names.arg=</span><span class="kw">c</span>(<span class="st">&quot;Mon&quot;</span>,<span class="st">&quot;Tue&quot;</span>,<span class="st">&quot;Wed&quot;</span>,<span class="st">&quot;Thu&quot;</span>,<span class="st">&quot;Fri&quot;</span>),
        <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>),
        <span class="dt">density =</span> <span class="dv">30</span>, 
        <span class="dt">main=</span><span class="st">&quot;Week Sales&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="MyR_files/figure-html/bar-plots-1.png" alt="Simple bar plots." width="25%" /><img src="MyR_files/figure-html/bar-plots-2.png" alt="Simple bar plots." width="25%" /><img src="MyR_files/figure-html/bar-plots-3.png" alt="Simple bar plots." width="25%" />
<p class="caption">
(#fig:bar-plots)Simple bar plots.
</p>
</div>
<p>Turning to histogram, the function and some arguments are the following.</p>
<ul>
<li><code>hist</code> is the function to create an histogram from the values of a vector.</li>
<li><code>breaks</code> is the important argument as it controls the width of the bars.</li>
<li><code>freq</code> determines whether the frequency (default) of the density should be plotted.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(<span class="kw">c</span>(sales, sales2))

brks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(s.range), <span class="kw">max</span>(s.range)<span class="op">+</span><span class="dv">3</span>, <span class="dv">5</span>)
<span class="kw">hist</span>(<span class="kw">c</span>(sales, sales2),
    <span class="dt">col=</span><span class="kw">rev</span>(<span class="kw">heat.colors</span>(<span class="kw">length</span>(brks))),
    <span class="dt">breaks=</span>brks,
    <span class="dt">main=</span><span class="st">&quot;Histogram of Week Sales&quot;</span>,
    <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">cex.axis=</span><span class="fl">0.8</span>,
    <span class="dt">freq=</span><span class="ot">TRUE</span>,
    <span class="dt">xlab=</span><span class="st">&quot;Sales&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="MyR_files/figure-html/hist-plots-1.png" alt="Simple histograms." width="35%" /><img src="MyR_files/figure-html/hist-plots-2.png" alt="Simple histograms." width="35%" />
<p class="caption">
(#fig:hist-plots)Simple histograms.
</p>
</div>
<div id="other-plots" class="section level3">
<h3><span class="header-section-number">17.2.1</span> Other plots</h3>
<p>Other types of plots are called by the following functions.</p>
<ul>
<li><code>pie</code> for the pie (round) charts.</li>
<li><code>boxplot</code> for the box-and-whisker plot.</li>
<li><code>dotchart</code> for the Cleveland dot plot.</li>
<li>…</li>
</ul>
<!--chapter:end:46-plots.Rmd-->
</div>
</div>
</div>
<div id="part-tidyverse" class="section level1 unnumbered">
<h1>(PART) Tidyverse</h1>
</div>
<div id="tidyverse" class="section level1">
<h1><span class="header-section-number">18</span> What is <code>tidyverse</code></h1>
<p>As already mentioned in the preface of the book, many of the functions available in R come in packages. The tidyverse is a collection or bundle of open source R packages introduced by Hadley Wickham (Statistician from New Zealand who is currently Chief Scientist at RStudio) and his team. The fundamental packages of <code>tidyverse</code> are dplyr, tidyr, readr, tibble, stringr, ggplot2 and many other packages that provide the functionality to model, transform and visualize data. In general, the packages provided with <code>tidyverse</code> make R even better, faster, simpler and just more beautiful. The huge benefits of embracing the <code>tidyverse</code> come at the cost needing to learn a sub-dialect of R. This can be daunting for a beginner in R programming that put lots of effort into learning basic R functions. In general, tidyverse packages are intended to make the various processes of statistics and data science more productive through a variety of workflows. It is also the case that the tidyverse is work in progress.</p>
<p>The next chapters all develop a relevant package, selected from the <code>tidyverse</code>. The list of all packages along with a fuller description of the system can be found on <a href="https://www.tidyverse.org/">tidyverse.org</a>.</p>
<p>Let’s begin with the installation process of <code>tidyverse</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<!--chapter:end:50-tidyverse.Rmd-->
</div>
<div id="tibble" class="section level1">
<h1><span class="header-section-number">19</span> <code>tibble</code></h1>
<p>A tibble is the equivalent of a data frame in the <code>tidyverse</code>. The specific package of the bundle is called <code>tibble</code>.<br />
All the packages in the <code>tidyverse</code> work with tibbles.<br />
Notice that all the functions applicable to a data frame will also work on a tibble. This is because <strong>all tibbles are data frames</strong> (while the reverse is not true, all data frames are not necessarily tibbles).<br />
So why bother?<br />
The reasons to choose tibbles include:</p>
<ul>
<li>faster calculations,</li>
<li>better printing of the content,</li>
<li>more information about the content,</li>
<li>more useful warnings of errors,</li>
<li>simpler and more limited functionalities.</li>
</ul>
<div id="creating-a-tibble" class="section level2">
<h2><span class="header-section-number">19.1</span> Creating a tibble</h2>
<p>There are various ways to create a tibble.</p>
<div id="as_tibble" class="section level3">
<h3><span class="header-section-number">19.1.1</span> <code>as_tibble</code></h3>
<p>The simplest way is declare a data frame a tibble with the function <code>as_tibble</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(iris)
<span class="co"># print the data frame</span>
iris
<span class="co">#R&gt;     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="co">#R&gt; 1            5.1         3.5          1.4         0.2     setosa</span>
<span class="co">#R&gt; 2            4.9         3.0          1.4         0.2     setosa</span>
<span class="co">#R&gt; 3            4.7         3.2          1.3         0.2     setosa</span>
<span class="co">#R&gt; 4            4.6         3.1          1.5         0.2     setosa</span>
<span class="co">#R&gt; 5            5.0         3.6          1.4         0.2     setosa</span>
<span class="co">#R&gt; 6            5.4         3.9          1.7         0.4     setosa</span>
<span class="co">#R&gt; 7            4.6         3.4          1.4         0.3     setosa</span>
<span class="co">#R&gt; 8            5.0         3.4          1.5         0.2     setosa</span>
<span class="co">#R&gt; 9            4.4         2.9          1.4         0.2     setosa</span>
<span class="co">#R&gt; 10           4.9         3.1          1.5         0.1     setosa</span>
<span class="co">#R&gt; 11           5.4         3.7          1.5         0.2     setosa</span>
<span class="co">#R&gt; 12           4.8         3.4          1.6         0.2     setosa</span>
<span class="co">#R&gt; 13           4.8         3.0          1.4         0.1     setosa</span>
<span class="co">#R&gt; 14           4.3         3.0          1.1         0.1     setosa</span>
<span class="co">#R&gt; 15           5.8         4.0          1.2         0.2     setosa</span>
<span class="co">#R&gt; 16           5.7         4.4          1.5         0.4     setosa</span>
<span class="co">#R&gt; 17           5.4         3.9          1.3         0.4     setosa</span>
<span class="co">#R&gt; 18           5.1         3.5          1.4         0.3     setosa</span>
<span class="co">#R&gt; 19           5.7         3.8          1.7         0.3     setosa</span>
<span class="co">#R&gt; 20           5.1         3.8          1.5         0.3     setosa</span>
<span class="co">#R&gt; 21           5.4         3.4          1.7         0.2     setosa</span>
<span class="co">#R&gt; 22           5.1         3.7          1.5         0.4     setosa</span>
<span class="co">#R&gt; 23           4.6         3.6          1.0         0.2     setosa</span>
<span class="co">#R&gt; 24           5.1         3.3          1.7         0.5     setosa</span>
<span class="co">#R&gt; 25           4.8         3.4          1.9         0.2     setosa</span>
<span class="co">#R&gt; 26           5.0         3.0          1.6         0.2     setosa</span>
<span class="co">#R&gt; 27           5.0         3.4          1.6         0.4     setosa</span>
<span class="co">#R&gt; 28           5.2         3.5          1.5         0.2     setosa</span>
<span class="co">#R&gt; 29           5.2         3.4          1.4         0.2     setosa</span>
<span class="co">#R&gt; 30           4.7         3.2          1.6         0.2     setosa</span>
<span class="co">#R&gt; 31           4.8         3.1          1.6         0.2     setosa</span>
<span class="co">#R&gt; 32           5.4         3.4          1.5         0.4     setosa</span>
<span class="co">#R&gt; 33           5.2         4.1          1.5         0.1     setosa</span>
<span class="co">#R&gt; 34           5.5         4.2          1.4         0.2     setosa</span>
<span class="co">#R&gt; 35           4.9         3.1          1.5         0.2     setosa</span>
<span class="co">#R&gt; 36           5.0         3.2          1.2         0.2     setosa</span>
<span class="co">#R&gt; 37           5.5         3.5          1.3         0.2     setosa</span>
<span class="co">#R&gt; 38           4.9         3.6          1.4         0.1     setosa</span>
<span class="co">#R&gt; 39           4.4         3.0          1.3         0.2     setosa</span>
<span class="co">#R&gt; 40           5.1         3.4          1.5         0.2     setosa</span>
<span class="co">#R&gt; 41           5.0         3.5          1.3         0.3     setosa</span>
<span class="co">#R&gt; 42           4.5         2.3          1.3         0.3     setosa</span>
<span class="co">#R&gt; 43           4.4         3.2          1.3         0.2     setosa</span>
<span class="co">#R&gt; 44           5.0         3.5          1.6         0.6     setosa</span>
<span class="co">#R&gt; 45           5.1         3.8          1.9         0.4     setosa</span>
<span class="co">#R&gt; 46           4.8         3.0          1.4         0.3     setosa</span>
<span class="co">#R&gt; 47           5.1         3.8          1.6         0.2     setosa</span>
<span class="co">#R&gt; 48           4.6         3.2          1.4         0.2     setosa</span>
<span class="co">#R&gt; 49           5.3         3.7          1.5         0.2     setosa</span>
<span class="co">#R&gt; 50           5.0         3.3          1.4         0.2     setosa</span>
<span class="co">#R&gt; 51           7.0         3.2          4.7         1.4 versicolor</span>
<span class="co">#R&gt; 52           6.4         3.2          4.5         1.5 versicolor</span>
<span class="co">#R&gt; 53           6.9         3.1          4.9         1.5 versicolor</span>
<span class="co">#R&gt; 54           5.5         2.3          4.0         1.3 versicolor</span>
<span class="co">#R&gt; 55           6.5         2.8          4.6         1.5 versicolor</span>
<span class="co">#R&gt; 56           5.7         2.8          4.5         1.3 versicolor</span>
<span class="co">#R&gt; 57           6.3         3.3          4.7         1.6 versicolor</span>
<span class="co">#R&gt; 58           4.9         2.4          3.3         1.0 versicolor</span>
<span class="co">#R&gt; 59           6.6         2.9          4.6         1.3 versicolor</span>
<span class="co">#R&gt; 60           5.2         2.7          3.9         1.4 versicolor</span>
<span class="co">#R&gt; 61           5.0         2.0          3.5         1.0 versicolor</span>
<span class="co">#R&gt; 62           5.9         3.0          4.2         1.5 versicolor</span>
<span class="co">#R&gt; 63           6.0         2.2          4.0         1.0 versicolor</span>
<span class="co">#R&gt; 64           6.1         2.9          4.7         1.4 versicolor</span>
<span class="co">#R&gt; 65           5.6         2.9          3.6         1.3 versicolor</span>
<span class="co">#R&gt; 66           6.7         3.1          4.4         1.4 versicolor</span>
<span class="co">#R&gt; 67           5.6         3.0          4.5         1.5 versicolor</span>
<span class="co">#R&gt; 68           5.8         2.7          4.1         1.0 versicolor</span>
<span class="co">#R&gt; 69           6.2         2.2          4.5         1.5 versicolor</span>
<span class="co">#R&gt; 70           5.6         2.5          3.9         1.1 versicolor</span>
<span class="co">#R&gt; 71           5.9         3.2          4.8         1.8 versicolor</span>
<span class="co">#R&gt; 72           6.1         2.8          4.0         1.3 versicolor</span>
<span class="co">#R&gt; 73           6.3         2.5          4.9         1.5 versicolor</span>
<span class="co">#R&gt; 74           6.1         2.8          4.7         1.2 versicolor</span>
<span class="co">#R&gt; 75           6.4         2.9          4.3         1.3 versicolor</span>
<span class="co">#R&gt; 76           6.6         3.0          4.4         1.4 versicolor</span>
<span class="co">#R&gt; 77           6.8         2.8          4.8         1.4 versicolor</span>
<span class="co">#R&gt; 78           6.7         3.0          5.0         1.7 versicolor</span>
<span class="co">#R&gt; 79           6.0         2.9          4.5         1.5 versicolor</span>
<span class="co">#R&gt; 80           5.7         2.6          3.5         1.0 versicolor</span>
<span class="co">#R&gt; 81           5.5         2.4          3.8         1.1 versicolor</span>
<span class="co">#R&gt; 82           5.5         2.4          3.7         1.0 versicolor</span>
<span class="co">#R&gt; 83           5.8         2.7          3.9         1.2 versicolor</span>
<span class="co">#R&gt; 84           6.0         2.7          5.1         1.6 versicolor</span>
<span class="co">#R&gt; 85           5.4         3.0          4.5         1.5 versicolor</span>
<span class="co">#R&gt; 86           6.0         3.4          4.5         1.6 versicolor</span>
<span class="co">#R&gt; 87           6.7         3.1          4.7         1.5 versicolor</span>
<span class="co">#R&gt; 88           6.3         2.3          4.4         1.3 versicolor</span>
<span class="co">#R&gt; 89           5.6         3.0          4.1         1.3 versicolor</span>
<span class="co">#R&gt; 90           5.5         2.5          4.0         1.3 versicolor</span>
<span class="co">#R&gt; 91           5.5         2.6          4.4         1.2 versicolor</span>
<span class="co">#R&gt; 92           6.1         3.0          4.6         1.4 versicolor</span>
<span class="co">#R&gt; 93           5.8         2.6          4.0         1.2 versicolor</span>
<span class="co">#R&gt; 94           5.0         2.3          3.3         1.0 versicolor</span>
<span class="co">#R&gt; 95           5.6         2.7          4.2         1.3 versicolor</span>
<span class="co">#R&gt; 96           5.7         3.0          4.2         1.2 versicolor</span>
<span class="co">#R&gt; 97           5.7         2.9          4.2         1.3 versicolor</span>
<span class="co">#R&gt; 98           6.2         2.9          4.3         1.3 versicolor</span>
<span class="co">#R&gt; 99           5.1         2.5          3.0         1.1 versicolor</span>
<span class="co">#R&gt; 100          5.7         2.8          4.1         1.3 versicolor</span>
<span class="co">#R&gt; 101          6.3         3.3          6.0         2.5  virginica</span>
<span class="co">#R&gt; 102          5.8         2.7          5.1         1.9  virginica</span>
<span class="co">#R&gt; 103          7.1         3.0          5.9         2.1  virginica</span>
<span class="co">#R&gt; 104          6.3         2.9          5.6         1.8  virginica</span>
<span class="co">#R&gt; 105          6.5         3.0          5.8         2.2  virginica</span>
<span class="co">#R&gt; 106          7.6         3.0          6.6         2.1  virginica</span>
<span class="co">#R&gt; 107          4.9         2.5          4.5         1.7  virginica</span>
<span class="co">#R&gt; 108          7.3         2.9          6.3         1.8  virginica</span>
<span class="co">#R&gt; 109          6.7         2.5          5.8         1.8  virginica</span>
<span class="co">#R&gt; 110          7.2         3.6          6.1         2.5  virginica</span>
<span class="co">#R&gt; 111          6.5         3.2          5.1         2.0  virginica</span>
<span class="co">#R&gt; 112          6.4         2.7          5.3         1.9  virginica</span>
<span class="co">#R&gt; 113          6.8         3.0          5.5         2.1  virginica</span>
<span class="co">#R&gt; 114          5.7         2.5          5.0         2.0  virginica</span>
<span class="co">#R&gt; 115          5.8         2.8          5.1         2.4  virginica</span>
<span class="co">#R&gt; 116          6.4         3.2          5.3         2.3  virginica</span>
<span class="co">#R&gt; 117          6.5         3.0          5.5         1.8  virginica</span>
<span class="co">#R&gt; 118          7.7         3.8          6.7         2.2  virginica</span>
<span class="co">#R&gt; 119          7.7         2.6          6.9         2.3  virginica</span>
<span class="co">#R&gt; 120          6.0         2.2          5.0         1.5  virginica</span>
<span class="co">#R&gt; 121          6.9         3.2          5.7         2.3  virginica</span>
<span class="co">#R&gt; 122          5.6         2.8          4.9         2.0  virginica</span>
<span class="co">#R&gt; 123          7.7         2.8          6.7         2.0  virginica</span>
<span class="co">#R&gt; 124          6.3         2.7          4.9         1.8  virginica</span>
<span class="co">#R&gt; 125          6.7         3.3          5.7         2.1  virginica</span>
<span class="co">#R&gt; 126          7.2         3.2          6.0         1.8  virginica</span>
<span class="co">#R&gt; 127          6.2         2.8          4.8         1.8  virginica</span>
<span class="co">#R&gt; 128          6.1         3.0          4.9         1.8  virginica</span>
<span class="co">#R&gt; 129          6.4         2.8          5.6         2.1  virginica</span>
<span class="co">#R&gt; 130          7.2         3.0          5.8         1.6  virginica</span>
<span class="co">#R&gt; 131          7.4         2.8          6.1         1.9  virginica</span>
<span class="co">#R&gt; 132          7.9         3.8          6.4         2.0  virginica</span>
<span class="co">#R&gt; 133          6.4         2.8          5.6         2.2  virginica</span>
<span class="co">#R&gt; 134          6.3         2.8          5.1         1.5  virginica</span>
<span class="co">#R&gt; 135          6.1         2.6          5.6         1.4  virginica</span>
<span class="co">#R&gt; 136          7.7         3.0          6.1         2.3  virginica</span>
<span class="co">#R&gt; 137          6.3         3.4          5.6         2.4  virginica</span>
<span class="co">#R&gt; 138          6.4         3.1          5.5         1.8  virginica</span>
<span class="co">#R&gt; 139          6.0         3.0          4.8         1.8  virginica</span>
<span class="co">#R&gt; 140          6.9         3.1          5.4         2.1  virginica</span>
<span class="co">#R&gt; 141          6.7         3.1          5.6         2.4  virginica</span>
<span class="co">#R&gt; 142          6.9         3.1          5.1         2.3  virginica</span>
<span class="co">#R&gt; 143          5.8         2.7          5.1         1.9  virginica</span>
<span class="co">#R&gt; 144          6.8         3.2          5.9         2.3  virginica</span>
<span class="co">#R&gt; 145          6.7         3.3          5.7         2.5  virginica</span>
<span class="co">#R&gt; 146          6.7         3.0          5.2         2.3  virginica</span>
<span class="co">#R&gt; 147          6.3         2.5          5.0         1.9  virginica</span>
<span class="co">#R&gt; 148          6.5         3.0          5.2         2.0  virginica</span>
<span class="co">#R&gt; 149          6.2         3.4          5.4         2.3  virginica</span>
<span class="co">#R&gt; 150          5.9         3.0          5.1         1.8  virginica</span>

t_iris &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(iris)
<span class="co"># print the tibble</span>
<span class="kw">class</span>(t_iris)
<span class="co">#R&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span>
t_iris
<span class="co">#R&gt; # A tibble: 150 x 5</span>
<span class="co">#R&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">#R&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span>
<span class="co">#R&gt;  1          5.1         3.5          1.4         0.2 setosa </span>
<span class="co">#R&gt;  2          4.9         3            1.4         0.2 setosa </span>
<span class="co">#R&gt;  3          4.7         3.2          1.3         0.2 setosa </span>
<span class="co">#R&gt;  4          4.6         3.1          1.5         0.2 setosa </span>
<span class="co">#R&gt;  5          5           3.6          1.4         0.2 setosa </span>
<span class="co">#R&gt;  6          5.4         3.9          1.7         0.4 setosa </span>
<span class="co">#R&gt;  7          4.6         3.4          1.4         0.3 setosa </span>
<span class="co">#R&gt;  8          5           3.4          1.5         0.2 setosa </span>
<span class="co">#R&gt;  9          4.4         2.9          1.4         0.2 setosa </span>
<span class="co">#R&gt; 10          4.9         3.1          1.5         0.1 setosa </span>
<span class="co">#R&gt; # … with 140 more rows</span></code></pre></div>
<p>Another example for using as_tibble:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(letters)
<span class="co">#R&gt; Warning in data(letters): data set &#39;letters&#39; not found</span>
<span class="co"># print the data frame</span>
letters
<span class="co">#R&gt;  [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot; &quot;k&quot; &quot;l&quot; &quot;m&quot; &quot;n&quot; &quot;o&quot; &quot;p&quot; &quot;q&quot;</span>
<span class="co">#R&gt; [18] &quot;r&quot; &quot;s&quot; &quot;t&quot; &quot;u&quot; &quot;v&quot; &quot;w&quot; &quot;x&quot; &quot;y&quot; &quot;z&quot;</span>

t_iris &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(letters)
<span class="co">#R&gt; Warning: Calling `as_tibble()` on a vector is discouraged, because the behavior is likely to change in the future. Use `tibble::enframe(name = NULL)` instead.</span>
<span class="co">#R&gt; This warning is displayed once per session.</span>
<span class="co"># print the tibble</span>
<span class="kw">class</span>(t_iris)
<span class="co">#R&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span>
t_iris
<span class="co">#R&gt; # A tibble: 26 x 1</span>
<span class="co">#R&gt;    value</span>
<span class="co">#R&gt;    &lt;chr&gt;</span>
<span class="co">#R&gt;  1 a    </span>
<span class="co">#R&gt;  2 b    </span>
<span class="co">#R&gt;  3 c    </span>
<span class="co">#R&gt;  4 d    </span>
<span class="co">#R&gt;  5 e    </span>
<span class="co">#R&gt;  6 f    </span>
<span class="co">#R&gt;  7 g    </span>
<span class="co">#R&gt;  8 h    </span>
<span class="co">#R&gt;  9 i    </span>
<span class="co">#R&gt; 10 j    </span>
<span class="co">#R&gt; # … with 16 more rows</span></code></pre></div>
</div>
<div id="manually" class="section level3">
<h3><span class="header-section-number">19.1.2</span> Manually</h3>
<p>A tibble can also be created manually. Notice the following two points:</p>
<ul>
<li>vectors of length 1 (only) are recycled,<br />
</li>
<li>vectors that depend on others can be directly created.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_tbl &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">x1 =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, 
  <span class="dt">x2 =</span> <span class="dv">5</span>, 
  <span class="dt">x3 =</span> x1<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x2
)
my_tbl
<span class="co">#R&gt; # A tibble: 10 x 3</span>
<span class="co">#R&gt;       x1    x2    x3</span>
<span class="co">#R&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#R&gt;  1     1     5     5</span>
<span class="co">#R&gt;  2     2     5    20</span>
<span class="co">#R&gt;  3     3     5    45</span>
<span class="co">#R&gt;  4     4     5    80</span>
<span class="co">#R&gt;  5     5     5   125</span>
<span class="co">#R&gt;  6     6     5   180</span>
<span class="co">#R&gt;  7     7     5   245</span>
<span class="co">#R&gt;  8     8     5   320</span>
<span class="co">#R&gt;  9     9     5   405</span>
<span class="co">#R&gt; 10    10     5   500</span></code></pre></div>
<p>Another example for manually creating a tibble:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">y =</span> x <span class="op">^</span><span class="st"> </span><span class="dv">3</span>)
<span class="co">#R&gt; # A tibble: 10 x 2</span>
<span class="co">#R&gt;        x     y</span>
<span class="co">#R&gt;    &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#R&gt;  1     1     1</span>
<span class="co">#R&gt;  2     2     8</span>
<span class="co">#R&gt;  3     3    27</span>
<span class="co">#R&gt;  4     4    64</span>
<span class="co">#R&gt;  5     5   125</span>
<span class="co">#R&gt;  6     6   216</span>
<span class="co">#R&gt;  7     7   343</span>
<span class="co">#R&gt;  8     8   512</span>
<span class="co">#R&gt;  9     9   729</span>
<span class="co">#R&gt; 10    10  1000</span></code></pre></div>
</div>
<div id="tribble" class="section level3">
<h3><span class="header-section-number">19.1.3</span> <code>tribble</code></h3>
<p>A tribble is a tibble created in a transposed way. To be noticed:</p>
<ul>
<li>column headings are entered (as a formula) with a <code>~</code>,</li>
<li>data are entered in rows,</li>
<li>all values are separated by commas.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_tr &lt;-<span class="st"> </span><span class="kw">tribble</span>(
    <span class="op">~</span>x1, <span class="op">~</span>x2, <span class="op">~</span>x3,
    <span class="st">&quot;A&quot;</span>, <span class="dv">2</span>, <span class="dv">7</span>,
    <span class="st">&quot;B&quot;</span>, <span class="dv">5</span>, <span class="dv">12</span>,
    <span class="st">&quot;C&quot;</span>, <span class="dv">4</span>, <span class="dv">8</span> 
    )
my_tr
<span class="co">#R&gt; # A tibble: 3 x 3</span>
<span class="co">#R&gt;   x1       x2    x3</span>
<span class="co">#R&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#R&gt; 1 A         2     7</span>
<span class="co">#R&gt; 2 B         5    12</span>
<span class="co">#R&gt; 3 C         4     8</span></code></pre></div>
<!--chapter:end:51-tibble.Rmd-->
</div>
</div>
</div>
<div id="readr" class="section level1">
<h1><span class="header-section-number">20</span> <code>readr</code> and <code>readxl</code></h1>
<div id="readr" class="section level2">
<h2><span class="header-section-number">20.1</span> <code>readr</code></h2>
<p>As shown in Chapter @ref(import), base R has many functions to read some types of files. Readr therefore provides a fast and simple way to read rectangular data, such as csv, fwf etc.</p>
<p><code>readr</code> improves on them because it:</p>
<ul>
<li>is much faster,</li>
<li>has mainly functionalities,</li>
<li>converts data directly into tibbles,</li>
<li>handles the conversion of the type of data in a better way.</li>
</ul>
<p>Notice that <code>readr</code> uses names of functions that are very close to the base R functions: e.g., <code>read_csv</code> instead of <code>read.csv</code> in base R.<br />
The functions form a <code>read_xxx</code> family where ‘xxx’ stands for the way the data you want read was recorded:</p>
<p>read_csv(): comma separated (CSV) files read_tsv(): tab separated files read_delim(): general delimited files read_fwf(): fixed width files read_table(): tabular files where columns are separated by white-space. read_log(): web log files</p>
<p>In my experience, using the right member of the family yields better results, for instance in parsing the columns.</p>
<div id="read.csv" class="section level3">
<h3><span class="header-section-number">20.1.1</span> <code>read.csv</code></h3>
<p>read_csv() reads comma delimited files and is one of the most common forms of data storage. Therefore, if you understand how read.csv() works, the other functions of readr are also fairly easy to understand.</p>
<p>When you run read_csv() it prints out a column specification that gives the name and type of each column. Example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read_csv
<span class="co">#R&gt; function (file, col_names = TRUE, col_types = NULL, locale = default_locale(), </span>
<span class="co">#R&gt;     na = c(&quot;&quot;, &quot;NA&quot;), quoted_na = TRUE, quote = &quot;\&quot;&quot;, comment = &quot;&quot;, </span>
<span class="co">#R&gt;     trim_ws = TRUE, skip = 0, n_max = Inf, guess_max = min(1000, </span>
<span class="co">#R&gt;         n_max), progress = show_progress(), skip_empty_rows = TRUE) </span>
<span class="co">#R&gt; {</span>
<span class="co">#R&gt;     tokenizer &lt;- tokenizer_csv(na = na, quoted_na = quoted_na, </span>
<span class="co">#R&gt;         quote = quote, comment = comment, trim_ws = trim_ws, </span>
<span class="co">#R&gt;         skip_empty_rows = skip_empty_rows)</span>
<span class="co">#R&gt;     read_delimited(file, tokenizer, col_names = col_names, col_types = col_types, </span>
<span class="co">#R&gt;         locale = locale, skip = skip, skip_empty_rows = skip_empty_rows, </span>
<span class="co">#R&gt;         comment = comment, n_max = n_max, guess_max = guess_max, </span>
<span class="co">#R&gt;         progress = progress)</span>
<span class="co">#R&gt; }</span>
<span class="co">#R&gt; &lt;bytecode: 0x7fa38d7c94d0&gt;</span>
<span class="co">#R&gt; &lt;environment: namespace:readr&gt;</span></code></pre></div>
<p>The first step of the process is then the selection of the path to the file to read (As shown in the following example CSV File:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_csv</span>(<span class="st">&quot;Insurance_sample.csv&quot;</span>)
<span class="co">#R&gt; Parsed with column specification:</span>
<span class="co">#R&gt; cols(</span>
<span class="co">#R&gt;   policyID = col_double(),</span>
<span class="co">#R&gt;   statecode = col_character(),</span>
<span class="co">#R&gt;   county = col_character(),</span>
<span class="co">#R&gt;   eq_site_limit = col_double(),</span>
<span class="co">#R&gt;   hu_site_limit = col_double(),</span>
<span class="co">#R&gt;   fl_site_limit = col_double(),</span>
<span class="co">#R&gt;   fr_site_limit = col_double(),</span>
<span class="co">#R&gt;   tiv_2011 = col_double(),</span>
<span class="co">#R&gt;   tiv_2012 = col_double(),</span>
<span class="co">#R&gt;   eq_site_deductible = col_double(),</span>
<span class="co">#R&gt;   hu_site_deductible = col_double(),</span>
<span class="co">#R&gt;   fl_site_deductible = col_double(),</span>
<span class="co">#R&gt;   fr_site_deductible = col_double(),</span>
<span class="co">#R&gt;   point_latitude = col_double(),</span>
<span class="co">#R&gt;   point_longitude = col_double(),</span>
<span class="co">#R&gt;   line = col_character(),</span>
<span class="co">#R&gt;   construction = col_character(),</span>
<span class="co">#R&gt;   point_granularity = col_double()</span>
<span class="co">#R&gt; )</span>
<span class="co">#R&gt; # A tibble: 36,634 x 18</span>
<span class="co">#R&gt;    policyID statecode county eq_site_limit hu_site_limit fl_site_limit</span>
<span class="co">#R&gt;       &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#R&gt;  1   119736 FL        CLAY …       498960        498960        498960 </span>
<span class="co">#R&gt;  2   448094 FL        CLAY …      1322376.      1322376.      1322376.</span>
<span class="co">#R&gt;  3   206893 FL        CLAY …       190724.       190724.       190724.</span>
<span class="co">#R&gt;  4   333743 FL        CLAY …            0         79521.            0 </span>
<span class="co">#R&gt;  5   172534 FL        CLAY …            0        254282.            0 </span>
<span class="co">#R&gt;  6   785275 FL        CLAY …            0        515036.            0 </span>
<span class="co">#R&gt;  7   995932 FL        CLAY …            0      19260000             0 </span>
<span class="co">#R&gt;  8   223488 FL        CLAY …       328500        328500        328500 </span>
<span class="co">#R&gt;  9   433512 FL        CLAY …       315000        315000        315000 </span>
<span class="co">#R&gt; 10   142071 FL        CLAY …       705600        705600        705600 </span>
<span class="co">#R&gt; # … with 36,624 more rows, and 12 more variables: fr_site_limit &lt;dbl&gt;,</span>
<span class="co">#R&gt; #   tiv_2011 &lt;dbl&gt;, tiv_2012 &lt;dbl&gt;, eq_site_deductible &lt;dbl&gt;,</span>
<span class="co">#R&gt; #   hu_site_deductible &lt;dbl&gt;, fl_site_deductible &lt;dbl&gt;,</span>
<span class="co">#R&gt; #   fr_site_deductible &lt;dbl&gt;, point_latitude &lt;dbl&gt;, point_longitude &lt;dbl&gt;,</span>
<span class="co">#R&gt; #   line &lt;chr&gt;, construction &lt;chr&gt;, point_granularity &lt;dbl&gt;</span></code></pre></div>
<p>The data might not have column names. You can use col_names = FALSE to tell read_csv() not to treat the first row as headings, and instead label them sequentially from X1 to Xn:</p>
<pre class="{r"><code>read_csv(&quot;Insurance_sample.csv&quot;, col_names = FALSE)</code></pre>
<p>The insurance example above has column names and it is therefore not necessary to tell read_csv() to treat the first row as headings.</p>
<p>At this point in time, this is all you need to now about reading or treating CSV files. There are many other functions with regards to reading and writing CSV files, yet for the sake of this project, it is not necessary to have that level of detail.</p>
</div>
<div id="read_delim" class="section level3">
<h3><span class="header-section-number">20.1.2</span> <code>read_delim</code></h3>
<p>We’ll also describe <code>read_delim</code> because functions of the family behave are special cases of this function. For instance, <code>read_csv</code> is equivalent to <code>read_delim</code> with a <code>,</code> as a character to separate the columns.</p>
<ul>
<li>The <code>file</code> argument gives the name of a file, possibly with the path to it, if it is not in the same folder. Again, the path can also be an url.<br />
</li>
<li><code>delim</code> provides the character that separates columns in the data.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assuming that the AH001.txt is in the folder</span>
df &lt;-<span class="st"> </span><span class="kw">read_delim</span> (<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot;,&quot;</span> , <span class="dt">trim_ws=</span><span class="ot">TRUE</span>)
<span class="co">#R&gt; Parsed with column specification:</span>
<span class="co">#R&gt; cols(</span>
<span class="co">#R&gt;   Area = col_character(),</span>
<span class="co">#R&gt;   AreaCode = col_character(),</span>
<span class="co">#R&gt;   AreaCode2 = col_logical(),</span>
<span class="co">#R&gt;   Grain = col_character(),</span>
<span class="co">#R&gt;   Year = col_double(),</span>
<span class="co">#R&gt;   Month = col_double(),</span>
<span class="co">#R&gt;   LPrice = col_double(),</span>
<span class="co">#R&gt;   HPrice = col_double()</span>
<span class="co">#R&gt; )</span>
df
<span class="co">#R&gt; # A tibble: 9,765 x 8</span>
<span class="co">#R&gt;    Area  AreaCode AreaCode2 Grain  Year Month LPrice HPrice</span>
<span class="co">#R&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;lgl&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#R&gt;  1 AH    001      NA        BO     1738     9     98    120</span>
<span class="co">#R&gt;  2 AH    001      NA        BO     1738    10     99    120</span>
<span class="co">#R&gt;  3 AH    001      NA        BO     1738    11    100    120</span>
<span class="co">#R&gt;  4 AH    001      NA        BO     1738    12     93    120</span>
<span class="co">#R&gt;  5 AH    001      NA        BO     1739     1     90    120</span>
<span class="co">#R&gt;  6 AH    001      NA        BO     1739     2     98    120</span>
<span class="co">#R&gt;  7 AH    001      NA        BO     1739     3    100    124</span>
<span class="co">#R&gt;  8 AH    001      NA        BO     1739     4    100    121</span>
<span class="co">#R&gt;  9 AH    001      NA        BO     1739     9     90    125</span>
<span class="co">#R&gt; 10 AH    001      NA        BO     1740     6     75    130</span>
<span class="co">#R&gt; # … with 9,755 more rows</span>
<span class="kw">class</span>(df)
<span class="co">#R&gt; [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;</span></code></pre></div>
<p>Notice an important message, the types of the columns were guessed by the function. For instance, the column “Area” was guessed to be of type “character”. With that respect, the next arguments are particularly useful.<br />
- First, <code>trim_ws</code> is a logical for whether the leading white space in each recording should be erased before parsing. With a white space, columns of numeric values with different number of digits could be guessed as character vectors.<br />
Second, we can override the guess of <code>read_delim</code> by specifying the types: this is called “to parse” a file.<br />
We can parse into many types and use abbreviations to set them: c = character, i = integer, n = number, d = double, l = logical, D = date, T = date time, t = time, ? = guess.</p>
<p>All of these parsing calls can cause unexpected problems. For instance, one may need to change the symbol for decimal with the extra argument for the column type <code>locale=locale(decimal_mark=&quot;,&quot;)</code>. Notice the behavior when an observation is not of the same type as expected: it is changed to <code>NA</code>.<br />
The function <code>problems</code> lists the rows with problems.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">delim=</span><span class="st">&quot;,&quot;</span>, <span class="dt">trim_ws=</span><span class="ot">TRUE</span>,
                <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">LPrice=</span><span class="st">&quot;d&quot;</span>, <span class="dt">HPrice =</span><span class="st">&quot;d&quot;</span>) )
df
<span class="co">#R&gt; # A tibble: 9,765 x 8</span>
<span class="co">#R&gt;    Area  AreaCode AreaCode2 Grain  Year Month LPrice HPrice</span>
<span class="co">#R&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;lgl&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#R&gt;  1 AH    001      NA        BO     1738     9     98    120</span>
<span class="co">#R&gt;  2 AH    001      NA        BO     1738    10     99    120</span>
<span class="co">#R&gt;  3 AH    001      NA        BO     1738    11    100    120</span>
<span class="co">#R&gt;  4 AH    001      NA        BO     1738    12     93    120</span>
<span class="co">#R&gt;  5 AH    001      NA        BO     1739     1     90    120</span>
<span class="co">#R&gt;  6 AH    001      NA        BO     1739     2     98    120</span>
<span class="co">#R&gt;  7 AH    001      NA        BO     1739     3    100    124</span>
<span class="co">#R&gt;  8 AH    001      NA        BO     1739     4    100    121</span>
<span class="co">#R&gt;  9 AH    001      NA        BO     1739     9     90    125</span>
<span class="co">#R&gt; 10 AH    001      NA        BO     1740     6     75    130</span>
<span class="co">#R&gt; # … with 9,755 more rows</span>
<span class="kw">problems</span>(df)
<span class="co">#R&gt; [1] row      col      expected actual  </span>
<span class="co">#R&gt; &lt;0 rows&gt; (or 0-length row.names)</span></code></pre></div>
<p>Notice that the names of the variables are not within <code>&quot; &quot;</code>. This is a general feature of the <code>tidyverse</code>.<br />
By default, the first line of the data file is used for naming the columns. This can be changed.<br />
- <code>col_names</code> is the vector of names set for the variables. - <code>skip</code> determines how many lines to be skipped in the file. This is useful when the file does contain names that one does not want to keep.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot;,&quot;</span> , <span class="dt">trim_ws=</span><span class="ot">TRUE</span>,
                <span class="dt">skip =</span> <span class="dv">1</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>)
<span class="co">#R&gt; Parsed with column specification:</span>
<span class="co">#R&gt; cols(</span>
<span class="co">#R&gt;   X1 = col_character(),</span>
<span class="co">#R&gt;   X2 = col_character(),</span>
<span class="co">#R&gt;   X3 = col_logical(),</span>
<span class="co">#R&gt;   X4 = col_character(),</span>
<span class="co">#R&gt;   X5 = col_double(),</span>
<span class="co">#R&gt;   X6 = col_double(),</span>
<span class="co">#R&gt;   X7 = col_double(),</span>
<span class="co">#R&gt;   X8 = col_double()</span>
<span class="co">#R&gt; )</span>
df
<span class="co">#R&gt; # A tibble: 9,765 x 8</span>
<span class="co">#R&gt;    X1    X2    X3    X4       X5    X6    X7    X8</span>
<span class="co">#R&gt;    &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#R&gt;  1 AH    001   NA    BO     1738     9    98   120</span>
<span class="co">#R&gt;  2 AH    001   NA    BO     1738    10    99   120</span>
<span class="co">#R&gt;  3 AH    001   NA    BO     1738    11   100   120</span>
<span class="co">#R&gt;  4 AH    001   NA    BO     1738    12    93   120</span>
<span class="co">#R&gt;  5 AH    001   NA    BO     1739     1    90   120</span>
<span class="co">#R&gt;  6 AH    001   NA    BO     1739     2    98   120</span>
<span class="co">#R&gt;  7 AH    001   NA    BO     1739     3   100   124</span>
<span class="co">#R&gt;  8 AH    001   NA    BO     1739     4   100   121</span>
<span class="co">#R&gt;  9 AH    001   NA    BO     1739     9    90   125</span>
<span class="co">#R&gt; 10 AH    001   NA    BO     1740     6    75   130</span>
<span class="co">#R&gt; # … with 9,755 more rows</span>
<span class="kw">colnames</span>(df) &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(df)]
df
<span class="co">#R&gt; # A tibble: 9,765 x 8</span>
<span class="co">#R&gt;    A     B     C     D         E     F     G     H</span>
<span class="co">#R&gt;    &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#R&gt;  1 AH    001   NA    BO     1738     9    98   120</span>
<span class="co">#R&gt;  2 AH    001   NA    BO     1738    10    99   120</span>
<span class="co">#R&gt;  3 AH    001   NA    BO     1738    11   100   120</span>
<span class="co">#R&gt;  4 AH    001   NA    BO     1738    12    93   120</span>
<span class="co">#R&gt;  5 AH    001   NA    BO     1739     1    90   120</span>
<span class="co">#R&gt;  6 AH    001   NA    BO     1739     2    98   120</span>
<span class="co">#R&gt;  7 AH    001   NA    BO     1739     3   100   124</span>
<span class="co">#R&gt;  8 AH    001   NA    BO     1739     4   100   121</span>
<span class="co">#R&gt;  9 AH    001   NA    BO     1739     9    90   125</span>
<span class="co">#R&gt; 10 AH    001   NA    BO     1740     6    75   130</span>
<span class="co">#R&gt; # … with 9,755 more rows</span></code></pre></div>
<p>Data often contain specific special character, in particular for comments and NA’s.</p>
<ul>
<li><code>comment</code> takes the character that signals comments.</li>
<li><code>na</code> signals what values should be consider as NA’s.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&quot;AH001.txt&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot;,&quot;</span> , <span class="dt">trim_ws=</span><span class="ot">TRUE</span>,
                <span class="dt">skip =</span> <span class="dv">1</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>, 
                <span class="dt">comment =</span> <span class="st">&quot;%&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;9999&quot;</span>)</code></pre></div>
</div>
</div>
<div id="readxl" class="section level2">
<h2><span class="header-section-number">20.2</span> <code>readxl</code></h2>
<p>Lots of rectangular data out there is in Excel files. One way is to handle it could be to first transform the data into a <code>.csv</code> file and then import it as described above.<br />
Thanks to the <code>readxl</code> package, one can also read it directly.[^Notice that R can also write to an Excel file. Why would one do that? Maybe because collaborators only work with Excel. This is achieved with the package <code>XLConnect</code> but we won’t dig into these details here.] As part of the <code>tidyverse</code> bundle, <code>readxl</code> shares features and rules with <code>readr</code>.<br />
Below are some of the specific features.</p>
<ul>
<li><code>read_excel</code> is the function that reads the data in the file and assigns it to an object, as illustrated in the following chunk.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="st">&quot;data_china.xlsx&quot;</span>)
df 
<span class="co">#R&gt; # A tibble: 19 x 8</span>
<span class="co">#R&gt;    Area  AreaCode AreaCode2 Grain  Year Month LPrice HPrice</span>
<span class="co">#R&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;lgl&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#R&gt;  1 AH           1 NA        BO     1738     9     98    120</span>
<span class="co">#R&gt;  2 AH           1 NA        BO     1738    10     99    120</span>
<span class="co">#R&gt;  3 AH           1 NA        BO     1738    11    100    120</span>
<span class="co">#R&gt;  4 AH           1 NA        BO     1738    12     93    120</span>
<span class="co">#R&gt;  5 AH           1 NA        BO     1739     1     90    120</span>
<span class="co">#R&gt;  6 AH           1 NA        BO     1739     2     98    120</span>
<span class="co">#R&gt;  7 AH           1 NA        BO     1739     3    100    124</span>
<span class="co">#R&gt;  8 AH           1 NA        BO     1739     4    100    121</span>
<span class="co">#R&gt;  9 AH           1 NA        BO     1739     9     90    125</span>
<span class="co">#R&gt; 10 AH           1 NA        BO     1740     6     75    130</span>
<span class="co">#R&gt; 11 AH           1 NA        BO     1740     7     75    130</span>
<span class="co">#R&gt; 12 AH           1 NA        BO     1740     8     75    150</span>
<span class="co">#R&gt; 13 AH           1 NA        BO     1740     9     75    150</span>
<span class="co">#R&gt; 14 AH           1 NA        BO     1740    10     75    150</span>
<span class="co">#R&gt; 15 AH           1 NA        BO     1740    11     75    150</span>
<span class="co">#R&gt; 16 AH           1 NA        BO     1740    12     75    150</span>
<span class="co">#R&gt; 17 AH           1 NA        BO     1741     1     75    150</span>
<span class="co">#R&gt; 18 AH           1 NA        BO     1741     2     75    138</span>
<span class="co">#R&gt; 19 AH           1 NA        BO     1741     3     90    125</span></code></pre></div>
<p>Importantly, notice that the exact extension does not matter as <code>readxl</code> recognizes both <code>.xls</code> and <code>.xlsx</code>.<br />
Notice that if the file contains multiple sheets, these can all be accessed.</p>
<ul>
<li><code>excel_sheets</code> is a function that yields the names of the different sheets in a file.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">readxl<span class="op">::</span><span class="kw">excel_sheets</span>(<span class="st">&quot;data_china.xlsx&quot;</span>)
<span class="co">#R&gt; [1] &quot;AH&quot; &quot;FJ&quot;</span></code></pre></div>
<p>To know the specific sheets allows to call them directly by name. Alternatively, this can also be done by a number.</p>
<ul>
<li><p>The <code>sheet</code> argument specifies the required sheet either by a name or by a number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;data_china.xlsx&quot;</span>, <span class="dt">sheet=</span><span class="st">&quot;FJ&quot;</span>) </code></pre></div></li>
</ul>
<p>A specific range for the data to be read can also be specified. Here are arguments that allow that.</p>
<ul>
<li><code>n_max</code> for the maximum number of line to be read.</li>
<li><code>range</code> for a specific range, describe in one of the possible ways:</li>
<li>extreme cells of rectangular data: <code>range=&quot;B1:D10&quot;</code>,</li>
<li>with <code>cell_rows</code> for the required rows: <code>range=cell_rows(1:10)</code>,</li>
<li>with <code>cell_cols</code> for the required columns: <code>range=cell_cols(&quot;B:E&quot;)</code>.</li>
</ul>
<!--chapter:end:52-readr.Rmd-->
</div>
</div>
<div id="magrittr" class="section level1">
<h1><span class="header-section-number">21</span> <code>magrittr</code></h1>
<p>The package <code>magrittr</code> introduces an operator, the pipe <code>%&gt;%</code>, that allows a fully new way of coding in R. In a few words, that are not as clear as the examples below, the functions calls are now decomposed into steps and these steps are “<em>piped</em>” thanks to the operator <code>%&gt;%</code>.<br />
The advantages of this way include:</p>
<ul>
<li>the functions are read in steps from the left to right, as opposed to from the outside to the inside,<br />
</li>
<li>extra steps can easily be added at any point in the sequence,</li>
<li>nested calls are avoided.</li>
</ul>
<div id="how-to-pipe" class="section level2">
<h2><span class="header-section-number">21.1</span> How to pipe</h2>
<p>A basic pipeline is constructed under the following general idea: the call to the left of the pipe is used as an argument (by default the first argument) in the call to the right of the pipe.<br />
Using the mathematical notation for functions, the following statements give a pretty accurate idea of the procedure.</p>
<ul>
<li><code>x %&gt;% f</code> is equivalent to <code>f(x)</code></li>
</ul>
<p>This is the most basic rule for piping.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">42</span>)
<span class="kw">mean</span>(my_data)
<span class="co">#R&gt; [1] 10.54545</span>

my_data <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mean</span>()
<span class="co">#R&gt; [1] 10.54545</span></code></pre></div>
<p>Notice that it is usual to break lines after the pipe <code>%&gt;%</code> as it facilitates reading and addition of new steps. Also, the <code>()</code> pasted to <code>mean</code> is not necessary, but, again, it makes it clear that we pipe a vector into a function.<br />
Generally, the construction of the code must be re-thought as the calls above are read in reverse ways: <code>mean(my_data)</code> reads use the function <code>mean</code> on the vector <code>my_data</code>, while <code>my_data %&gt;% mean()</code> reads take the vector <code>my_data</code> and apply the function <code>mean</code> to it.</p>
<ul>
<li><code>x %&gt;% f(y)</code> is equivalent to <code>f(x, y)</code></li>
</ul>
<p>This rule shows how the left-to-pipe element is used as first argument in the right-to-pipe call. Recall this property as the <em>first argument rule</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(magrittr)
my_data &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">42</span>)
<span class="kw">mean</span>(my_data, <span class="dt">trim=</span><span class="fl">0.1</span>)
<span class="co">#R&gt; [1] 8</span>

my_data <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mean</span>(<span class="dt">trim=</span><span class="fl">0.1</span>)
<span class="co">#R&gt; [1] 8</span></code></pre></div>
<ul>
<li><code>x %&gt;% f %&gt;% g %&gt;% h</code> is equivalent to <code>h(g(f(x)))</code></li>
</ul>
<p>This rule shows that the pipeline can include many steps.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">42</span>)
<span class="kw">round</span>(<span class="kw">sqrt</span>(<span class="kw">mean</span>(my_data)),<span class="dv">2</span>)
<span class="co">#R&gt; [1] 3.25</span>

my_data <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mean</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">sqrt</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">round</span>(<span class="dv">2</span>)
<span class="co">#R&gt; [1] 3.25</span></code></pre></div>
</div>
<div id="using-a-placeholder" class="section level2">
<h2><span class="header-section-number">21.2</span> Using a placeholder</h2>
<p>One can actually decide where the left-to-pipe element should be included in the right-to-pipe call. For that, use a dot, <code>.</code>, as a placeholder in the right-to-pipe call.</p>
<ul>
<li><code>x %&gt;% f(y, .)</code> is equivalent to <code>f(y, x)</code></li>
</ul>
<p>The <code>.</code> indicates where the left-to-pipe element should be used.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(<span class="fl">17.23893</span>,<span class="dv">3</span>)
<span class="co">#R&gt; [1] 17.239</span>

<span class="dv">3</span> <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">round</span>(<span class="fl">17.23893</span>, .)
<span class="co">#R&gt; [1] 17.239</span></code></pre></div>
<ul>
<li><code>x %&gt;% f(y, z = .)</code> is equivalent to <code>f(y, z = x)</code></li>
</ul>
<p>Notice that the left-to-pipe element need not be an argument, but can also be the value of an argument.</p>
</div>
<div id="multiple-placeholders" class="section level2">
<h2><span class="header-section-number">21.3</span> Multiple placeholders</h2>
<p>The placeholder can be used multiple times. Notice, however, that if the placeholder is not an argument (but simply a value of an argument), then <code>magrittr</code> still applies the <em>first argument rule</em>, unless the call on the right-to-pipe is enclosed in curly brackets.</p>
<ul>
<li><p><code>x %&gt;% f(y = nrow(.), z = ncol(.))</code> is equivalent to <code>f(x, y = nrow(x), z = ncol(x))</code></p></li>
<li><p><code>x %&gt;% {f(y = nrow(.), z = ncol(.))}</code> is equivalent to <code>f(y = nrow(x), z = ncol(x))</code></p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">data</span>(iris)


t_iris &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(iris)
t_iris2 &lt;-<span class="st"> </span>t_iris[t_iris<span class="op">$</span>Sepal.Length<span class="op">==</span><span class="dv">5</span>, ]
av.sw &lt;-<span class="st"> </span><span class="kw">mean</span>(t_iris2<span class="op">$</span>Sepal.Width) 
av.sw
<span class="co">#R&gt; [1] 3.12</span>

av.sw2 &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span>
<span class="st">            </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">            </span>.[.<span class="op">$</span>Sepal.Length<span class="op">==</span><span class="dv">5</span>, ] <span class="op">%&gt;%</span>
<span class="st">            </span>{<span class="kw">mean</span>(.<span class="op">$</span>Sepal.Width)}
av.sw2  
<span class="co">#R&gt; [1] 3.12</span></code></pre></div>
<!--chapter:end:53-magrittr.Rmd-->
<p>Strings are not glamorous, high-profile components of R, but they do play a big role in many data cleaning and preparation tasks. The stringr package provide a cohesive set of functions designed to make working with strings as easy as possible. If you’re not familiar with strings, the best place to start is the chapter on strings in R for Data Science.</p>
<p>stringr is built on top of stringi, which uses the ICU C library to provide fast, correct implementations of common string manipulations. stringr focusses on the most important and commonly used string manipulation functions whereas stringi provides a comprehensive set covering almost anything you can imagine. If you find that stringr is missing a function that you need, try looking in stringi. Both packages share similar conventions, so once you’ve mastered stringr, you should find stringi similarly easy to use.</p>
<p>Installation # Install the released version from CRAN: install.packages(“stringr”)</p>
</div>
</div>
<div id="install-the-cutting-edge-development-version-from-github" class="section level1">
<h1><span class="header-section-number">22</span> Install the cutting edge development version from GitHub:</h1>
</div>
<div id="install.packagesdevtools" class="section level1">
<h1><span class="header-section-number">23</span> install.packages(“devtools”)</h1>
<p>devtools::install_github(“tidyverse/stringr”) Cheatsheet</p>
<p>Usage All functions in stringr start with str_ and take a vector of strings as the first argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;stadium&quot;</span>, <span class="st">&quot;football&quot;</span>, <span class="st">&quot;players&quot;</span>, <span class="st">&quot;halftime&quot;</span>, <span class="st">&quot;referee&quot;</span>, <span class="st">&quot;goalkeeper&quot;</span>)
<span class="kw">str_length</span>(x) 
<span class="co">#R&gt; [1]  7  8  7  8  7 10</span>

<span class="kw">str_c</span>(x, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)
<span class="co">#R&gt; [1] &quot;stadium, football, players, halftime, referee, goalkeeper&quot;</span>

<span class="kw">str_sub</span>(x, <span class="dv">1</span>, <span class="dv">3</span>)
<span class="co">#R&gt; [1] &quot;sta&quot; &quot;foo&quot; &quot;pla&quot; &quot;hal&quot; &quot;ref&quot; &quot;goa&quot;</span></code></pre></div>
<p>There are seven main verbs that work with patterns:</p>
<p>str_detect(x, pattern) tells you if there’s any match to the pattern.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_detect</span>(x, <span class="st">&quot;[a]&quot;</span>)
<span class="co">#R&gt; [1]  TRUE  TRUE  TRUE  TRUE FALSE  TRUE</span></code></pre></div>
<p>str_count(x, pattern) counts the number of patterns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_count</span>(x, <span class="st">&quot;[a]&quot;</span>)
<span class="co">#R&gt; [1] 1 1 1 1 0 1</span></code></pre></div>
<p>str_subset(x, pattern) extracts the matching components.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_subset</span>(x, <span class="st">&quot;[r]&quot;</span>)
<span class="co">#R&gt; [1] &quot;players&quot;    &quot;referee&quot;    &quot;goalkeeper&quot;</span></code></pre></div>
<p>str_locate(x, pattern) gives the position of the match.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_locate</span>(x, <span class="st">&quot;[a]&quot;</span>)
<span class="co">#R&gt;      start end</span>
<span class="co">#R&gt; [1,]     3   3</span>
<span class="co">#R&gt; [2,]     6   6</span>
<span class="co">#R&gt; [3,]     3   3</span>
<span class="co">#R&gt; [4,]     2   2</span>
<span class="co">#R&gt; [5,]    NA  NA</span>
<span class="co">#R&gt; [6,]     3   3</span></code></pre></div>
<p>str_extract(x, pattern) extracts the text of the match.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_extract</span>(x, <span class="st">&quot;[a]&quot;</span>)
<span class="co">#R&gt; [1] &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;a&quot; NA  &quot;a&quot;</span></code></pre></div>
<p>str_match(x, pattern) extracts parts of the match defined by parentheses.</p>
</div>
<div id="extract-the-characters-on-either-side-of-the-vowel" class="section level1">
<h1><span class="header-section-number">24</span> extract the characters on either side of the vowel</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_match</span>(x, <span class="st">&quot;(.)[ae](.)&quot;</span>)
<span class="co">#R&gt;      [,1]  [,2] [,3]</span>
<span class="co">#R&gt; [1,] &quot;tad&quot; &quot;t&quot;  &quot;d&quot; </span>
<span class="co">#R&gt; [2,] &quot;bal&quot; &quot;b&quot;  &quot;l&quot; </span>
<span class="co">#R&gt; [3,] &quot;lay&quot; &quot;l&quot;  &quot;y&quot; </span>
<span class="co">#R&gt; [4,] &quot;hal&quot; &quot;h&quot;  &quot;l&quot; </span>
<span class="co">#R&gt; [5,] &quot;ref&quot; &quot;r&quot;  &quot;f&quot; </span>
<span class="co">#R&gt; [6,] &quot;oal&quot; &quot;o&quot;  &quot;l&quot;</span></code></pre></div>
<p>str_replace(x, pattern, replacement) replaces the matches with new text.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_replace</span>(x, <span class="st">&quot;[aei]&quot;</span>, <span class="st">&quot;X&quot;</span>)
<span class="co">#R&gt; [1] &quot;stXdium&quot;    &quot;footbXll&quot;   &quot;plXyers&quot;    &quot;hXlftime&quot;   &quot;rXferee&quot;   </span>
<span class="co">#R&gt; [6] &quot;goXlkeeper&quot;</span></code></pre></div>
<p>str_split(x, pattern) splits up a string into multiple pieces.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_split</span>(<span class="kw">c</span>(<span class="st">&quot;a,b&quot;</span>, <span class="st">&quot;c,d,e&quot;</span>), <span class="st">&quot;,&quot;</span>)
<span class="co">#R&gt; [[1]]</span>
<span class="co">#R&gt; [1] &quot;a&quot; &quot;b&quot;</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; [[2]]</span>
<span class="co">#R&gt; [1] &quot;c&quot; &quot;d&quot; &quot;e&quot;</span></code></pre></div>
<!--chapter:end:54-stringr.Rmd-->
</div>
<div id="tidyr" class="section level1">
<h1><span class="header-section-number">25</span> <code>tidyr</code></h1>
<p>Among the many ways of organizing a dataset, the <code>tidyr</code> way is a convenient, thought-through and consistent way of thinking of a dataset.<br />
There are many types of messy data. We introduce here the tools to bring each to a tidy version.<br />
The general principle for creating tidy data is expressed in these three rules:</p>
<ul>
<li>every column is a variable,</li>
<li>every row is an observation,</li>
<li>every type of observation in a different table.</li>
</ul>
<p>The tidying of a data set is mainly obtained with two functions/verbs: <code>gather</code> and <code>spread</code>.<br />
Further tidying is obtained with the functions/verbs <code>separate</code> and <code>unite</code>.</p>
<div id="gather" class="section level2">
<h2><span class="header-section-number">25.1</span> <code>gather</code></h2>
<p><code>gather</code> takes multiple columns, and gathers them into key-value pairs. From a wide data set, we obtain a (vertically) longer data set.<br />
Let’s illustrate this verb with an example.</p>
<p>Consider the following data set that gives the gains of each person in a lottery between Monday and Thursday.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lottery &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">person=</span> <span class="kw">c</span>(<span class="st">&quot;Andre&quot;</span>,<span class="st">&quot;Beth&quot;</span>,<span class="st">&quot;Charles&quot;</span>),
                  <span class="dt">mon=</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>),
                  <span class="dt">tue=</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">4</span>),
                  <span class="dt">wed=</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">4</span>),
                  <span class="dt">thu=</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">7</span>)
                  )
lottery
<span class="co">#R&gt; # A tibble: 3 x 5</span>
<span class="co">#R&gt;   person    mon   tue   wed   thu</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#R&gt; 1 Andre       2     3    10     1</span>
<span class="co">#R&gt; 2 Beth        5     7     3     2</span>
<span class="co">#R&gt; 3 Charles     1     4     4     7</span></code></pre></div>
<p>This data set has 5 columns. Clearly, this does not correspond to 5 variables. Instead, a tidy data set should only include 3 columns for the variables ‘name’, ‘day’ and ‘gains’. Each row would then be an observation with one value for each of these variables: e.g., Beth won 7 on Tuesday.<br />
For the tidying, observe that the appropriate variable ‘day’ is spread across four columns ‘mon’, ‘tue’, ‘wed’ and ‘thu’. These must <code>gather</code>ed into one column/variable.</p>
<ul>
<li><code>tidyr</code> calls <code>key</code> the tidy variable whose values are the names of the messy columns (‘day’ in the example above),<br />
</li>
<li><code>tidyr</code> calls <code>value</code> the tidy variable whose values are spread over the messy cells (‘gains’ in the example above).</li>
</ul>
<p>The call of the function is then:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gather</span>(df, key, value, messy_col1, ..., messy_coln)</code></pre></div>
<p>In the example above, we would obtain the tidy data set in the following way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
tidy_lottery &lt;-<span class="st"> </span><span class="kw">gather</span>(lottery,
                        <span class="dt">key=</span> <span class="st">&quot;day&quot;</span>,
                        <span class="dt">value=</span> <span class="st">&quot;gains&quot;</span>,
                        mon<span class="op">:</span>thu
                        ) 
tidy_lottery
<span class="co">#R&gt; # A tibble: 12 x 3</span>
<span class="co">#R&gt;    person  day   gains</span>
<span class="co">#R&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#R&gt;  1 Andre   mon       2</span>
<span class="co">#R&gt;  2 Beth    mon       5</span>
<span class="co">#R&gt;  3 Charles mon       1</span>
<span class="co">#R&gt;  4 Andre   tue       3</span>
<span class="co">#R&gt;  5 Beth    tue       7</span>
<span class="co">#R&gt;  6 Charles tue       4</span>
<span class="co">#R&gt;  7 Andre   wed      10</span>
<span class="co">#R&gt;  8 Beth    wed       3</span>
<span class="co">#R&gt;  9 Charles wed       4</span>
<span class="co">#R&gt; 10 Andre   thu       1</span>
<span class="co">#R&gt; 11 Beth    thu       2</span>
<span class="co">#R&gt; 12 Charles thu       7</span></code></pre></div>
<p>Notice how <code>tidyr</code> understands the name of the columns when separated by <code>:</code>. It simply uses all the columns in the positions from (including) the first column given to the last (including) column given.<br />
Alternatively, one can obtain the same result by excluding variables to be gathered using the minus symbol <code>-</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_lottery &lt;-<span class="st"> </span><span class="kw">gather</span>(lottery, <span class="dt">key=</span><span class="st">&quot;day&quot;</span>, <span class="dt">value=</span><span class="st">&quot;gains&quot;</span>, <span class="op">-</span>person)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bisou &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>name, <span class="op">~</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>, <span class="op">~</span><span class="st">`</span><span class="dt">2017</span><span class="st">`</span>, <span class="op">~</span><span class="st">`</span><span class="dt">2018</span><span class="st">`</span>,
  <span class="st">&quot;gau&quot;</span>, <span class="dv">23</span>, <span class="dv">45</span>, <span class="dv">12</span>,
  <span class="st">&quot;tri&quot;</span>, <span class="dv">8</span>, <span class="dv">14</span>, <span class="dv">30</span>,
  <span class="st">&quot;han&quot;</span>, <span class="dv">12</span>, <span class="dv">43</span>, <span class="dv">8</span>
)

bisou
<span class="co">#R&gt; # A tibble: 3 x 4</span>
<span class="co">#R&gt;   name  `2016` `2017` `2018`</span>
<span class="co">#R&gt;   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#R&gt; 1 gau       23     45     12</span>
<span class="co">#R&gt; 2 tri        8     14     30</span>
<span class="co">#R&gt; 3 han       12     43      8</span>

tidy_bisou &lt;-<span class="st"> </span><span class="kw">gather</span>(bisou, <span class="dt">key=</span>year, <span class="dt">value=</span>kisses, <span class="st">`</span><span class="dt">2016</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2017</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2018</span><span class="st">`</span>)
  
tidy_bisou
<span class="co">#R&gt; # A tibble: 9 x 3</span>
<span class="co">#R&gt;   name  year  kisses</span>
<span class="co">#R&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#R&gt; 1 gau   2016      23</span>
<span class="co">#R&gt; 2 tri   2016       8</span>
<span class="co">#R&gt; 3 han   2016      12</span>
<span class="co">#R&gt; 4 gau   2017      45</span>
<span class="co">#R&gt; 5 tri   2017      14</span>
<span class="co">#R&gt; 6 han   2017      43</span>
<span class="co">#R&gt; 7 gau   2018      12</span>
<span class="co">#R&gt; 8 tri   2018      30</span>
<span class="co">#R&gt; 9 han   2018       8</span></code></pre></div>
</div>
<div id="spread" class="section level2">
<h2><span class="header-section-number">25.2</span> <code>spread</code></h2>
<p><code>spread</code> does the opposite of <code>gather</code>. It takes two columns (key &amp; value), and spreads into multiple columns: From a (vertically) long data set, we obtain a wider data set.<br />
Let’s illustrate this verb with an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">people &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">name=</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Andre&quot;</span>,<span class="st">&quot;Beth&quot;</span>,<span class="st">&quot;Charles&quot;</span>),<span class="dv">2</span>),
                  <span class="dt">info=</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;eyes&quot;</span>,<span class="st">&quot;age&quot;</span>),<span class="dv">3</span>),
                  <span class="dt">measure=</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="dv">23</span>, <span class="st">&quot;brown&quot;</span>, <span class="dv">31</span>, <span class="st">&quot;brown&quot;</span>, <span class="dv">19</span>)
                  )
people
<span class="co">#R&gt; # A tibble: 6 x 3</span>
<span class="co">#R&gt;   name    info  measure</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  </span>
<span class="co">#R&gt; 1 Andre   eyes  blue   </span>
<span class="co">#R&gt; 2 Beth    age   23     </span>
<span class="co">#R&gt; 3 Charles eyes  brown  </span>
<span class="co">#R&gt; 4 Andre   age   31     </span>
<span class="co">#R&gt; 5 Beth    eyes  brown  </span>
<span class="co">#R&gt; 6 Charles age   19</span>

people3 &lt;-<span class="st"> </span><span class="kw">rbind</span>(people, <span class="kw">c</span>(<span class="st">&quot;David&quot;</span>, <span class="st">&quot;height&quot;</span>, <span class="dv">175</span>))
people3
<span class="co">#R&gt; # A tibble: 7 x 3</span>
<span class="co">#R&gt;   name    info   measure</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  </span>
<span class="co">#R&gt; 1 Andre   eyes   blue   </span>
<span class="co">#R&gt; 2 Beth    age    23     </span>
<span class="co">#R&gt; 3 Charles eyes   brown  </span>
<span class="co">#R&gt; 4 Andre   age    31     </span>
<span class="co">#R&gt; 5 Beth    eyes   brown  </span>
<span class="co">#R&gt; 6 Charles age    19     </span>
<span class="co">#R&gt; 7 David   height 175</span>

people2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(
<span class="dt">name=</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Andre&quot;</span>,<span class="st">&quot;Beth&quot;</span>,<span class="st">&quot;Charles&quot;</span>),<span class="dv">2</span>),   <span class="st">&quot;David&quot;</span>),
<span class="dt">info=</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;eyes&quot;</span>,<span class="st">&quot;age&quot;</span>),<span class="dv">3</span>),    <span class="st">&quot;height&quot;</span>),
<span class="dt">measure=</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="dv">23</span>, <span class="st">&quot;brown&quot;</span>, <span class="dv">31</span>, <span class="st">&quot;brown&quot;</span>, <span class="dv">19</span>,   <span class="dv">175</span>)
                  )
people2
<span class="co">#R&gt; # A tibble: 7 x 3</span>
<span class="co">#R&gt;   name    info   measure</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  </span>
<span class="co">#R&gt; 1 Andre   eyes   blue   </span>
<span class="co">#R&gt; 2 Beth    age    23     </span>
<span class="co">#R&gt; 3 Charles eyes   brown  </span>
<span class="co">#R&gt; 4 Andre   age    31     </span>
<span class="co">#R&gt; 5 Beth    eyes   brown  </span>
<span class="co">#R&gt; 6 Charles age    19     </span>
<span class="co">#R&gt; 7 David   height 175</span>

tidy_people2 &lt;-<span class="st"> </span><span class="kw">spread</span>(people2, <span class="dt">key=</span>info, <span class="dt">value=</span>measure)
tidy_people2
<span class="co">#R&gt; # A tibble: 4 x 4</span>
<span class="co">#R&gt;   name    age   eyes  height</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; </span>
<span class="co">#R&gt; 1 Andre   31    blue  &lt;NA&gt;  </span>
<span class="co">#R&gt; 2 Beth    23    brown &lt;NA&gt;  </span>
<span class="co">#R&gt; 3 Charles 19    brown &lt;NA&gt;  </span>
<span class="co">#R&gt; 4 David   &lt;NA&gt;  &lt;NA&gt;  175</span></code></pre></div>
<p>Clearly, here, each single observation (of one person) has information over different rows. These must be <code>spread</code> into appropriate variables.<br />
Recall that the <code>key</code> refers to the tidy variable <em>vs</em> messy columns.<br />
Also, recall that <code>value</code> refers to the tidy variable <em>vs</em> messy cells.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_people &lt;-<span class="st"> </span><span class="kw">spread</span>(people, <span class="dt">key=</span>info, <span class="dt">value=</span>measure)
tidy_people
<span class="co">#R&gt; # A tibble: 3 x 3</span>
<span class="co">#R&gt;   name    age   eyes </span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;</span>
<span class="co">#R&gt; 1 Andre   31    blue </span>
<span class="co">#R&gt; 2 Beth    23    brown</span>
<span class="co">#R&gt; 3 Charles 19    brown</span></code></pre></div>
</div>
<div id="separate" class="section level2">
<h2><span class="header-section-number">25.3</span> <code>separate</code></h2>
<p><code>separate</code> is used on a column to separate its content into various columns.<br />
The simplest call is generally the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">separate</span>(df, messy_var, <span class="dt">into=</span><span class="kw">c</span>(tidy_var1, tidy_var2))</code></pre></div>
<p>We now illustrate the use of this verb.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clients &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">info=</span><span class="kw">c</span>(<span class="st">&quot;Andre, Boston&quot;</span>,<span class="st">&quot;Beth, Tokyo&quot;</span>,<span class="st">&quot;Charles, Porto&quot;</span>))
clients
<span class="co">#R&gt; # A tibble: 3 x 1</span>
<span class="co">#R&gt;   info          </span>
<span class="co">#R&gt;   &lt;chr&gt;         </span>
<span class="co">#R&gt; 1 Andre, Boston </span>
<span class="co">#R&gt; 2 Beth, Tokyo   </span>
<span class="co">#R&gt; 3 Charles, Porto</span>

tidy_clients &lt;-<span class="st"> </span><span class="kw">separate</span>(clients,
                          info,
                          <span class="dt">into=</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;city&quot;</span>)
                          )
tidy_clients
<span class="co">#R&gt; # A tibble: 3 x 2</span>
<span class="co">#R&gt;   name    city  </span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt; </span>
<span class="co">#R&gt; 1 Andre   Boston</span>
<span class="co">#R&gt; 2 Beth    Tokyo </span>
<span class="co">#R&gt; 3 Charles Porto</span></code></pre></div>
<p>By default, the separation is made on a character that is neither a number nor a letter. But we can also define the separation character.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">separate</span>(clients,
          info,
          <span class="dt">into=</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;city&quot;</span>),
          <span class="dt">sep=</span> <span class="st">&quot;t&quot;</span>
          )
<span class="co">#R&gt; # A tibble: 3 x 2</span>
<span class="co">#R&gt;   name         city    </span>
<span class="co">#R&gt;   &lt;chr&gt;        &lt;chr&gt;   </span>
<span class="co">#R&gt; 1 Andre, Bos   on      </span>
<span class="co">#R&gt; 2 Be           h, Tokyo</span>
<span class="co">#R&gt; 3 Charles, Por o</span></code></pre></div>
<p>Furthermore, we can also <code>separate</code> based on the number of characters in the values of the variable. Positive integers are used to start from the left while negative integers start from the right.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">separate</span>(clients,
          info,
          <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;city&quot;</span>),
          <span class="dt">sep=</span><span class="dv">4</span>
          )
<span class="co">#R&gt; # A tibble: 3 x 2</span>
<span class="co">#R&gt;   name  city      </span>
<span class="co">#R&gt;   &lt;chr&gt; &lt;chr&gt;     </span>
<span class="co">#R&gt; 1 Andr  e, Boston </span>
<span class="co">#R&gt; 2 Beth  , Tokyo   </span>
<span class="co">#R&gt; 3 Char  les, Porto</span>

<span class="kw">separate</span>(clients,
          info,
          <span class="dt">into=</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;city&quot;</span>),
          <span class="dt">sep=</span> <span class="op">-</span><span class="dv">3</span>
          )
<span class="co">#R&gt; # A tibble: 3 x 2</span>
<span class="co">#R&gt;   name        city </span>
<span class="co">#R&gt;   &lt;chr&gt;       &lt;chr&gt;</span>
<span class="co">#R&gt; 1 Andre, Bos  ton  </span>
<span class="co">#R&gt; 2 Beth, To    kyo  </span>
<span class="co">#R&gt; 3 Charles, Po rto</span></code></pre></div>
</div>
<div id="unite" class="section level2">
<h2><span class="header-section-number">25.4</span> <code>unite</code></h2>
<p><code>unite</code> is used on columns to gather their content into one variable.<br />
The simplest call is generally the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unite</span>(df, tidy_var, messy_var1, messy_var2, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</code></pre></div>
<p>A main use of this verb is to paste characters from various columns.<br />
By default, these character values are united with a <code>_</code> in between, but the separator can be chosen.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mail &lt;-<span class="st"> </span><span class="kw">unite</span>(tidy_clients, mail, name, city, <span class="dt">sep=</span><span class="st">&quot;@&quot;</span>)
mail
<span class="co">#R&gt; # A tibble: 3 x 1</span>
<span class="co">#R&gt;   mail         </span>
<span class="co">#R&gt;   &lt;chr&gt;        </span>
<span class="co">#R&gt; 1 Andre@Boston </span>
<span class="co">#R&gt; 2 Beth@Tokyo   </span>
<span class="co">#R&gt; 3 Charles@Porto</span></code></pre></div>
<!--chapter:end:55-tidyr.Rmd-->
</div>
</div>
<div id="dplyr" class="section level1">
<h1><span class="header-section-number">26</span> <code>dplyr</code></h1>
<p>There are essentially two parts in this package, both dealing with manipulating data set.<br />
The first gives tools to work on a given data frame, the second to combine data frames. We describe both in turn.</p>
<div id="grammar-of-data-manipulation" class="section level2">
<h2><span class="header-section-number">26.1</span> Grammar of data manipulation</h2>
<p><code>dplyr</code> introduces a easier and faster way to manipulate datasets and extract information from them.<br />
Hence, all the functions introduced here are redundant with other functions in base R. As for the rest of the <code>tidyverse</code>, they just happen to do the job in a clearer way (among other advantages).<br />
The approach builds on “verbs” (functions) applied successively thanks to the pipe operator <code>%&gt;%</code>.</p>
<p>The five main verbs are the following:</p>
<ul>
<li><code>select</code></li>
<li><code>mutate</code></li>
<li><code>filter</code></li>
<li><code>arrange</code></li>
<li><code>summarize</code></li>
</ul>
<p>These operations can be made on groups thanks to the function <code>group_by</code>.<br />
A few comments before we describe the verbs are in turn.</p>
<ul>
<li>These verbs are better used in tidy data:</li>
<li>each column is a variable,<br />
</li>
<li><p>each row is an observation.</p></li>
<li><p><code>select</code> and <code>mutate</code> manipulate/apply on the variables (columns).</p></li>
<li><p><code>filter</code> and <code>arrange</code> manipulate/apply on the observations (rows).</p></li>
<li><p><code>summarise</code> manipulates groups of observations.</p></li>
<li><p>Like in other packages of the <code>tidyverse</code>, there is no need for the usual quotes <code>&quot; &quot;</code> for the names.</p></li>
</ul>
<p>For the examples below, we will be using the <code>starwars</code> data set from the <code>dplyr</code>package. So, we can first have a glimpse at it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars
<span class="co">#R&gt; # A tibble: 87 x 13</span>
<span class="co">#R&gt;    name  height  mass hair_color skin_color eye_color birth_year gender</span>
<span class="co">#R&gt;    &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#R&gt;  1 Luke…    172    77 blond      fair       blue            19   male  </span>
<span class="co">#R&gt;  2 C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;  </span>
<span class="co">#R&gt;  3 R2-D2     96    32 &lt;NA&gt;       white, bl… red             33   &lt;NA&gt;  </span>
<span class="co">#R&gt;  4 Dart…    202   136 none       white      yellow          41.9 male  </span>
<span class="co">#R&gt;  5 Leia…    150    49 brown      light      brown           19   female</span>
<span class="co">#R&gt;  6 Owen…    178   120 brown, gr… light      blue            52   male  </span>
<span class="co">#R&gt;  7 Beru…    165    75 brown      light      blue            47   female</span>
<span class="co">#R&gt;  8 R5-D4     97    32 &lt;NA&gt;       white, red red             NA   &lt;NA&gt;  </span>
<span class="co">#R&gt;  9 Bigg…    183    84 black      light      brown           24   male  </span>
<span class="co">#R&gt; 10 Obi-…    182    77 auburn, w… fair       blue-gray       57   male  </span>
<span class="co">#R&gt; # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;,</span>
<span class="co">#R&gt; #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</span></code></pre></div>
</div>
<div id="select" class="section level2">
<h2><span class="header-section-number">26.2</span> <code>select</code></h2>
<p>The call for this function is of the form:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(df, var1, ..., varn)</code></pre></div>
<p>where <code>df</code> is the original data frame from which one wishes to select data.<br />
Alternatively, we can write the above code. with the pipe operator</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(var1, ..., varn)</code></pre></div>
<p>Notice that the underlying data frame is not modified. However, the extracted data can be saved in the usual way, i.e., as an object with a name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">piece_df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">select</span>(var1, ..., varn)</code></pre></div>
<p>Here is an example of a selection of variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(name, species)
<span class="co">#R&gt; # A tibble: 87 x 2</span>
<span class="co">#R&gt;    name               species</span>
<span class="co">#R&gt;    &lt;chr&gt;              &lt;chr&gt;  </span>
<span class="co">#R&gt;  1 Luke Skywalker     Human  </span>
<span class="co">#R&gt;  2 C-3PO              Droid  </span>
<span class="co">#R&gt;  3 R2-D2              Droid  </span>
<span class="co">#R&gt;  4 Darth Vader        Human  </span>
<span class="co">#R&gt;  5 Leia Organa        Human  </span>
<span class="co">#R&gt;  6 Owen Lars          Human  </span>
<span class="co">#R&gt;  7 Beru Whitesun lars Human  </span>
<span class="co">#R&gt;  8 R5-D4              Droid  </span>
<span class="co">#R&gt;  9 Biggs Darklighter  Human  </span>
<span class="co">#R&gt; 10 Obi-Wan Kenobi     Human  </span>
<span class="co">#R&gt; # … with 77 more rows</span>

<span class="co"># compare with base R</span>

starwars[,<span class="kw">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;species&quot;</span>)]
<span class="co">#R&gt; # A tibble: 87 x 2</span>
<span class="co">#R&gt;    name               species</span>
<span class="co">#R&gt;    &lt;chr&gt;              &lt;chr&gt;  </span>
<span class="co">#R&gt;  1 Luke Skywalker     Human  </span>
<span class="co">#R&gt;  2 C-3PO              Droid  </span>
<span class="co">#R&gt;  3 R2-D2              Droid  </span>
<span class="co">#R&gt;  4 Darth Vader        Human  </span>
<span class="co">#R&gt;  5 Leia Organa        Human  </span>
<span class="co">#R&gt;  6 Owen Lars          Human  </span>
<span class="co">#R&gt;  7 Beru Whitesun lars Human  </span>
<span class="co">#R&gt;  8 R5-D4              Droid  </span>
<span class="co">#R&gt;  9 Biggs Darklighter  Human  </span>
<span class="co">#R&gt; 10 Obi-Wan Kenobi     Human  </span>
<span class="co">#R&gt; # … with 77 more rows</span></code></pre></div>
<p>There are any ways of selecting variables</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## columns/variables 1 to 4
<span class="kw">select</span>(starwars, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) 
## works also with the name
<span class="kw">select</span>(starwars, name<span class="op">:</span>hair_color) 
## with a negative number for all but some variable
<span class="kw">select</span>(starwars, <span class="op">-</span><span class="dv">3</span>) 
## works also with the name
<span class="kw">select</span>(starwars, <span class="op">-</span>mass) </code></pre></div>
<div id="helper-arguments" class="section level3">
<h3><span class="header-section-number">26.2.1</span> Helper arguments</h3>
<p>These are arguments to help <code>select</code> the variables/columns. Here are a few of them (see <code>?select</code> for a complete list):</p>
<ul>
<li><code>starts_with(&quot;x&quot;)</code></li>
<li><code>ends_with(&quot;x&quot;)</code></li>
<li><code>contains(&quot;x&quot;)</code></li>
<li><code>matches(&quot;x&quot;)</code></li>
</ul>
<p>Notice the use of the quotes <code>&quot; &quot;</code> for the strings because they are not variables names.<br />
For instance, here, we select all the variables that have <code>color</code> in their name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(
    name,
    <span class="kw">matches</span>(<span class="st">&quot;color&quot;</span>)
    )
<span class="co">#R&gt; # A tibble: 87 x 4</span>
<span class="co">#R&gt;    name               hair_color    skin_color  eye_color</span>
<span class="co">#R&gt;    &lt;chr&gt;              &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    </span>
<span class="co">#R&gt;  1 Luke Skywalker     blond         fair        blue     </span>
<span class="co">#R&gt;  2 C-3PO              &lt;NA&gt;          gold        yellow   </span>
<span class="co">#R&gt;  3 R2-D2              &lt;NA&gt;          white, blue red      </span>
<span class="co">#R&gt;  4 Darth Vader        none          white       yellow   </span>
<span class="co">#R&gt;  5 Leia Organa        brown         light       brown    </span>
<span class="co">#R&gt;  6 Owen Lars          brown, grey   light       blue     </span>
<span class="co">#R&gt;  7 Beru Whitesun lars brown         light       blue     </span>
<span class="co">#R&gt;  8 R5-D4              &lt;NA&gt;          white, red  red      </span>
<span class="co">#R&gt;  9 Biggs Darklighter  black         light       brown    </span>
<span class="co">#R&gt; 10 Obi-Wan Kenobi     auburn, white fair        blue-gray</span>
<span class="co">#R&gt; # … with 77 more rows</span>

starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(name, gender, films)
<span class="co">#R&gt; # A tibble: 87 x 3</span>
<span class="co">#R&gt;    name               gender films    </span>
<span class="co">#R&gt;    &lt;chr&gt;              &lt;chr&gt;  &lt;list&gt;   </span>
<span class="co">#R&gt;  1 Luke Skywalker     male   &lt;chr [5]&gt;</span>
<span class="co">#R&gt;  2 C-3PO              &lt;NA&gt;   &lt;chr [6]&gt;</span>
<span class="co">#R&gt;  3 R2-D2              &lt;NA&gt;   &lt;chr [7]&gt;</span>
<span class="co">#R&gt;  4 Darth Vader        male   &lt;chr [4]&gt;</span>
<span class="co">#R&gt;  5 Leia Organa        female &lt;chr [5]&gt;</span>
<span class="co">#R&gt;  6 Owen Lars          male   &lt;chr [3]&gt;</span>
<span class="co">#R&gt;  7 Beru Whitesun lars female &lt;chr [3]&gt;</span>
<span class="co">#R&gt;  8 R5-D4              &lt;NA&gt;   &lt;chr [1]&gt;</span>
<span class="co">#R&gt;  9 Biggs Darklighter  male   &lt;chr [1]&gt;</span>
<span class="co">#R&gt; 10 Obi-Wan Kenobi     male   &lt;chr [6]&gt;</span>
<span class="co">#R&gt; # … with 77 more rows</span></code></pre></div>
</div>
</div>
<div id="mutate" class="section level2">
<h2><span class="header-section-number">26.3</span> <code>mutate</code></h2>
<p>The <code>mutate</code> function allows to create new variables/columns, based on the existing variables.<br />
The generic call is as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(df, <span class="dt">new_variable =</span> expression)

<span class="co"># with pipe</span>

df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">new_variable =</span> expression)</code></pre></div>
<p>We play a bit with it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## add variable bmi
starwars <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">mutate</span>(<span class="dt">bmi =</span> mass <span class="op">/</span><span class="st"> </span>(height<span class="op">/</span><span class="dv">100</span>)<span class="op">^</span><span class="dv">2</span> )  
<span class="co">#R&gt; # A tibble: 87 x 14</span>
<span class="co">#R&gt;    name  height  mass hair_color skin_color eye_color birth_year gender</span>
<span class="co">#R&gt;    &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#R&gt;  1 Luke…    172    77 blond      fair       blue            19   male  </span>
<span class="co">#R&gt;  2 C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;  </span>
<span class="co">#R&gt;  3 R2-D2     96    32 &lt;NA&gt;       white, bl… red             33   &lt;NA&gt;  </span>
<span class="co">#R&gt;  4 Dart…    202   136 none       white      yellow          41.9 male  </span>
<span class="co">#R&gt;  5 Leia…    150    49 brown      light      brown           19   female</span>
<span class="co">#R&gt;  6 Owen…    178   120 brown, gr… light      blue            52   male  </span>
<span class="co">#R&gt;  7 Beru…    165    75 brown      light      blue            47   female</span>
<span class="co">#R&gt;  8 R5-D4     97    32 &lt;NA&gt;       white, red red             NA   &lt;NA&gt;  </span>
<span class="co">#R&gt;  9 Bigg…    183    84 black      light      brown           24   male  </span>
<span class="co">#R&gt; 10 Obi-…    182    77 auburn, w… fair       blue-gray       57   male  </span>
<span class="co">#R&gt; # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;,</span>
<span class="co">#R&gt; #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;,</span>
<span class="co">#R&gt; #   bmi &lt;dbl&gt;</span>

## two variables created, including one created in the same call
df_b &lt;-<span class="st"> </span>starwars <span class="op">%&gt;%</span>
<span class="st">          </span><span class="kw">mutate</span>(
            <span class="dt">bmi =</span> mass <span class="op">/</span><span class="st"> </span>(height<span class="op">/</span><span class="dv">100</span>)<span class="op">^</span><span class="dv">2</span>,
            <span class="dt">sr.bmi =</span> <span class="kw">sqrt</span>(bmi)
            ) 
df_b
<span class="co">#R&gt; # A tibble: 87 x 15</span>
<span class="co">#R&gt;    name  height  mass hair_color skin_color eye_color birth_year gender</span>
<span class="co">#R&gt;    &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#R&gt;  1 Luke…    172    77 blond      fair       blue            19   male  </span>
<span class="co">#R&gt;  2 C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;  </span>
<span class="co">#R&gt;  3 R2-D2     96    32 &lt;NA&gt;       white, bl… red             33   &lt;NA&gt;  </span>
<span class="co">#R&gt;  4 Dart…    202   136 none       white      yellow          41.9 male  </span>
<span class="co">#R&gt;  5 Leia…    150    49 brown      light      brown           19   female</span>
<span class="co">#R&gt;  6 Owen…    178   120 brown, gr… light      blue            52   male  </span>
<span class="co">#R&gt;  7 Beru…    165    75 brown      light      blue            47   female</span>
<span class="co">#R&gt;  8 R5-D4     97    32 &lt;NA&gt;       white, red red             NA   &lt;NA&gt;  </span>
<span class="co">#R&gt;  9 Bigg…    183    84 black      light      brown           24   male  </span>
<span class="co">#R&gt; 10 Obi-…    182    77 auburn, w… fair       blue-gray       57   male  </span>
<span class="co">#R&gt; # … with 77 more rows, and 7 more variables: homeworld &lt;chr&gt;,</span>
<span class="co">#R&gt; #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;,</span>
<span class="co">#R&gt; #   bmi &lt;dbl&gt;, sr.bmi &lt;dbl&gt;</span>

starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">g_b =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;B&quot;</span>),
                 <span class="dv">87</span>,
                 <span class="dt">replace =</span> <span class="ot">TRUE</span>
                 )
    )
<span class="co">#R&gt; # A tibble: 87 x 14</span>
<span class="co">#R&gt;    name  height  mass hair_color skin_color eye_color birth_year gender</span>
<span class="co">#R&gt;    &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#R&gt;  1 Luke…    172    77 blond      fair       blue            19   male  </span>
<span class="co">#R&gt;  2 C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;  </span>
<span class="co">#R&gt;  3 R2-D2     96    32 &lt;NA&gt;       white, bl… red             33   &lt;NA&gt;  </span>
<span class="co">#R&gt;  4 Dart…    202   136 none       white      yellow          41.9 male  </span>
<span class="co">#R&gt;  5 Leia…    150    49 brown      light      brown           19   female</span>
<span class="co">#R&gt;  6 Owen…    178   120 brown, gr… light      blue            52   male  </span>
<span class="co">#R&gt;  7 Beru…    165    75 brown      light      blue            47   female</span>
<span class="co">#R&gt;  8 R5-D4     97    32 &lt;NA&gt;       white, red red             NA   &lt;NA&gt;  </span>
<span class="co">#R&gt;  9 Bigg…    183    84 black      light      brown           24   male  </span>
<span class="co">#R&gt; 10 Obi-…    182    77 auburn, w… fair       blue-gray       57   male  </span>
<span class="co">#R&gt; # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;,</span>
<span class="co">#R&gt; #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;,</span>
<span class="co">#R&gt; #   g_b &lt;chr&gt;</span></code></pre></div>
</div>
<div id="filter" class="section level2">
<h2><span class="header-section-number">26.4</span> <code>filter</code></h2>
<p>The <code>filter</code> function is equivalent of a selection, but for rows. The call is generically</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(df, condition)

<span class="co"># with the pipe</span>

df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(condition) </code></pre></div>
<p>At this stage, it might be useful to recall the operators for conditions under <code>?Comparison</code>.<br />
Here are examples for this function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(species <span class="op">!=</span><span class="st"> &quot;Human&quot;</span>)
<span class="co">#R&gt; # A tibble: 47 x 13</span>
<span class="co">#R&gt;    name  height  mass hair_color skin_color eye_color birth_year gender</span>
<span class="co">#R&gt;    &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#R&gt;  1 C-3PO    167    75 &lt;NA&gt;       gold       yellow           112 &lt;NA&gt;  </span>
<span class="co">#R&gt;  2 R2-D2     96    32 &lt;NA&gt;       white, bl… red               33 &lt;NA&gt;  </span>
<span class="co">#R&gt;  3 R5-D4     97    32 &lt;NA&gt;       white, red red               NA &lt;NA&gt;  </span>
<span class="co">#R&gt;  4 Chew…    228   112 brown      unknown    blue             200 male  </span>
<span class="co">#R&gt;  5 Gree…    173    74 &lt;NA&gt;       green      black             44 male  </span>
<span class="co">#R&gt;  6 Jabb…    175  1358 &lt;NA&gt;       green-tan… orange           600 herma…</span>
<span class="co">#R&gt;  7 Yoda      66    17 white      green      brown            896 male  </span>
<span class="co">#R&gt;  8 IG-88    200   140 none       metal      red               15 none  </span>
<span class="co">#R&gt;  9 Bossk    190   113 none       green      red               53 male  </span>
<span class="co">#R&gt; 10 Ackb…    180    83 none       brown mot… orange            41 male  </span>
<span class="co">#R&gt; # … with 37 more rows, and 5 more variables: homeworld &lt;chr&gt;,</span>
<span class="co">#R&gt; #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</span>

starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(
    species <span class="op">!=</span><span class="st"> &quot;Human&quot;</span> <span class="op">&amp;</span>
<span class="st">    </span>eye_color <span class="op">==</span><span class="st"> &quot;red&quot;</span>
    )
<span class="co">#R&gt; # A tibble: 5 x 13</span>
<span class="co">#R&gt;   name  height  mass hair_color skin_color eye_color birth_year gender</span>
<span class="co">#R&gt;   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#R&gt; 1 R2-D2     96    32 &lt;NA&gt;       white, bl… red               33 &lt;NA&gt;  </span>
<span class="co">#R&gt; 2 R5-D4     97    32 &lt;NA&gt;       white, red red               NA &lt;NA&gt;  </span>
<span class="co">#R&gt; 3 IG-88    200   140 none       metal      red               15 none  </span>
<span class="co">#R&gt; 4 Bossk    190   113 none       green      red               53 male  </span>
<span class="co">#R&gt; 5 Nute…    191    90 none       mottled g… red               NA male  </span>
<span class="co">#R&gt; # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,</span>
<span class="co">#R&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;</span>

<span class="co"># in base R</span>

starwars[starwars<span class="op">$</span>species<span class="op">!=</span><span class="st">&quot;Human&quot;</span> <span class="op">&amp;</span><span class="st"> </span>starwars<span class="op">$</span>eye_color<span class="op">==</span><span class="st">&quot;red&quot;</span> , ]
<span class="co">#R&gt; # A tibble: 5 x 13</span>
<span class="co">#R&gt;   name  height  mass hair_color skin_color eye_color birth_year gender</span>
<span class="co">#R&gt;   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; </span>
<span class="co">#R&gt; 1 R2-D2     96    32 &lt;NA&gt;       white, bl… red               33 &lt;NA&gt;  </span>
<span class="co">#R&gt; 2 R5-D4     97    32 &lt;NA&gt;       white, red red               NA &lt;NA&gt;  </span>
<span class="co">#R&gt; 3 IG-88    200   140 none       metal      red               15 none  </span>
<span class="co">#R&gt; 4 Bossk    190   113 none       green      red               53 male  </span>
<span class="co">#R&gt; 5 Nute…    191    90 none       mottled g… red               NA male  </span>
<span class="co">#R&gt; # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,</span>
<span class="co">#R&gt; #   vehicles &lt;list&gt;, starships &lt;list&gt;</span></code></pre></div>
</div>
<div id="arrange" class="section level2">
<h2><span class="header-section-number">26.5</span> <code>arrange</code></h2>
<p>This function reorders the rows of the data set, by default in ascending order of a given variable. The typical call, for a reordering over <code>var1</code>, is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(df, var1)

<span class="co"># with pipe</span>

df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(var1)</code></pre></div>
<p>The use of multiple variables for reordering is sometimes necessary in order to break ties.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## in case of several rows with same value of var1, use var2
df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(
    var1,
    var2)</code></pre></div>
<p>Use <code>desc</code> on the variable to show in descending order.<br />
Here is an example that combines these two points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">arrange</span>(
          height, 
          <span class="kw">desc</span>(mass))

starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(name))</code></pre></div>
</div>
<div id="summarise" class="section level2">
<h2><span class="header-section-number">26.6</span> <code>summarise</code></h2>
<p>Contrary to the other verbs, the <code>summarise</code> function creates a new data frame. The usual call is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(df, <span class="dt">name =</span> expr)

<span class="co"># with the pipe</span>
df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">name =</span> expr)</code></pre></div>
<p>where <code>expr</code> stands for any function on a vector (most of the time, one of the variables) that returns a single value. That function can either be built-in or a function provided by the user.<br />
In that sense, notice that <code>summarise</code> does not mean to make a summary but, instead, to collapse a full vector into one single value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">min_h =</span> <span class="kw">min</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">av_m=</span> <span class="kw">mean</span>(mass, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
            )
<span class="co">#R&gt; # A tibble: 1 x 2</span>
<span class="co">#R&gt;   min_h  av_m</span>
<span class="co">#R&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#R&gt; 1    66  97.3</span></code></pre></div>
<div id="helper-functions" class="section level3">
<h3><span class="header-section-number">26.6.1</span> Helper functions</h3>
<p>These are functions to help <code>summarise</code>, but are essentially wrappers for the function <code>[[</code>. These include <code>first(x)</code>, <code>last(x)</code>, <code>nth(x,n)</code>, <code>n()</code>… where <code>x</code> is the variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">nth</span>(species, <span class="dv">3</span>))
<span class="co">#R&gt; # A tibble: 1 x 1</span>
<span class="co">#R&gt;   `nth(species, 3)`</span>
<span class="co">#R&gt;   &lt;chr&gt;            </span>
<span class="co">#R&gt; 1 Droid</span></code></pre></div>
<p>Other functions can be used as logical tests.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">sum</span>(species <span class="op">==</span><span class="st"> &quot;Human&quot;</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))
<span class="co">#R&gt; # A tibble: 1 x 1</span>
<span class="co">#R&gt;   `sum(species == &quot;Human&quot;, na.rm = TRUE)`</span>
<span class="co">#R&gt;                                     &lt;int&gt;</span>
<span class="co">#R&gt; 1                                      35</span>

starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(species <span class="op">!=</span><span class="st"> &quot;Human&quot;</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))
<span class="co">#R&gt; # A tibble: 1 x 1</span>
<span class="co">#R&gt;   `mean(species != &quot;Human&quot;, na.rm = TRUE)`</span>
<span class="co">#R&gt;                                      &lt;dbl&gt;</span>
<span class="co">#R&gt; 1                                    0.573</span></code></pre></div>
</div>
</div>
<div id="piping-verbs" class="section level2">
<h2><span class="header-section-number">26.7</span> Piping verbs</h2>
<p>Since each verb requires a data frame and returns a data frame, we can combine verbs in a pipe.<br />
Here is an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## average mass of humans 
starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(species <span class="op">==</span><span class="st"> &quot;Human&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">av_m=</span><span class="kw">mean</span>(mass, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))
<span class="co">#R&gt; # A tibble: 1 x 1</span>
<span class="co">#R&gt;    av_m</span>
<span class="co">#R&gt;   &lt;dbl&gt;</span>
<span class="co">#R&gt; 1  82.8</span>

<span class="co"># without pipe</span>
<span class="kw">summarise</span>(<span class="kw">filter</span>(starwars, species <span class="op">==</span><span class="st"> &quot;Human&quot;</span>), <span class="dt">av_m=</span><span class="kw">mean</span>(mass, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))
<span class="co">#R&gt; # A tibble: 1 x 1</span>
<span class="co">#R&gt;    av_m</span>
<span class="co">#R&gt;   &lt;dbl&gt;</span>
<span class="co">#R&gt; 1  82.8</span>

temp1 &lt;-<span class="st"> </span><span class="kw">filter</span>(starwars, species <span class="op">==</span><span class="st"> &quot;Human&quot;</span>)
<span class="kw">summarise</span>(temp1, <span class="dt">av_m=</span><span class="kw">mean</span>(mass, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))
<span class="co">#R&gt; # A tibble: 1 x 1</span>
<span class="co">#R&gt;    av_m</span>
<span class="co">#R&gt;   &lt;dbl&gt;</span>
<span class="co">#R&gt; 1  82.8</span>

<span class="co"># with base R</span>
temp2 &lt;-<span class="st"> </span>starwars[starwars<span class="op">$</span>species<span class="op">==</span><span class="st">&quot;Human&quot;</span>,]
av_m &lt;-<span class="st"> </span><span class="kw">mean</span>(temp2<span class="op">$</span>mass, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)

av_m &lt;-<span class="st"> </span><span class="kw">mean</span>(starwars[starwars<span class="op">$</span>species<span class="op">==</span><span class="st">&quot;Human&quot;</span>,]<span class="op">$</span>mass, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
av_m
<span class="co">#R&gt; [1] 82.78182</span></code></pre></div>
<p>Another example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create the variable n_films for each name</span>

<span class="co"># with base R</span>
aa &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(starwars<span class="op">$</span>films))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(starwars<span class="op">$</span>films)){
  aa[i] &lt;-<span class="st"> </span><span class="kw">length</span>(starwars<span class="op">$</span>films[[i]])
}

starwars<span class="op">$</span>n_films &lt;-<span class="st"> </span>aa

<span class="co"># with dplyr </span>
c_l &lt;-<span class="st"> </span><span class="cf">function</span>(ll){
  aa &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(ll))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(ll)){
   aa[i] &lt;-<span class="st"> </span><span class="kw">length</span>(ll[[i]])
  }
  <span class="kw">return</span>(aa)
}

starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_films =</span> <span class="kw">c_l</span>(films)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(name, n_films) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>( n_films <span class="op">&gt;=</span><span class="dv">5</span>)
<span class="co">#R&gt; # A tibble: 8 x 2</span>
<span class="co">#R&gt;   name           n_films</span>
<span class="co">#R&gt;   &lt;chr&gt;            &lt;dbl&gt;</span>
<span class="co">#R&gt; 1 Luke Skywalker       5</span>
<span class="co">#R&gt; 2 C-3PO                6</span>
<span class="co">#R&gt; 3 R2-D2                7</span>
<span class="co">#R&gt; 4 Leia Organa          5</span>
<span class="co">#R&gt; 5 Obi-Wan Kenobi       6</span>
<span class="co">#R&gt; 6 Chewbacca            5</span>
<span class="co">#R&gt; 7 Yoda                 5</span>
<span class="co">#R&gt; 8 Palpatine            5</span></code></pre></div>
</div>
<div id="group_by" class="section level2">
<h2><span class="header-section-number">26.8</span> <code>group_by</code></h2>
<p>The function <code>group_by</code> allows to make manipulations on groups.<br />
Let’s make an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(eye_color) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">n_per_group =</span> <span class="kw">n</span>()
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(n_per_group <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)
<span class="co">#R&gt; # A tibble: 8 x 2</span>
<span class="co">#R&gt;   eye_color n_per_group</span>
<span class="co">#R&gt;   &lt;chr&gt;           &lt;int&gt;</span>
<span class="co">#R&gt; 1 black              10</span>
<span class="co">#R&gt; 2 blue               19</span>
<span class="co">#R&gt; 3 brown              21</span>
<span class="co">#R&gt; 4 hazel               3</span>
<span class="co">#R&gt; 5 orange              8</span>
<span class="co">#R&gt; 6 red                 5</span>
<span class="co">#R&gt; 7 unknown             3</span>
<span class="co">#R&gt; 8 yellow             11</span></code></pre></div>
</div>
<div id="keys-for-joins" class="section level2">
<h2><span class="header-section-number">26.9</span> Keys for joins</h2>
<p><code>dplyr</code> also contains tools to join data sets. We have a glimpse at them here.<br />
Notice that joining data sets means forming a third data set with columns of a first and a second data set.</p>
<p>A key is a column or a combination of columns.<br />
In order to join two data sets, two keys: a primary and a secondary key.<br />
The primary key must <strong>uniquely identify the rows</strong> of the primary data set; hence it can consist on many variables.<br />
The secondary key only needs to match the primary key.</p>
<p>An example to illustrate this point uses the two following data sets <code>population</code> and <code>capital</code>.</p>
<ul>
<li><p>If <code>population</code> was the primary data set, then the variable <code>country</code> alone could not be the primary key because it has repeated values.</p></li>
<li><p>On the other hand, if <code>capitals</code> was the primary data set, then the variable <code>country</code> could be that primary key.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">population &lt;-<span class="st"> </span><span class="kw">tribble</span>(
<span class="op">~</span>country, <span class="op">~</span>year, <span class="op">~</span>population,
<span class="st">&quot;UK&quot;</span>, <span class="dv">2010</span>, <span class="fl">62.7</span>,
<span class="st">&quot;UK&quot;</span>, <span class="dv">2000</span>, <span class="fl">58.9</span>,
<span class="st">&quot;FR&quot;</span>, <span class="dv">2010</span>, <span class="dv">65</span>,
<span class="st">&quot;FR&quot;</span>, <span class="dv">2000</span>, <span class="fl">60.9</span>,
<span class="st">&quot;RSA&quot;</span>, <span class="dv">2010</span>, <span class="fl">50.7</span>,
<span class="st">&quot;PT&quot;</span>, <span class="dv">2010</span>, <span class="fl">10.5</span>
)

capitals &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>country, <span class="op">~</span>capital, 
  <span class="st">&quot;RSA&quot;</span>, <span class="st">&quot;Pretoria&quot;</span>,
  <span class="st">&quot;FR&quot;</span>, <span class="st">&quot;Paris&quot;</span>,
  <span class="st">&quot;UK&quot;</span>, <span class="st">&quot;London&quot;</span>,
  <span class="st">&quot;SP&quot;</span>, <span class="st">&quot;Madrid&quot;</span>
)</code></pre></div>
</div>
<div id="joins" class="section level2">
<h2><span class="header-section-number">26.10</span> Joins</h2>
<p>Some joins are called mutate because they create a new data set: left_, right_, inner_ or full_ joins are of this type. Filter joins include semi_ and anti_join and they filter one data set.</p>
<ul>
<li><code>left_join</code> and <code>right_join</code></li>
</ul>
<p>The usage is, for instance,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">left_join</span>(df1, df2, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;key1&quot;</span>, <span class="st">&quot;key2&quot;</span>))
<span class="co"># with pipe</span>
df1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(
    df2,
    <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;key1&quot;</span>, <span class="st">&quot;key2&quot;</span>)
    )</code></pre></div>
<p>This call will keep all the rows of <code>df1</code> and augment it with columns of <code>df2</code>. Notice that some <code>NA</code>s will be created and the rows on <code>df2</code> that do not match the primary key will not appear.<br />
<code>right_join</code> would do for <code>df2</code> what <code>left_join</code> join does for <code>df1</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">capitals <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(
    population,
    <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>
    )
<span class="co">#R&gt; # A tibble: 6 x 4</span>
<span class="co">#R&gt;   country capital   year population</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#R&gt; 1 RSA     Pretoria  2010       50.7</span>
<span class="co">#R&gt; 2 FR      Paris     2010       65  </span>
<span class="co">#R&gt; 3 FR      Paris     2000       60.9</span>
<span class="co">#R&gt; 4 UK      London    2010       62.7</span>
<span class="co">#R&gt; 5 UK      London    2000       58.9</span>
<span class="co">#R&gt; 6 SP      Madrid      NA       NA</span>

population <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(
    capitals,
    <span class="dt">by=</span> <span class="st">&quot;country&quot;</span>
    )
<span class="co">#R&gt; # A tibble: 6 x 4</span>
<span class="co">#R&gt;   country  year population capital </span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   </span>
<span class="co">#R&gt; 1 UK       2010       62.7 London  </span>
<span class="co">#R&gt; 2 UK       2000       58.9 London  </span>
<span class="co">#R&gt; 3 FR       2010       65   Paris   </span>
<span class="co">#R&gt; 4 FR       2000       60.9 Paris   </span>
<span class="co">#R&gt; 5 RSA      2010       50.7 Pretoria</span>
<span class="co">#R&gt; 6 PT       2010       10.5 &lt;NA&gt;</span></code></pre></div>
<ul>
<li><code>inner_join</code> and <code>full_join</code></li>
</ul>
<p>The call is similar to above.<br />
<code>inner</code> takes the rows that match in <strong>both</strong> datasets while <code>full</code> takes all the rows that match and those that do not match.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">capitals <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(
    population,
    <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>
    )
<span class="co">#R&gt; # A tibble: 5 x 4</span>
<span class="co">#R&gt;   country capital   year population</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#R&gt; 1 RSA     Pretoria  2010       50.7</span>
<span class="co">#R&gt; 2 FR      Paris     2010       65  </span>
<span class="co">#R&gt; 3 FR      Paris     2000       60.9</span>
<span class="co">#R&gt; 4 UK      London    2010       62.7</span>
<span class="co">#R&gt; 5 UK      London    2000       58.9</span>

capitals <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">full_join</span>(
    population,
    <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>
    )
<span class="co">#R&gt; # A tibble: 7 x 4</span>
<span class="co">#R&gt;   country capital   year population</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#R&gt; 1 RSA     Pretoria  2010       50.7</span>
<span class="co">#R&gt; 2 FR      Paris     2010       65  </span>
<span class="co">#R&gt; 3 FR      Paris     2000       60.9</span>
<span class="co">#R&gt; 4 UK      London    2010       62.7</span>
<span class="co">#R&gt; 5 UK      London    2000       58.9</span>
<span class="co">#R&gt; 6 SP      Madrid      NA       NA  </span>
<span class="co">#R&gt; 7 PT      &lt;NA&gt;      2010       10.5</span></code></pre></div>
<ul>
<li><code>semi_join</code> and <code>anti_join</code></li>
</ul>
<p>These give a copy of the first data set filtered with the second data set. Hence, it’s a way to filter data from the first dataset based on information in a second dataset.<br />
It can be used to quickly check which rows appear in both datasets</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">capitals <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">semi_join</span>(
    population,
    <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>
    )
<span class="co">#R&gt; # A tibble: 3 x 2</span>
<span class="co">#R&gt;   country capital </span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt;   </span>
<span class="co">#R&gt; 1 RSA     Pretoria</span>
<span class="co">#R&gt; 2 FR      Paris   </span>
<span class="co">#R&gt; 3 UK      London</span>

capitals <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(
    population,
    <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>
    )
<span class="co">#R&gt; # A tibble: 1 x 2</span>
<span class="co">#R&gt;   country capital</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;chr&gt;  </span>
<span class="co">#R&gt; 1 SP      Madrid</span></code></pre></div>
</div>
<div id="operations-on-data-sets" class="section level2">
<h2><span class="header-section-number">26.11</span> Operations on data sets</h2>
<p>A few other functions allow to compare data sets. These include the self-explanatory <code>union</code>, <code>intersect</code> and <code>setdiff</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">population2 &lt;-<span class="st"> </span><span class="kw">add_row</span>(population, <span class="dt">country=</span><span class="st">&quot;CH&quot;</span>, <span class="dt">year=</span><span class="dv">2010</span>, <span class="dt">population=</span><span class="dv">8</span>)

<span class="kw">setdiff</span>(population, population2)
<span class="co">#R&gt; # A tibble: 0 x 3</span>
<span class="co">#R&gt; # … with 3 variables: country &lt;chr&gt;, year &lt;dbl&gt;, population &lt;dbl&gt;</span>
<span class="kw">setdiff</span>(population2, population)
<span class="co">#R&gt; # A tibble: 1 x 3</span>
<span class="co">#R&gt;   country  year population</span>
<span class="co">#R&gt;   &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#R&gt; 1 CH       2010          8</span></code></pre></div>
<p>Other useful functions are <code>setequal</code> and <code>identical</code>. Use <code>setequal(df1, df2)</code> which will be <code>TRUE</code> if the datasets have the same data even if the rows are not in the same order, opposed to <code>identical(df1, df2)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">capitals &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>country, <span class="op">~</span>capital, 
  <span class="st">&quot;RSA&quot;</span>, <span class="st">&quot;Pretoria&quot;</span>,
  <span class="st">&quot;FR&quot;</span>, <span class="st">&quot;Paris&quot;</span>,
  <span class="st">&quot;UK&quot;</span>, <span class="st">&quot;London&quot;</span>,
  <span class="st">&quot;SP&quot;</span>, <span class="st">&quot;Madrid&quot;</span>
)

capitals2 &lt;-<span class="st"> </span><span class="kw">tribble</span>(
  <span class="op">~</span>country, <span class="op">~</span>capital, 
  <span class="st">&quot;RSA&quot;</span>, <span class="st">&quot;Pretoria&quot;</span>,
  <span class="st">&quot;UK&quot;</span>, <span class="st">&quot;London&quot;</span>,
  <span class="st">&quot;FR&quot;</span>, <span class="st">&quot;Paris&quot;</span>,
  <span class="st">&quot;SP&quot;</span>, <span class="st">&quot;Madrid&quot;</span>
)

<span class="kw">identical</span>(capitals, capitals2)
<span class="co">#R&gt; [1] FALSE</span>
<span class="kw">setequal</span>(capitals,capitals2)
<span class="co">#R&gt; [1] TRUE</span></code></pre></div>
<!--chapter:end:56-dplyr.Rmd-->
</div>
</div>
<div id="ggplot2" class="section level1">
<h1><span class="header-section-number">27</span> <code>ggplot2</code></h1>
<p>Data visualization is part of the skill set of a data scientist.<br />
It is made to, either - explore (confirm, analyse) - explain (inform, convince) Depends who you communicate to (can be you).</p>
<div id="comparison-with-base-plot" class="section level2">
<h2><span class="header-section-number">27.1</span> Comparison with base <code>plot</code></h2>
<p>Limitations of base plot - plot does not redraw, i.e., the range will not adapt to new data - plot is drawn as an image, i.e., it’s not an object - manual legend - no unified framework for plotting, i.e., need to master other commands for other types of graphs</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">rm</span>(mtcarts)
<span class="co">#R&gt; Warning in rm(mtcarts): object &#39;mtcarts&#39; not found</span>
<span class="kw">data</span>(<span class="st">&quot;mtcars&quot;</span>)
mtcars<span class="op">$</span>cyl &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mtcars<span class="op">$</span>cyl) <span class="co"># treat &#39;cyl&#39; as a factor</span>

<span class="kw">plot</span>(mtcars<span class="op">$</span>wt, mtcars<span class="op">$</span>mpg, <span class="dt">col =</span> mtcars<span class="op">$</span>cyl)
<span class="kw">abline</span>(<span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> mtcars), <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">lapply</span>(mtcars<span class="op">$</span>cyl, <span class="cf">function</span>(x) {
  <span class="kw">abline</span>(<span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, mtcars, <span class="dt">subset =</span> (cyl <span class="op">==</span><span class="st"> </span>x)), <span class="dt">col =</span> x)
  })
<span class="kw">legend</span>(<span class="dt">x =</span> <span class="dv">5</span>, <span class="dt">y =</span> <span class="dv">33</span>, <span class="dt">legend =</span> <span class="kw">levels</span>(mtcars<span class="op">$</span>cyl),<span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">pch =</span> <span class="dv">1</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)
       
plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg, <span class="dt">col =</span> <span class="kw">factor</span>(cyl))) <span class="op">+</span>
<span class="st">         </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">         </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm , <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="kw">aes</span>(<span class="dt">col=</span>cyl)) <span class="op">+</span>
<span class="st">         </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm , <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">linetype=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;grey&quot;</span>, <span class="kw">aes</span>(<span class="dt">group=</span><span class="dv">1</span>))       
plot1 <span class="co"># print the object &#39;plot1&#39;</span></code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-131-1.png" width="672" /><img src="MyR_files/figure-html/unnamed-chunk-131-2.png" width="672" /></p>
</div>
<div id="grammar-of-graphics---leland-wilkinson" class="section level2">
<h2><span class="header-section-number">27.2</span> Grammar of graphics - Leland Wilkinson</h2>
<div id="a-graphic-layers-of-grammatical-elements" class="section level3">
<h3><span class="header-section-number">27.2.1</span> A graphic = layers of grammatical elements</h3>
<p>The layers are the adjectives and the nouns Seven grammatical elements, three are essential</p>
</div>
<div id="meaningful-plots-are-built-around-appropriate-aesthetic-mappings" class="section level3">
<h3><span class="header-section-number">27.2.2</span> Meaningful plots are built around appropriate aesthetic mappings</h3>
<p>The mappings are the rules to assemble the nouns and adjectives</p>
</div>
</div>
<div id="understanding-the-grammar" class="section level2">
<h2><span class="header-section-number">27.3</span> Understanding the grammar</h2>
<p>Building an example</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>diamonds, <span class="dt">mapping=</span> <span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span> price)) <span class="co"># data and mappings</span>

<span class="co">#p2 &lt;- p1 + geom_point()  # + the general form</span>

p2 &lt;-<span class="st"> </span>p1 <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()  <span class="co"># + the general form</span>

p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span> price, <span class="dt">col=</span>clarity)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_point</span>() <span class="co"># adding a mapping / variable</span>

p3b &lt;-<span class="st"> </span><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span> price)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="co"># adding a attribute</span>


p4 &lt;-<span class="st"> </span>p1 <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">col=</span>clarity)) <span class="co"># or changing some attributes</span>
<span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
<div id="data-and-proper-data-format" class="section level3">
<h3><span class="header-section-number">27.3.1</span> Data and proper data format</h3>
<p>The data being plotted Includes: variables of interest Tidy data helps make good <code>ggplot()</code>s</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris.tidy &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(key, Value, <span class="op">-</span>Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(key, <span class="kw">c</span>(<span class="st">&quot;Part&quot;</span>, <span class="st">&quot;Measure&quot;</span>), <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>)

p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris.tidy, <span class="kw">aes</span>(<span class="dt">x =</span> Species, <span class="dt">y =</span> Value, <span class="dt">col =</span> Part)) <span class="op">+</span>
<span class="kw">geom_jitter</span>() <span class="op">+</span>
<span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>Measure)

p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris.tidy, <span class="kw">aes</span>(<span class="dt">x =</span> Measure, <span class="dt">y =</span> Value, <span class="dt">col =</span> Part)) <span class="op">+</span>
<span class="kw">geom_jitter</span>() <span class="op">+</span>
<span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>Species)


p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris.tidy, <span class="kw">aes</span>(<span class="dt">x =</span> Species, <span class="dt">y =</span> Value, <span class="dt">col =</span> Part)) <span class="op">+</span>
<span class="kw">geom_point</span>()

<span class="kw">grid.arrange</span>(p1, p2, p3, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-133-1.png" width="672" /></p>
</div>
<div id="aesthetics" class="section level3">
<h3><span class="header-section-number">27.3.2</span> Aesthetics</h3>
<p>The scales onto which we map our data Includes: x-axis, y-axis, colour, fill, size, labels, line width, line type,…</p>
</div>
<div id="geometries" class="section level3">
<h3><span class="header-section-number">27.3.3</span> Geometries</h3>
<p>The visual elements (shape) used for our data in the plot Includes: point, line, histogram, bar, boxplot,…</p>
</div>
<div id="other-grammatical-elements" class="section level3">
<h3><span class="header-section-number">27.3.4</span> Other grammatical elements</h3>
<p>These are - facets - statistics - coordinates - themes</p>
</div>
<div id="juggling-with-aes" class="section level3">
<h3><span class="header-section-number">27.3.5</span> Juggling with <code>aes</code></h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;mtcars&quot;</span>)
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_point</span>()

<span class="co"># color dependent on &#39;disp&#39;,</span>
<span class="co"># &#39;disp&#39; is continuous, hence the shades of same colour</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg, <span class="dt">col =</span> disp)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_point</span>()  <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">se=</span><span class="ot">FALSE</span>)

<span class="co"># changing the colour depending on the variable &#39;clarity&#39;, </span>
<span class="co"># &#39;clarity&#39; is a factor, hence the different colours</span>
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">col=</span>clarity)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_smooth</span>()

<span class="co"># size dependent on &#39;disp&#39;</span>
p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg, <span class="dt">size =</span> disp)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_point</span>()

<span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol=</span><span class="dv">2</span>)
<span class="co">#R&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span>
<span class="co">#R&gt; `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</span></code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
</div>
<div id="juggling-with-geom" class="section level3">
<h3><span class="header-section-number">27.3.6</span> Juggling with <code>geom</code></h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># points and smoother layer</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_smooth</span>(<span class="dt">se=</span><span class="ot">TRUE</span>) <span class="co"># se = T by default</span>

<span class="co"># only the smoother layer</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_smooth</span>()

<span class="co"># changing the parameters of the point geometry, much more transparent, here</span>
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span>.<span class="dv">04</span>)

<span class="co"># only the smoother layer and different aesthetics,</span>
<span class="co"># aes recognizes the groups and therefore separates for them</span>
p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">col=</span>clarity)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_smooth</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span>.<span class="dv">04</span>)

<span class="kw">grid.arrange</span>(p1, p2, p3,p4,  <span class="dt">ncol=</span><span class="dv">2</span>)
<span class="co">#R&gt; `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</span>
<span class="co">#R&gt; `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</span>
<span class="co">#R&gt; `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</span></code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-135-1.png" width="672" /></p>
</div>
</div>
<div id="aesthetics-1" class="section level2">
<h2><span class="header-section-number">27.4</span> Aesthetics</h2>
<div id="understanding-aesthetics" class="section level3">
<h3><span class="header-section-number">27.4.1</span> Understanding aesthetics</h3>
<p>Usually considered as how something looks, as attributes: that’s <em>notcorrect in <code>ggplot()</code> Aesthetics refers to what a variable is </em>mappedonto it <em>Aesthetics is mapping</em> We want to map as many variables as possible in a plot, that’s visible aesthetics Aesthetics/mappings are called in <code>aes()</code> while attributes are called in <code>geom_()</code></p>
<p>For instance: - <code>aes(x = variable1, ...)</code> means ‘variable1’ is mapped onto the x-axis - <code>aes(..., col = variable2)</code> means that ‘variable2’ is mapped onto a colour</p>
<p>Simply changing the colour of the dots, is NOT aesthetics - <code>ggplot(mtcars, aes(x = wt, y = mpg)) + geom_point(col=&quot;red&quot;)</code> because there is no mapping <code>aes()</code> includes: x-axis, y-axis, colour, fill, size, alpha, labels, line width, line type,… Some aesthetics are only applicable to categorical variables: e.g., label and shape</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> wt, <span class="dt">y =</span> mpg, <span class="dt">col =</span> cyl)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">4</span>)
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x=</span>mpg, <span class="dt">y=</span>qsec,<span class="dt">size=</span>(hp<span class="op">/</span>wt), <span class="dt">shape=</span><span class="kw">factor</span>(am), <span class="dt">col=</span><span class="kw">factor</span>(cyl))) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_point</span>()

<span class="kw">grid.arrange</span>(p1, p2,  <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-136-1.png" width="672" /></p>
<p>Attributes go to <code>geom_</code></p>
</div>
<div id="modifying-aesthetics" class="section level3">
<h3><span class="header-section-number">27.4.2</span> Modifying aesthetics</h3>
<p>Modifying aesthetics is modifying the mapping</p>
<p><code>position</code> defaults to <code>identity</code>, <code>jitter</code> adds some random noise to the observations so that they do not overlap</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Length, <span class="dt">y=</span>Sepal.Width, <span class="dt">col=</span>Species)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_point</span>()
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Length, <span class="dt">y=</span>Sepal.Width, <span class="dt">col=</span>Species)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">position=</span><span class="st">&quot;jitter&quot;</span>)

<span class="kw">grid.arrange</span>(p1, p2,  <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-137-1.png" width="672" /></p>
<p><code>scale_..._...(variable1, args)</code> modifies the scale of the mapping of ‘variable1’ with several arguments such as <code>limits</code>, <code>breaks</code>, etc… Sometimes, you need to assign a dummy to the aesthetics, e.g., when you want to plot only one variable</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars<span class="op">$</span>mydummy &lt;-<span class="st"> </span><span class="dv">1</span>
 
<span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> mpg, <span class="dt">y=</span>mydummy, <span class="dt">col=</span><span class="kw">factor</span>(cyl))) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_jitter</span>() <span class="op">+</span><span class="st"> </span>
<span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">0</span>,<span class="dv">2</span>)) <span class="op">+</span><span class="st"> </span>
<span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;My nice graph&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Miles per gallon&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>, <span class="dt">col=</span><span class="st">&quot;Cylindres&quot;</span>)</code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-138-1.png" width="672" /></p>
</div>
</div>
<div id="geometries-1" class="section level2">
<h2><span class="header-section-number">27.5</span> Geometries</h2>
<p>Geometries control how your plot is going to look like: currently, there are more than 37 gemoetries available Common plots are: scatter, bar, line plots Geometries required some aesthetics and can take other aesthetics as optional Geometries can take their own aesthetics (useful to control mappings of each layer) Geometries can take their own data, too!</p>
<div id="scatter-plots" class="section level3">
<h3><span class="header-section-number">27.5.1</span> Scatter plots</h3>
<p>We’ve seen a lot, already: recall <code>geom_point()</code></p>
</div>
<div id="bar-plots" class="section level3">
<h3><span class="header-section-number">27.5.2</span> Bar plots</h3>
<p>The simplest is a histogram</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Length)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Length)) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Length, <span class="dt">fill=</span>Species)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_histogram</span>()
p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Sepal.Length, <span class="dt">fill=</span>Species)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_histogram</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="co"># or &quot;stack&quot;, or &quot;fill&quot;</span>

<span class="kw">grid.arrange</span>(p1, p2, p3, p4,  <span class="dt">ncol=</span><span class="dv">2</span>)
<span class="co">#R&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span>
<span class="co">#R&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span>
<span class="co">#R&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-139-1.png" width="672" /></p>
<p>A more general bar plot can be obtained with <code>geom_bar()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;mtcars&quot;</span>)
mtcars<span class="op">$</span>cyl &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mtcars<span class="op">$</span>cyl) <span class="co"># changing &#39;cyl&#39; to factor, which is actually is </span>
mtcars<span class="op">$</span>am &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mtcars<span class="op">$</span>am)
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x=</span>cyl, <span class="dt">fill=</span>am)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;stack&quot;</span>)
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x=</span>cyl, <span class="dt">fill=</span>am)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="co"># or &quot;stack&quot;, or &quot;fill&quot;</span>

posn_d &lt;-<span class="st"> </span><span class="kw">position_dodge</span>(<span class="dt">width=</span>.<span class="dv">2</span>) <span class="co"># like for jitter</span>
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x=</span>cyl, <span class="dt">fill=</span>am)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_bar</span>(<span class="dt">position=</span>posn_d, <span class="dt">alpha=</span>.<span class="dv">6</span>)

p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(mpg, <span class="dt">fill=</span>cyl)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">position=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">alpha=</span>.<span class="dv">4</span>)


<span class="kw">grid.arrange</span>(p1, p2, p3, p4,  <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-140-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">b=</span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">6</span>,<span class="dv">6</span>))

p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>a, <span class="dt">y=</span>b)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;stack&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Probability distribution of die roll&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Value on the die (x)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;P(x)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits=</span><span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>))
      
p1</code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
</div>
<div id="line-plots-1" class="section level3">
<h3><span class="header-section-number">27.5.3</span> Line plots</h3>
<p>Particularly suited for line plots over time</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(economics, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> unemploy)) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_line</span>()

<span class="kw">data</span>(<span class="st">&quot;beavers&quot;</span>)
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(beaver1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> temp, <span class="dt">col=</span><span class="kw">factor</span>(activ))) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group=</span><span class="dv">1</span>)) <span class="co"># group = 1 indicates you want a single line connecting all the points, you can set group=variable</span>

<span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="MyR_files/figure-html/unnamed-chunk-142-1.png" width="672" /></p>
<!--chapter:end:58-ggplot.Rmd-->
</div>
</div>
</div>
<div id="part-intermediate-r" class="section level1 unnumbered">
<h1>(PART) Intermediate R</h1>
</div>
<div id="functionals" class="section level1">
<h1><span class="header-section-number">28</span> Functionals</h1>
<div id="the-apply-family" class="section level2">
<h2><span class="header-section-number">28.1</span> The <code>apply</code> family</h2>
<p>The <code>apply</code> family are examples of functionals, functions that take a function as an input and return a vector as output. They are an alternative to loops. The members of the family differ in the kind of input and output they use / return</p>
</div>
<div id="apply" class="section level2">
<h2><span class="header-section-number">28.2</span> <code>apply</code></h2>
<p>The <code>apply</code> function operates on matrices (in general, on arrays, but we’ll only use 2D arrays, i.e., matrices).<br />
The generic call is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">apply</span>(X, MARGIN, FUN, ...)<span class="st">`</span></code></pre></div>
<ul>
<li><code>X</code> is the object to which we want to apply the function.</li>
<li><code>MARGIN</code> is the dimension of the matrix (array) to be used in the calculation. <code>MARGIN=1</code> makes the function apply to rows of <code>X</code> while <code>MARGIN=2</code> makes the function apply to columns of <code>X</code>.</li>
<li><code>FUN</code> is a function to be applied, which can also be defined by the user.</li>
<li><code>...</code> stands for possible further arguments.</li>
</ul>
<p>Importantly, notice that the function called in <code>apply</code> <strong>applies to a vector</strong>.<br />
The following examples illustrate the use of this function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a matrix</span>
myM  &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">floor</span>(<span class="kw">runif</span>(<span class="dv">30</span>)<span class="op">*</span><span class="dv">20</span>), <span class="dt">nrow=</span><span class="dv">5</span>, <span class="dt">ncol=</span><span class="dv">6</span>)
myM 
<span class="co">#R&gt;      [,1] [,2] [,3] [,4] [,5] [,6]</span>
<span class="co">#R&gt; [1,]    2    3    2    8    4    7</span>
<span class="co">#R&gt; [2,]   15    9   10   10    4    2</span>
<span class="co">#R&gt; [3,]    4   19    6   15   12   14</span>
<span class="co">#R&gt; [4,]   16    3   10   14   18    9</span>
<span class="co">#R&gt; [5,]    0    0   14   10   18    5</span>
<span class="co"># sum of rows</span>
sofr &lt;-<span class="st"> </span><span class="kw">apply</span>(myM , <span class="dv">1</span>, sum)  
sofr
<span class="co">#R&gt; [1] 26 50 70 70 47</span>
<span class="co"># standard deviation of columns</span>
sdofc &lt;-<span class="st"> </span><span class="kw">apply</span>(myM , <span class="dv">2</span>, sd)  
sdofc
<span class="co">#R&gt; [1] 7.536577 7.563068 4.560702 2.966479 7.014271 4.505552</span></code></pre></div>
<p>The dimension of the return is non-trivial, though understandable after careful examination.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
sqrtofr &lt;-<span class="st"> </span><span class="kw">apply</span>(myM , <span class="dv">1</span>,sqrt) ## careful with the dimension of the output; 
sqrtofr
<span class="co">#R&gt;          [,1]     [,2]     [,3]     [,4]     [,5]</span>
<span class="co">#R&gt; [1,] 1.414214 3.872983 2.000000 4.000000 0.000000</span>
<span class="co">#R&gt; [2,] 1.732051 3.000000 4.358899 1.732051 0.000000</span>
<span class="co">#R&gt; [3,] 1.414214 3.162278 2.449490 3.162278 3.741657</span>
<span class="co">#R&gt; [4,] 2.828427 3.162278 3.872983 3.741657 3.162278</span>
<span class="co">#R&gt; [5,] 2.000000 2.000000 3.464102 4.242641 4.242641</span>
<span class="co">#R&gt; [6,] 2.645751 1.414214 3.741657 3.000000 2.236068</span></code></pre></div>
<p>The function can be defined by the user.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define own function; e.g., take the max of the vector and add 100 </span>
myf &lt;-<span class="st"> </span><span class="cf">function</span>(k) { 
  <span class="kw">max</span>(k)<span class="op">+</span><span class="dv">100</span>
}

myfofr &lt;-<span class="st"> </span><span class="kw">apply</span>(myM ,<span class="dv">1</span>,myf)
myfofr
<span class="co">#R&gt; [1] 108 115 119 118 118</span></code></pre></div>
<p>Notice that the function can also be defined inside the <code>apply</code> function (not recommended, though).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dofc &lt;-<span class="st"> </span><span class="kw">apply</span>(myM , <span class="dv">2</span>, <span class="cf">function</span>(k) <span class="kw">max</span>(k)<span class="op">+</span><span class="dv">1</span>)</code></pre></div>
<div id="extra-argument-..." class="section level3">
<h3><span class="header-section-number">28.2.1</span> Extra argument <code>...</code></h3>
<p>The extra argument <code>...</code> serves as a placeholder for further arguments to be passed to the function. Here is an example that requires the extra argument <code>n</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define a function that requires two arguments</span>
myf2 &lt;-<span class="st"> </span><span class="cf">function</span>(k,n){
  <span class="kw">max</span>(k) <span class="op">+</span><span class="st"> </span>n
}

myf2ofr &lt;-<span class="st"> </span><span class="kw">apply</span>(myM, <span class="dv">1</span>, myf2, <span class="dv">25</span>)
myf2ofr
<span class="co">#R&gt; [1] 33 40 44 43 43</span></code></pre></div>
<p>Notice that if <code>n</code> was defined in the global environment, then it would be used as default in the previous.</p>
</div>
</div>
<div id="lapply" class="section level2">
<h2><span class="header-section-number">28.3</span> <code>lapply</code></h2>
<p><code>lapply</code> applies a given function to every element of a list and returns a list as result. Of course, it can also be applied to a vector.<br />
The generic call is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">apply</span>(X, FUN, ...)<span class="st">`</span></code></pre></div>
<ul>
<li><code>X</code> is the <strong>list</strong> to which we want to apply the function.</li>
<li><code>FUN</code> is a function to be applied to each element of the list which can also be defined by the user.<br />
</li>
<li><code>...</code> stands for possible further arguments.</li>
</ul>
<p>Here is an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first, create a list on which apply the functions</span>
mylist&lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">numbers=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>), 
              <span class="dt">cities=</span><span class="kw">c</span>(<span class="st">&quot;Cologne&quot;</span>,<span class="st">&quot;Lisbon&quot;</span>), 
              <span class="dt">results=</span> <span class="kw">c</span>(T,F,F,T), 
              <span class="dt">school=</span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Tertiary&quot;</span>), <span class="dt">ordered=</span><span class="ot">TRUE</span>))

<span class="co"># list of lengths </span>
lofl &lt;-<span class="st"> </span><span class="kw">lapply</span>(mylist, length) 
lofl
<span class="co">#R&gt; $numbers</span>
<span class="co">#R&gt; [1] 20</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $cities</span>
<span class="co">#R&gt; [1] 2</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $results</span>
<span class="co">#R&gt; [1] 4</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $school</span>
<span class="co">#R&gt; [1] 3</span>

<span class="co"># unlist a list gives, if possible, a vector</span>
vofl &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(mylist, length)) 
vofl
<span class="co">#R&gt; numbers  cities results  school </span>
<span class="co">#R&gt;      20       2       4       3</span></code></pre></div>
<p>This other example shows that indeed anything that happens in R, including <code>[</code>, is a function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## &quot;[&quot; is the function of subsetting, 2 is the argument to that function,
## hence, this gives the second element of each element of mylist
sofl &lt;-<span class="st"> </span><span class="kw">lapply</span>(mylist,<span class="st">&quot;[&quot;</span>,<span class="dv">2</span>) 
sofl
<span class="co">#R&gt; $numbers</span>
<span class="co">#R&gt; [1] 2</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $cities</span>
<span class="co">#R&gt; [1] &quot;Lisbon&quot;</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $results</span>
<span class="co">#R&gt; [1] FALSE</span>
<span class="co">#R&gt; </span>
<span class="co">#R&gt; $school</span>
<span class="co">#R&gt; [1] Secondary</span>
<span class="co">#R&gt; Levels: Primary &lt; Secondary &lt; Tertiary</span></code></pre></div>
<p>Alternatively, we can also define a function for subsetting before making the <code>lapply</code> call.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mysubset &lt;-<span class="st"> </span><span class="cf">function</span>(x,n) {
  x[n]
}

sofl &lt;-<span class="st"> </span><span class="kw">lapply</span>(mylist, mysubset, <span class="dv">2</span>) </code></pre></div>
</div>
<div id="sapply" class="section level2">
<h2><span class="header-section-number">28.4</span> <code>sapply</code></h2>
<p><code>sapply</code> works like <code>lapply</code> but tries to return a simplified version.</p>
<p>The same example as above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mylist&lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">numbers=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>), 
              <span class="dt">cities=</span><span class="kw">c</span>(<span class="st">&quot;Cologne&quot;</span>,<span class="st">&quot;Lisbon&quot;</span>), 
              <span class="dt">results=</span> <span class="kw">c</span>(T,F,F,T), 
              <span class="dt">school=</span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Tertiary&quot;</span>), <span class="dt">ordered=</span><span class="ot">TRUE</span>))

<span class="co"># vector of lengths </span>
sofl2 &lt;-<span class="st"> </span><span class="kw">sapply</span>(mylist, length) 
sofl2
<span class="co">#R&gt; numbers  cities results  school </span>
<span class="co">#R&gt;      20       2       4       3</span></code></pre></div>
<p>Another example, this time applied on a vector of a list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sd2ofl &lt;-<span class="st"> </span><span class="kw">sapply</span>(mylist<span class="op">$</span>numbers, <span class="cf">function</span>(x) x<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="dv">2</span> )</code></pre></div>
</div>
<div id="multicore-implementation" class="section level2">
<h2><span class="header-section-number">28.5</span> Multicore implementation</h2>
<p>The <code>apply()</code> family runs, by nature, “embarrassingly parallel tasks”. As it turns out, it is very easy on Mac to exploit parallelism.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(parallel)
cores &lt;-<span class="st"> </span><span class="kw">detectCores</span>()
cores
<span class="co">#R&gt; [1] 4</span>
<span class="co"># the function Sys.sleep(n) makes the computer sleep for the n seconds</span>
<span class="kw">system.time</span>(<span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="cf">function</span>(x) <span class="kw">Sys.sleep</span>(<span class="dv">1</span>)))
<span class="co">#R&gt;    user  system elapsed </span>
<span class="co">#R&gt;   0.002   0.000   4.019</span>
<span class="kw">system.time</span>(<span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="cf">function</span>(x) <span class="kw">Sys.sleep</span>(<span class="dv">1</span>), <span class="dt">mc.cores =</span> cores ))
<span class="co">#R&gt;    user  system elapsed </span>
<span class="co">#R&gt;   0.012   0.033   1.027</span></code></pre></div>
<!--chapter:end:60-functionals.Rmd-->
</div>
</div>
<div id="scoping" class="section level1">
<h1><span class="header-section-number">29</span> Scoping</h1>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">29.1</span> Introduction</h2>
<p>A function creates its own environment. In turn, this environment of the function is a child of the environment where the function was created.<br />
Scoping refers to the set of rules on what environment R looks for the value of a name. For instance, if the code contains <code>myv &lt;- 12</code>, then later typing <code>myv</code> forces R to retrieve 12 from an environment.<br />
R uses lexical scoping and, under some circumstances, dynamic scoping. We’re interested in lexical scoping.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  x<span class="op">+</span><span class="dv">1</span>
}
<span class="kw">mean</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="co">#R&gt;  [1]  2  3  4  5  6  7  8  9 10 11</span>

<span class="kw">rm</span>(mean)

<span class="kw">mean</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)
<span class="co">#R&gt; [1] 5.5</span></code></pre></div>
</div>
<div id="rule-1-name-masking" class="section level2">
<h2><span class="header-section-number">29.2</span> Rule 1: name masking</h2>
<p>If a name is not defined in a function, R looks one level up, i.e., in the parent:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="dv">10</span>

f &lt;-<span class="st"> </span><span class="cf">function</span>(){
  b &lt;-<span class="st"> </span><span class="dv">2</span>
  a <span class="op">+</span><span class="st"> </span>b <span class="co"># same as return(a + b)</span>
}

<span class="kw">f</span>()
<span class="co">#R&gt; [1] 12</span>

c &lt;-<span class="st"> </span><span class="dv">11</span>
g &lt;-<span class="st"> </span><span class="cf">function</span>() {
  d &lt;-<span class="st"> </span><span class="dv">4</span>
  h &lt;-<span class="st"> </span><span class="cf">function</span>() {
    e &lt;-<span class="st"> </span><span class="dv">5</span>
    c <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>d <span class="op">+</span><span class="st"> </span>e
  }
  <span class="kw">h</span>()
}

<span class="kw">g</span>()
<span class="co">#R&gt; [1] 24</span>



c &lt;-<span class="st"> </span><span class="dv">11</span>
d &lt;-<span class="st"> </span><span class="dv">100</span>
g &lt;-<span class="st"> </span><span class="cf">function</span>() {
  d &lt;-<span class="st"> </span><span class="dv">4</span>
  h &lt;-<span class="st"> </span><span class="cf">function</span>() {
    e &lt;-<span class="st"> </span><span class="dv">5</span>
    c <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>d <span class="op">+</span><span class="st"> </span>e
  }
  <span class="kw">h</span>()
}
 <span class="kw">g</span>()
<span class="co">#R&gt; [1] 24</span></code></pre></div>
</div>
<div id="rule-2-fresh-start" class="section level2">
<h2><span class="header-section-number">29.3</span> Rule 2: fresh start</h2>
<p>Every time a function is called, a new environment is created. In other words, the function does not know that it has been called before.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a 
<span class="co">#R&gt; [1] 10</span>
t &lt;-<span class="st"> </span><span class="cf">function</span>() {
  <span class="cf">if</span> (<span class="kw">exists</span>(<span class="st">&quot;a&quot;</span>)) { 
    a &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="dv">2</span>
    a
  } <span class="cf">else</span> {
    a &lt;-<span class="st"> </span><span class="dv">20</span> 
    a
  } 
}
<span class="kw">t</span>()
<span class="co">#R&gt; [1] 12</span>

<span class="kw">t</span>()
<span class="co">#R&gt; [1] 12</span>
<span class="kw">t</span>()
<span class="co">#R&gt; [1] 12</span>

a &lt;-<span class="st"> </span><span class="dv">4</span>
<span class="co"># gives 6 because when the function t looks for &#39;a&#39;, NOW, it finds it in the parent </span>
<span class="kw">t</span>() 
<span class="co">#R&gt; [1] 6</span>


l &lt;-<span class="st"> </span><span class="cf">function</span>() {
  a &lt;-<span class="st"> </span><span class="dv">5</span> 
  <span class="co"># &#39;a&#39; is defined in the environment, so there is no need to look into the parent </span>
  <span class="cf">if</span> (<span class="kw">exists</span>(<span class="st">&quot;a&quot;</span>)) { 
    a &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="dv">2</span>
    a
  } <span class="cf">else</span> {
    a &lt;-<span class="st"> </span><span class="dv">10</span> 
    a
  } 
}
<span class="kw">l</span>()
<span class="co">#R&gt; [1] 7</span></code></pre></div>
</div>
<div id="rule-3-dynamic-lookup" class="section level2">
<h2><span class="header-section-number">29.4</span> Rule 3: dynamic lookup</h2>
<p>R looks for values when the function is called. If the environment where R will look for values has changed in between calls, the result of the function may be different. This is a source of error that should avoided.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">u &lt;-<span class="st"> </span><span class="cf">function</span>() a<span class="op">^</span><span class="dv">2</span>
a &lt;-<span class="st"> </span><span class="dv">2</span>
<span class="kw">u</span>() 
<span class="co">#R&gt; [1] 4</span>
<span class="co"># needs a value for &#39;a&#39; because it does not define one within its environment; </span>
<span class="co"># therefore, u() looks up to, in this case, the global environment</span>
a &lt;-<span class="st"> </span><span class="dv">3</span>
<span class="kw">u</span>()
<span class="co">#R&gt; [1] 9</span></code></pre></div>
</div>
<div id="functions-inside-functions" class="section level2">
<h2><span class="header-section-number">29.5</span> Functions inside functions</h2>
<p>Consider the following example of a function, it returns a function!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m.power &lt;-<span class="st"> </span><span class="cf">function</span>(pow){
  m.exp &lt;-<span class="st"> </span><span class="cf">function</span>(b){ b<span class="op">^</span>pow }
  m.exp <span class="co"># return the m.exp function</span>
}</code></pre></div>
<p>We can create many functions with that function. Importantly, notice that functions preserve the environment in which they were created.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
mycube &lt;-<span class="st"> </span><span class="kw">m.power</span>(<span class="dv">3</span>)
<span class="kw">mycube</span>(<span class="dv">4</span>)
<span class="co">#R&gt; [1] 64</span>

mysquare &lt;-<span class="st"> </span><span class="kw">m.power</span>(<span class="dv">2</span>)
<span class="kw">mysquare</span>(<span class="dv">5</span>)
<span class="co">#R&gt; [1] 25</span>

<span class="co"># ls(environment(m.power)) gives the global environment</span>
<span class="kw">ls</span>(<span class="kw">environment</span>(mycube)) 
<span class="co">#R&gt; [1] &quot;m.exp&quot; &quot;pow&quot;</span>

w &lt;-<span class="st"> </span><span class="cf">function</span>(k){
  q &lt;-<span class="st"> </span><span class="dv">10</span>
  k<span class="op">*</span>q
}

z &lt;-<span class="st"> </span><span class="cf">function</span>() <span class="kw">w</span>(<span class="dv">2</span>) <span class="co"># z is itself a function that inherits the environment of w</span>
<span class="co"># but z, here, is forced to use 2 as an argument </span>

<span class="kw">z</span>()
<span class="co">#R&gt; [1] 20</span></code></pre></div>
</div>
<div id="examples" class="section level2">
<h2><span class="header-section-number">29.6</span> Examples</h2>
<p>The following example illustrates lexical scoping.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yy &lt;-<span class="st"> </span><span class="dv">10</span>

ff &lt;-<span class="st"> </span><span class="cf">function</span>(xx){
  yy &lt;-<span class="st"> </span><span class="dv">2</span>
  yy<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">gg</span>(xx)
}

gg &lt;-<span class="st"> </span><span class="cf">function</span>(xx){
  xx<span class="op">*</span>yy
}

<span class="kw">ff</span>(<span class="dv">3</span>) 
<span class="co">#R&gt; [1] 34</span></code></pre></div>
<p>As another illustration, we could try to guess what <code>g(2)</code> produces after the following commands. Hint: remember the in which environment the functions were created because it tells you what are the correct bindings (parent).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="dv">1</span>
b &lt;-<span class="st"> </span><span class="dv">2</span>
f &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  a<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>b
}
g &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  a &lt;-<span class="st"> </span><span class="dv">2</span>
  b &lt;-<span class="st"> </span><span class="dv">1</span>
  <span class="kw">f</span>(x)
}

<span class="kw">g</span>(<span class="dv">2</span>)
<span class="co">#R&gt; [1] 4</span></code></pre></div>
<p>Compare to <code>g(2)</code> here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="dv">1</span>
b &lt;-<span class="st"> </span><span class="dv">2</span>
f &lt;-<span class="st"> </span><span class="cf">function</span>(a,b){
  <span class="kw">return</span>( <span class="cf">function</span>(x) {a<span class="op">*</span>x <span class="op">+</span><span class="st"> </span>b})
}
g &lt;-<span class="st"> </span><span class="kw">f</span>(<span class="dv">2</span>,<span class="dv">1</span>)
<span class="kw">g</span>(<span class="dv">2</span>)
<span class="co">#R&gt; [1] 5</span></code></pre></div>
<!--chapter:end:62-scoping.Rmd-->
</div>
</div>
<div id="part-conclusion" class="section level1 unnumbered">
<h1>(PART) Conclusion</h1>
</div>
<div id="conclusion" class="section level1">
<h1><span class="header-section-number">30</span> Conclusion</h1>
<p>We did a great book!</p>
<!--chapter:end:95-conclusion.Rmd-->
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<!--chapter:end:99-references.Rmd-->
<div id="refs" class="references">
<div id="ref-latexlist">
<p>Pakin, Scott. 2009. “The Comprehensive Latex Symbol List.” Citeseer.</p>
</div>
<div id="ref-wickham2014">
<p>Wickham, Hadley. 2014. <em>Advanced R</em>. Chapman; Hall/CRC.</p>
</div>
<div id="ref-xie2015">
<p>Xie, Yihui. 2015. <em>Dynamic Documents with R and Knitr</em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="http://yihui.name/knitr/" class="uri">http://yihui.name/knitr/</a>.</p>
</div>
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
